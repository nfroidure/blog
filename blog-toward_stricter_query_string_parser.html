<!DOCTYPE html><html lang="blog-toward_stricter_query_string_parser"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="preload" as="image" href="/images/logo.svg"/><link rel="stylesheet" href="https://insertafter.com/_next/static/css/82572465af7cf95c.css" data-precedence="next"/><link rel="stylesheet" href="https://insertafter.com/_next/static/css/b92332a99cee7bfa.css" data-precedence="next"/><link rel="stylesheet" href="https://insertafter.com/_next/static/css/2b26a2222cb58ac3.css" data-precedence="next"/><link rel="preload" as="script" fetchPriority="low" href="https://insertafter.com/_next/static/chunks/webpack-0cf58a546aefb656.js"/><script src="https://insertafter.com/_next/static/chunks/4bd1b696-9839e50bf4426210.js" async=""></script><script src="https://insertafter.com/_next/static/chunks/684-1da9a03c34d82cdf.js" async=""></script><script src="https://insertafter.com/_next/static/chunks/main-app-da17a98a2bb76af6.js" async=""></script><script src="https://insertafter.com/_next/static/chunks/874-f855e4232fadb1a1.js" async=""></script><script src="https://insertafter.com/_next/static/chunks/app/(withLocale)/%5Blocale%5D/layout-67411bf3cfc47b03.js" async=""></script><script src="https://insertafter.com/_next/static/chunks/96-3883dbab65ddc99f.js" async=""></script><script src="https://insertafter.com/_next/static/chunks/app/(withLocale)/%5Blocale%5D/%5B...slug%5D/page-f69cf0f70d06d9dc.js" async=""></script><meta name="theme-color" content="#3e78b2"/><title>Toward a stricter query string parser - Nicolas Froidure</title><meta name="description" content="With most query string parsers, a lot of URIs can point to the same content. It not only mess you cache system but make your logs less expressive. To avoid those problems I just wrote a stricter query string parser."/><link rel="author" href="https://insertafter.com"/><meta name="author" content="Nicolas Froidure"/><meta name="robots" content="index, follow"/><link rel="canonical" href="https://insertafter.com/en/blog/toward_stricter_query_string_parser"/><meta property="og:title" content="Toward a stricter query string parser - Nicolas Froidure"/><meta property="og:description" content="With most query string parsers, a lot of URIs can point to the same content. It not only mess you cache system but make your logs less expressive. To avoid those problems I just wrote a stricter query string parser."/><meta property="og:url" content="https://insertafter.com/en/blog/toward_stricter_query_string_parser"/><meta property="og:site_name" content="Nicolas Froidure"/><meta property="og:locale" content="en_US"/><meta property="og:image:alt" content="Website banner"/><meta property="og:image" content="https://insertafter.com/images/banner.png"/><meta property="og:type" content="article"/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:title" content="Toward a stricter query string parser - Nicolas Froidure"/><meta name="twitter:description" content="With most query string parsers, a lot of URIs can point to the same content. It not only mess you cache system but make your logs less expressive. To avoid those problems I just wrote a stricter query string parser."/><meta name="twitter:image:alt" content="Website banner"/><meta name="twitter:image" content="https://insertafter.com/images/banner.png"/><link rel="icon" href="/images/favicon.svg" type="image/svg+xml" sizes="any"/><link rel="icon" href="/images/favicon-16.png" type="image/png" sizes="16x16"/><link rel="icon" href="/images/favicon-128.png" type="image/png" sizes="128x128"/><script src="https://insertafter.com/_next/static/chunks/polyfills-42372ed130431b0a.js" noModule=""></script></head><body class="layout_body__jFZuu"><header class="header_iaHeader__4vCMA"><div><h1><a href="/blog-toward_stricter_query_string_parser" title="Go back to home page" class="header_iaHeaderLogo__0uNr1"><img src="/images/logo.svg" alt="InsertAfter&#x27;s Logo"/></a></h1></div></header><nav class="menu_iaMenu__B_rtj"><ul class="menu_iaMenuBody__0Zveq"><li class="menu_iaMenuItem__rOch4"><a href="/blog-toward_stricter_query_string_parserundefined" title="Go back to home page" class="">Home</a></li><li class="menu_iaMenuItem__rOch4"><a href="/blog-toward_stricter_query_string_parserundefined" title="Read my blog posts" class="">Blog</a></li><li class="menu_iaMenuItem__rOch4"><a href="/blog-toward_stricter_query_string_parserundefined" title="Discover my projects" class="">Projects</a></li><li class="menu_iaMenuItem__rOch4"><a href="/blog-toward_stricter_query_string_parserundefined" title="Read more about me" class="">About me</a></li></ul></nav><nav class="languages_iaLanguages__K2J3W"><ul><li class="languages_iaLanguagesFlag__ruQ4j languages_iaLanguagesFlagEn__angfJ languages_selected__w1dKv"><a href="/en"><span>en</span></a></li><li class="languages_iaLanguagesFlag__ruQ4j languages_iaLanguagesFlagFr__Us5Jb languages_selected__w1dKv"><a href="/fr"><span>fr</span></a></li></ul></nav><main class="layout_iaMain__6s2gl"><div><section class="contentBlock_root__802UK"><h1 class="h1_root__VPXQG"><span>Toward a stricter query string parser</span></h1><p class="p_root__SHE_W"><strong class="strong_root__kOzFq"><span>TL.DR.</span></strong><span> Having a stricter query string policy adds value to APIs. Checkout </span><a class="a_root__WEPS7" target="_blank" href="https://github.com/nfroidure/strict-qs"><span>strict-qs</span></a><span>.</span></p><p class="p_root__SHE_W"><span>I my journey to the NodeJS HTTP server of my choice, I just reached a new milestone. Indeed, in the ancient ages, when PHP was my language of choice, I made a simple framework called </span><a class="a_root__WEPS7" target="_blank" href="https://github.com/Rest4"><span>Rest4</span></a><span>.</span></p><p class="p_root__SHE_W"><span>One of its features was to strictly check for query params types, order and existence. I felt a bit disarmed when I figured out that most NodeJS frameworks follow a non restrictive path when it comes to parse query strings.</span></p><p class="p_root__SHE_W"><span>When no checks are done on query strings, you can end up with a lot of URIs pointing to the same resource. By example, in most applications the following URIs would serve the same resource:</span></p><ul class="ul_ul__qh0e9"><li class="li_root__oY9Dv"><p class="p_root__SHE_W"><code class="code_root__5JLV_">/articles?q=test</code><span>,</span></p></li><li class="li_root__oY9Dv"><p class="p_root__SHE_W"><code class="code_root__5JLV_">/articles?q=test&amp;page=1</code><span>,</span></p></li><li class="li_root__oY9Dv"><p class="p_root__SHE_W"><code class="code_root__5JLV_">/articles?page=1&amp;q=test</code><span>,</span></p></li><li class="li_root__oY9Dv"><p class="p_root__SHE_W"><code class="code_root__5JLV_">/articles?q=test&amp;page=invalid</code><span>,</span></p></li><li class="li_root__oY9Dv"><p class="p_root__SHE_W"><code class="code_root__5JLV_">/articles?q=test&amp;page</code><span>,</span></p></li><li class="li_root__oY9Dv"><p class="p_root__SHE_W"><code class="code_root__5JLV_">/articles?q=test&amp;page=1&amp;dummy=lol</code><span>.</span></p></li></ul><p class="p_root__SHE_W"><span>This has a lot of undesired effects.</span></p><h2 class="h2_root__Y02lX"><span class="anchored_root__HWi6K"><span>Content duplication</span> <small><a class="anchored_icon__N5Sem" id="content-duplication" title="Lien vers cette section" href="#content-duplication"><span>ðŸ”—</span></a></small></span></h2><p class="p_root__SHE_W"><span>If you are serving webpages you may want to avoid being downgraded in </span><a class="a_root__WEPS7" target="_blank" href="https://support.google.com/webmasters/answer/66359?hl=en"><span>search engines</span></a><span>. There are other ways to prevent this but with a strict query string policy it comes out of the box.</span></p><h2 class="h2_root__Y02lX"><span class="anchored_root__HWi6K"><span>Harder caching</span> <small><a class="anchored_icon__N5Sem" id="harder-caching" title="Lien vers cette section" href="#harder-caching"><span>ðŸ”—</span></a></small></span></h2><p class="p_root__SHE_W"><span>If you want to use the resource URI as a key in a Redis cache to speed up your API, you won&#x27;t be able to use the URI as is, without being vulnerable to cache flooding.</span></p><p class="p_root__SHE_W"><span>You&#x27;ll first have to create a canonical URI to store your contents and this extra compute will be done every time you will access your cache. Also public proxies often have their own interpretation of HTTP caching specs, providing unique URIs ensure you a better handling of your HTTP requests by them.</span></p><h2 class="h2_root__Y02lX"><span class="anchored_root__HWi6K"><span>Messy logs</span> <small><a class="anchored_icon__N5Sem" id="messy-logs" title="Lien vers cette section" href="#messy-logs"><span>ðŸ”—</span></a></small></span></h2><p class="p_root__SHE_W"><span>Logs get harder to reduce/compare/read until you reorder query strings yourself before logging. Even if you do that, your upstream tools (say NGinX, HAProxy, Fastly...) won&#x27;t take advantage of it.</span></p><h2 class="h2_root__Y02lX"><span class="anchored_root__HWi6K"><span>Defensive programming</span> <small><a class="anchored_icon__N5Sem" id="defensive-programming" title="Lien vers cette section" href="#defensive-programming"><span>ðŸ”—</span></a></small></span></h2><p class="p_root__SHE_W"><span>Consider the following URI: </span><code class="code_root__5JLV_">/articles?q=test&amp;page=1&amp;page=1&amp;page=1&amp;page=1</code><span>.</span></p><p class="p_root__SHE_W"><span>With a simple query parser, it will lead to an array of pages which is probably not what you want. It leads to unexpected behavior and lots of attacks are based on it.</span></p><p class="p_root__SHE_W"><span>Just created </span><a class="a_root__WEPS7" target="_blank" href="https://github.com/nfroidure/strict-qs"><span>strict-qs</span></a><span> to match those issues. It simply builds an object whose properties are query parameters of the types you would expect. If you try it, let me know ;).</span></p><p class="p_root__SHE_W"><span>You&#x27;ll still have to validate it with a JSONSchema validator since I wanted it to do one thing and do it well. There is plenty of JSONSchema validators, I currently use </span><a class="a_root__WEPS7" target="_blank" href="https://github.com/epoberezkin/ajv"><span>AJV</span></a><span>.</span></p><p class="p_root__SHE_W"><span>Finally, there is still some work to achieve in order to ensure unicity of paths too. The following URIs would also lead to the same resource: </span><code class="code_root__5JLV_">/articles/1</code><span>, </span><code class="code_root__5JLV_">/articles/0001</code><span>, </span><code class="code_root__5JLV_">/articles/1/</code><span>.</span></p><p class="p_root__SHE_W"><span>I updated </span><a class="a_root__WEPS7" target="_blank" href="https://github.com/nfroidure/siso"><span>siso</span></a><span> to handle this problem too.</span></p><p class="p_root__SHE_W">Published at<!-- --> <!-- -->lundi 12 dÃ©cembre 2016 Ã  20:50:52<!-- -->.</p></section><section class="contentBlock_root__802UK"><aside class="share_root__Qm_RR"><h2 class="h2_root__Y02lX">Comment and share</h2><p class="p_root__SHE_W"><a class="a_root__WEPS7" title="Comment on Facebook" target="_blank" href="https://www.facebook.com/dialog/share?display=popup&amp;href=https%3A%2F%2Finsertafter.com%2Fblog%2Ftoward_stricter_query_string_parser&amp;redirect_uri=https%3A%2F%2Finsertafter.com"><span class="share_icon__bi4Q3 share_facebook__JKn8d"></span>Facebook</a> - <a class="a_root__WEPS7" title="Comment on Bluesky" target="_blank" href="https://bsky.app/intent/compose?text=https%3A%2F%2Finsertafter.com%2Fblog%2Ftoward_stricter_query_string_parser"><span class="share_icon__bi4Q3 share_bluesky__ahvrM"></span>Bluesky</a> - <a class="a_root__WEPS7" title="Answer via email" target="_self" href="mailto:nicolas.froidure@gmail.com?subject=Toward%20a%20stricter%20query%20string%20parser"><span class="share_icon__bi4Q3 share_mail__yvBDK"></span>Email</a></p></aside></section><section class="contentBlock_root__802UK"></section></div></main><aside class="social_iaSocial__kdR1x"><nav><ul><li><a href="https://mastodon.social/@nfroidure" rel="me" title="Follow me on Mastodon" class="social_iaSocialMastodon__MTF6o"><span>Mastodon</span></a></li><li><a href="https://bsky.app/profile/nfroidure.bsky.social" rel="me" title="Follow me on Bluesky" class="social_iaSocialBluesky__fKW6M"><span>Bluesky</span></a></li><li><a href="https://github.com/nfroidure" title="See my GitHub projects" class="social_iaSocialGithub__vcU5_"><span>GitHub</span></a></li><li><a href="https://www.npmjs.org/~nfroidure" title="Check my NPM modules" class="social_iaSocialNpm__6nku5"><span>NPM</span></a></li><li><a href="https://www.linkedin.com/in/nfroidure/" rel="me" title="See my LinkedIn profile" class="social_iaSocialLinkedin__pWACO"><span>LinkedIn</span></a></li><li><a href="https://facebook.com/nicolas.froidure.douai" rel="me" title="Follow me on Facebook" class="social_iaSocialFacebook__w4wfH"><span>Facebook</span></a></li><li><a href="/blog-toward_stricter_query_string_parser/blog/index.atom" title="Subscribe to my RSS feed" class="social_iaSocialFeed__gEQQ0"><span>RSS Feed</span></a></li></ul></nav></aside><footer class="footer_iaFooter__rhlnQ"><p class="footer_iaFooterContent__VZndF">Â© Nicolas Froidure 2012-<!-- -->2025</p></footer><script src="https://insertafter.com/_next/static/chunks/webpack-0cf58a546aefb656.js" async=""></script><script>(self.__next_f=self.__next_f||[]).push([0])</script><script>self.__next_f.push([1,"1:\"$Sreact.fragment\"\n2:I[7555,[],\"\"]\n3:I[1295,[],\"\"]\n6:I[9665,[],\"OutletBoundary\"]\n9:I[9665,[],\"ViewportBoundary\"]\nb:I[9665,[],\"MetadataBoundary\"]\nd:I[6614,[],\"\"]\n:HL[\"https://insertafter.com/_next/static/css/82572465af7cf95c.css\",\"style\"]\n:HL[\"https://insertafter.com/_next/static/css/b92332a99cee7bfa.css\",\"style\"]\n:HL[\"https://insertafter.com/_next/static/css/2b26a2222cb58ac3.css\",\"style\"]\n"])</script><script>self.__next_f.push([1,"0:{\"P\":null,\"b\":\"dskjTI4D3R3slWPvLBhrU\",\"p\":\"https://insertafter.com\",\"c\":[\"\",\"blog-toward_stricter_query_string_parser\"],\"i\":false,\"f\":[[[\"\",{\"children\":[\"(withRedirects)\",{\"children\":[[\"locale\",\"blog-toward_stricter_query_string_parser\",\"d\"],{\"children\":[\"__PAGE__\",{}]},\"$undefined\",\"$undefined\",true]}]}],[\"\",[\"$\",\"$1\",\"c\",{\"children\":[null,[\"$\",\"$L2\",null,{\"parallelRouterKey\":\"children\",\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L3\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":[[[\"$\",\"title\",null,{\"children\":\"404: This page could not be found.\"}],[\"$\",\"div\",null,{\"style\":{\"fontFamily\":\"system-ui,\\\"Segoe UI\\\",Roboto,Helvetica,Arial,sans-serif,\\\"Apple Color Emoji\\\",\\\"Segoe UI Emoji\\\"\",\"height\":\"100vh\",\"textAlign\":\"center\",\"display\":\"flex\",\"flexDirection\":\"column\",\"alignItems\":\"center\",\"justifyContent\":\"center\"},\"children\":[\"$\",\"div\",null,{\"children\":[[\"$\",\"style\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"body{color:#000;background:#fff;margin:0}.next-error-h1{border-right:1px solid rgba(0,0,0,.3)}@media (prefers-color-scheme:dark){body{color:#fff;background:#000}.next-error-h1{border-right:1px solid rgba(255,255,255,.3)}}\"}}],[\"$\",\"h1\",null,{\"className\":\"next-error-h1\",\"style\":{\"display\":\"inline-block\",\"margin\":\"0 20px 0 0\",\"padding\":\"0 23px 0 0\",\"fontSize\":24,\"fontWeight\":500,\"verticalAlign\":\"top\",\"lineHeight\":\"49px\"},\"children\":404}],[\"$\",\"div\",null,{\"style\":{\"display\":\"inline-block\"},\"children\":[\"$\",\"h2\",null,{\"style\":{\"fontSize\":14,\"fontWeight\":400,\"lineHeight\":\"49px\",\"margin\":0},\"children\":\"This page could not be found.\"}]}]]}]}]],[]],\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]]}],{\"children\":[\"(withRedirects)\",[\"$\",\"$1\",\"c\",{\"children\":[null,[\"$\",\"$L2\",null,{\"parallelRouterKey\":\"children\",\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L3\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":[[[\"$\",\"title\",null,{\"children\":\"404: This page could not be found.\"}],[\"$\",\"div\",null,{\"style\":\"$0:f:0:1:1:props:children:1:props:notFound:0:1:props:style\",\"children\":[\"$\",\"div\",null,{\"children\":[[\"$\",\"style\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"body{color:#000;background:#fff;margin:0}.next-error-h1{border-right:1px solid rgba(0,0,0,.3)}@media (prefers-color-scheme:dark){body{color:#fff;background:#000}.next-error-h1{border-right:1px solid rgba(255,255,255,.3)}}\"}}],[\"$\",\"h1\",null,{\"className\":\"next-error-h1\",\"style\":\"$0:f:0:1:1:props:children:1:props:notFound:0:1:props:children:props:children:1:props:style\",\"children\":404}],[\"$\",\"div\",null,{\"style\":\"$0:f:0:1:1:props:children:1:props:notFound:0:1:props:children:props:children:2:props:style\",\"children\":[\"$\",\"h2\",null,{\"style\":\"$0:f:0:1:1:props:children:1:props:notFound:0:1:props:children:props:children:2:props:children:props:style\",\"children\":\"This page could not be found.\"}]}]]}]}]],[]],\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]]}],{\"children\":[[\"locale\",\"blog-toward_stricter_query_string_parser\",\"d\"],[\"$\",\"$1\",\"c\",{\"children\":[[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"https://insertafter.com/_next/static/css/82572465af7cf95c.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\",\"nonce\":\"$undefined\"}]],\"$L4\"]}],{\"children\":[\"__PAGE__\",[\"$\",\"$1\",\"c\",{\"children\":[\"$L5\",\"$undefined\",[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"https://insertafter.com/_next/static/css/b92332a99cee7bfa.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\",\"nonce\":\"$undefined\"}],[\"$\",\"link\",\"1\",{\"rel\":\"stylesheet\",\"href\":\"https://insertafter.com/_next/static/css/2b26a2222cb58ac3.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\",\"nonce\":\"$undefined\"}]],[\"$\",\"$L6\",null,{\"children\":[\"$L7\",\"$L8\",null]}]]}],{},null,false]},null,false]},null,false]},null,false],[\"$\",\"$1\",\"h\",{\"children\":[null,[\"$\",\"$1\",\"LbUOWpt-PWomuSRnUPqPA\",{\"children\":[[\"$\",\"$L9\",null,{\"children\":\"$La\"}],null]}],[\"$\",\"$Lb\",null,{\"children\":\"$Lc\"}]]}],false]],\"m\":\"$undefined\",\"G\":[\"$d\",\"$undefined\"],\"s\":false,\"S\":true}\n"])</script><script>self.__next_f.push([1,"e:\"$Sreact.strict_mode\"\nf:I[8873,[\"874\",\"static/chunks/874-f855e4232fadb1a1.js\",\"322\",\"static/chunks/app/(withLocale)/%5Blocale%5D/layout-67411bf3cfc47b03.js\"],\"default\"]\n10:I[2489,[\"874\",\"static/chunks/874-f855e4232fadb1a1.js\",\"322\",\"static/chunks/app/(withLocale)/%5Blocale%5D/layout-67411bf3cfc47b03.js\"],\"default\"]\n"])</script><script>self.__next_f.push([1,"4:[\"$\",\"$e\",null,{\"children\":[\"$\",\"html\",null,{\"lang\":\"blog-toward_stricter_query_string_parser\",\"children\":[\"$\",\"body\",null,{\"className\":\"layout_body__jFZuu\",\"children\":[null,[\"$\",\"header\",null,{\"className\":\"header_iaHeader__4vCMA\",\"children\":[\"$\",\"div\",null,{\"className\":\"$undefined\",\"children\":[\"$\",\"h1\",null,{\"children\":[\"$\",\"a\",null,{\"href\":\"/blog-toward_stricter_query_string_parser\",\"title\":\"Go back to home page\",\"className\":\"header_iaHeaderLogo__0uNr1\",\"children\":[\"$\",\"img\",null,{\"src\":\"/images/logo.svg\",\"alt\":\"InsertAfter's Logo\"}]}]}]}]}],[\"$\",\"$Lf\",null,{\"locale\":\"blog-toward_stricter_query_string_parser\",\"dictionary\":{\"home\":{\"label\":\"Home\",\"title\":\"Go back to home page\"},\"blog\":{\"label\":\"Blog\",\"title\":\"Read my blog posts\"},\"projects\":{\"label\":\"Projects\",\"title\":\"Discover my projects\"},\"about\":{\"label\":\"About me\",\"title\":\"Read more about me\"}}}],[\"$\",\"$L10\",null,{\"locale\":\"blog-toward_stricter_query_string_parser\"}],[\"$\",\"main\",null,{\"className\":\"layout_iaMain__6s2gl\",\"children\":[\"$\",\"div\",null,{\"children\":[\"$\",\"$L2\",null,{\"parallelRouterKey\":\"children\",\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L3\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]}]}],[\"$\",\"aside\",null,{\"className\":\"social_iaSocial__kdR1x\",\"children\":[\"$\",\"nav\",null,{\"children\":[\"$\",\"ul\",null,{\"children\":[[\"$\",\"li\",null,{\"children\":[\"$\",\"a\",null,{\"href\":\"https://mastodon.social/@nfroidure\",\"rel\":\"me\",\"title\":\"Follow me on Mastodon\",\"className\":\"social_iaSocialMastodon__MTF6o\",\"children\":[\"$\",\"span\",null,{\"children\":\"Mastodon\"}]}]}],[\"$\",\"li\",null,{\"children\":[\"$\",\"a\",null,{\"href\":\"https://bsky.app/profile/nfroidure.bsky.social\",\"rel\":\"me\",\"title\":\"Follow me on Bluesky\",\"className\":\"social_iaSocialBluesky__fKW6M\",\"children\":[\"$\",\"span\",null,{\"children\":\"Bluesky\"}]}]}],[\"$\",\"li\",null,{\"children\":[\"$\",\"a\",null,{\"href\":\"https://github.com/nfroidure\",\"title\":\"See my GitHub projects\",\"className\":\"social_iaSocialGithub__vcU5_\",\"children\":[\"$\",\"span\",null,{\"children\":\"GitHub\"}]}]}],[\"$\",\"li\",null,{\"children\":[\"$\",\"a\",null,{\"href\":\"https://www.npmjs.org/~nfroidure\",\"title\":\"Check my NPM modules\",\"className\":\"social_iaSocialNpm__6nku5\",\"children\":[\"$\",\"span\",null,{\"children\":\"NPM\"}]}]}],[\"$\",\"li\",null,{\"children\":[\"$\",\"a\",null,{\"href\":\"https://www.linkedin.com/in/nfroidure/\",\"rel\":\"me\",\"title\":\"See my LinkedIn profile\",\"className\":\"social_iaSocialLinkedin__pWACO\",\"children\":[\"$\",\"span\",null,{\"children\":\"LinkedIn\"}]}]}],[\"$\",\"li\",null,{\"children\":[\"$\",\"a\",null,{\"href\":\"https://facebook.com/nicolas.froidure.douai\",\"rel\":\"me\",\"title\":\"Follow me on Facebook\",\"className\":\"social_iaSocialFacebook__w4wfH\",\"children\":[\"$\",\"span\",null,{\"children\":\"Facebook\"}]}]}],[\"$\",\"li\",null,{\"children\":[\"$\",\"a\",null,{\"href\":\"/blog-toward_stricter_query_string_parser/blog/index.atom\",\"title\":\"Subscribe to my RSS feed\",\"className\":\"social_iaSocialFeed__gEQQ0\",\"children\":[\"$\",\"span\",null,{\"children\":\"RSS Feed\"}]}]}]]}]}]}],[\"$\",\"footer\",null,{\"className\":\"footer_iaFooter__rhlnQ\",\"children\":[\"$\",\"p\",null,{\"className\":\"footer_iaFooterContent__VZndF\",\"children\":[\"Â© Nicolas Froidure 2012-\",2025]}]}]]}]}]}]\n"])</script><script>self.__next_f.push([1,"a:[[\"$\",\"meta\",\"0\",{\"charSet\":\"utf-8\"}],[\"$\",\"meta\",\"1\",{\"name\":\"viewport\",\"content\":\"width=device-width, initial-scale=1\"}],[\"$\",\"meta\",\"2\",{\"name\":\"theme-color\",\"content\":\"#3e78b2\"}]]\n7:null\n"])</script><script>self.__next_f.push([1,"11:I[6874,[\"874\",\"static/chunks/874-f855e4232fadb1a1.js\",\"96\",\"static/chunks/96-3883dbab65ddc99f.js\",\"779\",\"static/chunks/app/(withLocale)/%5Blocale%5D/%5B...slug%5D/page-f69cf0f70d06d9dc.js\"],\"\"]\n"])</script><script>self.__next_f.push([1,"5:[[\"$\",\"section\",null,{\"className\":\"contentBlock_root__802UK\",\"children\":[[[\"$\",\"h1\",\"0\",{\"className\":\"h1_root__VPXQG\",\"children\":[[\"$\",\"span\",\"0\",{\"children\":\"Toward a stricter query string parser\"}]]}],[\"$\",\"p\",\"1\",{\"className\":\"p_root__SHE_W\",\"children\":[[\"$\",\"strong\",\"0\",{\"className\":\"strong_root__kOzFq\",\"children\":[[\"$\",\"span\",\"0\",{\"children\":\"TL.DR.\"}]]}],[\"$\",\"span\",\"1\",{\"children\":\" Having a stricter query string policy adds value to APIs. Checkout \"}],[\"$\",\"$L11\",\"2\",{\"href\":\"https://github.com/nfroidure/strict-qs\",\"className\":\"a_root__WEPS7\",\"title\":null,\"target\":\"_blank\",\"children\":[null,[[\"$\",\"span\",\"0\",{\"children\":\"strict-qs\"}]]]}],[\"$\",\"span\",\"3\",{\"children\":\".\"}]]}],[\"$\",\"p\",\"2\",{\"className\":\"p_root__SHE_W\",\"children\":[[\"$\",\"span\",\"0\",{\"children\":\"I my journey to the NodeJS HTTP server of my choice, I just reached a new milestone. Indeed, in the ancient ages, when PHP was my language of choice, I made a simple framework called \"}],[\"$\",\"$L11\",\"1\",{\"href\":\"https://github.com/Rest4\",\"className\":\"a_root__WEPS7\",\"title\":null,\"target\":\"_blank\",\"children\":[null,[[\"$\",\"span\",\"0\",{\"children\":\"Rest4\"}]]]}],[\"$\",\"span\",\"2\",{\"children\":\".\"}]]}],[\"$\",\"p\",\"3\",{\"className\":\"p_root__SHE_W\",\"children\":[[\"$\",\"span\",\"0\",{\"children\":\"One of its features was to strictly check for query params types, order and existence. I felt a bit disarmed when I figured out that most NodeJS frameworks follow a non restrictive path when it comes to parse query strings.\"}]]}],[\"$\",\"p\",\"4\",{\"className\":\"p_root__SHE_W\",\"children\":[[\"$\",\"span\",\"0\",{\"children\":\"When no checks are done on query strings, you can end up with a lot of URIs pointing to the same resource. By example, in most applications the following URIs would serve the same resource:\"}]]}],[\"$\",\"ul\",\"5\",{\"className\":\"ul_ul__qh0e9\",\"children\":[[\"$\",\"li\",\"0\",{\"className\":\"li_root__oY9Dv\",\"children\":[[\"$\",\"p\",\"0\",{\"className\":\"p_root__SHE_W\",\"children\":[[\"$\",\"code\",\"0\",{\"className\":\"code_root__5JLV_\",\"children\":\"/articles?q=test\"}],[\"$\",\"span\",\"1\",{\"children\":\",\"}]]}]]}],[\"$\",\"li\",\"1\",{\"className\":\"li_root__oY9Dv\",\"children\":[[\"$\",\"p\",\"0\",{\"className\":\"p_root__SHE_W\",\"children\":[[\"$\",\"code\",\"0\",{\"className\":\"code_root__5JLV_\",\"children\":\"/articles?q=test\u0026page=1\"}],[\"$\",\"span\",\"1\",{\"children\":\",\"}]]}]]}],[\"$\",\"li\",\"2\",{\"className\":\"li_root__oY9Dv\",\"children\":[[\"$\",\"p\",\"0\",{\"className\":\"p_root__SHE_W\",\"children\":[[\"$\",\"code\",\"0\",{\"className\":\"code_root__5JLV_\",\"children\":\"/articles?page=1\u0026q=test\"}],[\"$\",\"span\",\"1\",{\"children\":\",\"}]]}]]}],[\"$\",\"li\",\"3\",{\"className\":\"li_root__oY9Dv\",\"children\":[[\"$\",\"p\",\"0\",{\"className\":\"p_root__SHE_W\",\"children\":[[\"$\",\"code\",\"0\",{\"className\":\"code_root__5JLV_\",\"children\":\"/articles?q=test\u0026page=invalid\"}],[\"$\",\"span\",\"1\",{\"children\":\",\"}]]}]]}],[\"$\",\"li\",\"4\",{\"className\":\"li_root__oY9Dv\",\"children\":[[\"$\",\"p\",\"0\",{\"className\":\"p_root__SHE_W\",\"children\":[[\"$\",\"code\",\"0\",{\"className\":\"code_root__5JLV_\",\"children\":\"/articles?q=test\u0026page\"}],[\"$\",\"span\",\"1\",{\"children\":\",\"}]]}]]}],[\"$\",\"li\",\"5\",{\"className\":\"li_root__oY9Dv\",\"children\":[[\"$\",\"p\",\"0\",{\"className\":\"p_root__SHE_W\",\"children\":[[\"$\",\"code\",\"0\",{\"className\":\"code_root__5JLV_\",\"children\":\"/articles?q=test\u0026page=1\u0026dummy=lol\"}],[\"$\",\"span\",\"1\",{\"children\":\".\"}]]}]]}]]}],[\"$\",\"p\",\"6\",{\"className\":\"p_root__SHE_W\",\"children\":[[\"$\",\"span\",\"0\",{\"children\":\"This has a lot of undesired effects.\"}]]}],[\"$\",\"h2\",\"7\",{\"className\":\"h2_root__Y02lX\",\"children\":[\"$\",\"span\",null,{\"className\":\"anchored_root__HWi6K\",\"children\":[[[\"$\",\"span\",\"0\",{\"children\":\"Content duplication\"}]],\" \",[\"$\",\"small\",null,{\"children\":[\"$\",\"$L11\",null,{\"href\":\"#content-duplication\",\"className\":\"anchored_icon__N5Sem\",\"id\":\"content-duplication\",\"title\":\"Lien vers cette section\",\"children\":[\"$\",\"span\",null,{\"children\":\"ðŸ”—\"}]}]}]]}]}],[\"$\",\"p\",\"8\",{\"className\":\"p_root__SHE_W\",\"children\":[[\"$\",\"span\",\"0\",{\"children\":\"If you are serving webpages you may want to avoid being downgraded in \"}],[\"$\",\"$L11\",\"1\",{\"href\":\"https://support.google.com/webmasters/answer/66359?hl=en\",\"className\":\"a_root__WEPS7\",\"title\":null,\"target\":\"_blank\",\"children\":[null,[[\"$\",\"span\",\"0\",{\"children\":\"search engines\"}]]]}],[\"$\",\"span\",\"2\",{\"children\":\". There are other ways to prevent this but with a strict query string policy it comes out of the box.\"}]]}],[\"$\",\"h2\",\"9\",{\"className\":\"h2_root__Y02lX\",\"children\":[\"$\",\"span\",null,{\"className\":\"anchored_root__HWi6K\",\"children\":[[[\"$\",\"span\",\"0\",{\"children\":\"Harder caching\"}]],\" \",[\"$\",\"small\",null,{\"children\":[\"$\",\"$L11\",null,{\"href\":\"#harder-caching\",\"className\":\"anchored_icon__N5Sem\",\"id\":\"harder-caching\",\"title\":\"Lien vers cette section\",\"children\":[\"$\",\"span\",null,{\"children\":\"ðŸ”—\"}]}]}]]}]}],[\"$\",\"p\",\"10\",{\"className\":\"p_root__SHE_W\",\"children\":[[\"$\",\"span\",\"0\",{\"children\":\"If you want to use the resource URI as a key in a Redis cache to speed up your API, you won't be able to use the URI as is, without being vulnerable to cache flooding.\"}]]}],[\"$\",\"p\",\"11\",{\"className\":\"p_root__SHE_W\",\"children\":[[\"$\",\"span\",\"0\",{\"children\":\"You'll first have to create a canonical URI to store your contents and this extra compute will be done every time you will access your cache. Also public proxies often have their own interpretation of HTTP caching specs, providing unique URIs ensure you a better handling of your HTTP requests by them.\"}]]}],[\"$\",\"h2\",\"12\",{\"className\":\"h2_root__Y02lX\",\"children\":[\"$\",\"span\",null,{\"className\":\"anchored_root__HWi6K\",\"children\":[[[\"$\",\"span\",\"0\",{\"children\":\"Messy logs\"}]],\" \",[\"$\",\"small\",null,{\"children\":[\"$\",\"$L11\",null,{\"href\":\"#messy-logs\",\"className\":\"anchored_icon__N5Sem\",\"id\":\"messy-logs\",\"title\":\"Lien vers cette section\",\"children\":[\"$\",\"span\",null,{\"children\":\"ðŸ”—\"}]}]}]]}]}],[\"$\",\"p\",\"13\",{\"className\":\"p_root__SHE_W\",\"children\":[[\"$\",\"span\",\"0\",{\"children\":\"Logs get harder to reduce/compare/read until you reorder query strings yourself before logging. Even if you do that, your upstream tools (say NGinX, HAProxy, Fastly...) won't take advantage of it.\"}]]}],[\"$\",\"h2\",\"14\",{\"className\":\"h2_root__Y02lX\",\"children\":[\"$\",\"span\",null,{\"className\":\"anchored_root__HWi6K\",\"children\":[[[\"$\",\"span\",\"0\",{\"children\":\"Defensive programming\"}]],\" \",[\"$\",\"small\",null,{\"children\":[\"$\",\"$L11\",null,{\"href\":\"#defensive-programming\",\"className\":\"anchored_icon__N5Sem\",\"id\":\"defensive-programming\",\"title\":\"Lien vers cette section\",\"children\":[\"$\",\"span\",null,{\"children\":\"ðŸ”—\"}]}]}]]}]}],[\"$\",\"p\",\"15\",{\"className\":\"p_root__SHE_W\",\"children\":[[\"$\",\"span\",\"0\",{\"children\":\"Consider the following URI: \"}],[\"$\",\"code\",\"1\",{\"className\":\"code_root__5JLV_\",\"children\":\"/articles?q=test\u0026page=1\u0026page=1\u0026page=1\u0026page=1\"}],[\"$\",\"span\",\"2\",{\"children\":\".\"}]]}],[\"$\",\"p\",\"16\",{\"className\":\"p_root__SHE_W\",\"children\":[[\"$\",\"span\",\"0\",{\"children\":\"With a simple query parser, it will lead to an array of pages which is probably not what you want. It leads to unexpected behavior and lots of attacks are based on it.\"}]]}],[\"$\",\"p\",\"17\",{\"className\":\"p_root__SHE_W\",\"children\":[[\"$\",\"span\",\"0\",{\"children\":\"Just created \"}],[\"$\",\"$L11\",\"1\",{\"href\":\"https://github.com/nfroidure/strict-qs\",\"className\":\"a_root__WEPS7\",\"title\":null,\"target\":\"_blank\",\"children\":[null,[[\"$\",\"span\",\"0\",{\"children\":\"strict-qs\"}]]]}],[\"$\",\"span\",\"2\",{\"children\":\" to match those issues. It simply builds an object whose properties are query parameters of the types you would expect. If you try it, let me know ;).\"}]]}],[\"$\",\"p\",\"18\",{\"className\":\"p_root__SHE_W\",\"children\":[[\"$\",\"span\",\"0\",{\"children\":\"You'll still have to validate it with a JSONSchema validator since I wanted it to do one thing and do it well. There is plenty of JSONSchema validators, I currently use \"}],[\"$\",\"$L11\",\"1\",{\"href\":\"https://github.com/epoberezkin/ajv\",\"className\":\"a_root__WEPS7\",\"title\":null,\"target\":\"_blank\",\"children\":[null,[[\"$\",\"span\",\"0\",{\"children\":\"AJV\"}]]]}],[\"$\",\"span\",\"2\",{\"children\":\".\"}]]}],[\"$\",\"p\",\"19\",{\"className\":\"p_root__SHE_W\",\"children\":[[\"$\",\"span\",\"0\",{\"children\":\"Finally, there is still some work to achieve in order to ensure unicity of paths too. The following URIs would also lead to the same resource: \"}],[\"$\",\"code\",\"1\",{\"className\":\"code_root__5JLV_\",\"children\":\"/articles/1\"}],[\"$\",\"span\",\"2\",{\"children\":\", \"}],[\"$\",\"code\",\"3\",{\"className\":\"code_root__5JLV_\",\"children\":\"/articles/0001\"}],[\"$\",\"span\",\"4\",{\"children\":\", \"}],[\"$\",\"code\",\"5\",{\"className\":\"code_root__5JLV_\",\"children\":\"/articles/1/\"}],[\"$\",\"span\",\"6\",{\"children\":\".\"}]]}],[\"$\",\"p\",\"20\",{\"className\":\"p_root__SHE_W\",\"children\":[[\"$\",\"span\",\"0\",{\"children\":\"I updated \"}],[\"$\",\"$L11\",\"1\",{\"href\":\"https://github.com/nfroidure/siso\",\"className\":\"a_root__WEPS7\",\"title\":null,\"target\":\"_blank\",\"children\":[null,[[\"$\",\"span\",\"0\",{\"children\":\"siso\"}]]]}],[\"$\",\"span\",\"2\",{\"children\":\" to handle this problem too.\"}]]}]],[\"$\",\"p\",null,{\"className\":\"p_root__SHE_W\",\"children\":[\"Published at\",\" \",\"lundi 12 dÃ©cembre 2016 Ã  20:50:52\",\".\"]}]]}],[\"$\",\"section\",null,{\"className\":\"contentBlock_root__802UK\",\"children\":[\"$\",\"aside\",null,{\"className\":\"share_root__Qm_RR\",\"children\":[[\"$\",\"h2\",null,{\"className\":\"h2_root__Y02lX\",\"children\":\"Comment and share\"}],[\"$\",\"p\",null,{\"className\":\"p_root__SHE_W\",\"children\":[[\"$\",\"$L11\",null,{\"href\":\"https://www.facebook.com/dialog/share?display=popup\u0026href=https%3A%2F%2Finsertafter.com%2Fblog%2Ftoward_stricter_query_string_parser\u0026redirect_uri=https%3A%2F%2Finsertafter.com\",\"className\":\"a_root__WEPS7\",\"title\":\"Comment on Facebook\",\"target\":\"_blank\",\"children\":[null,[[\"$\",\"span\",null,{\"className\":\"share_icon__bi4Q3 share_facebook__JKn8d\"}],\"Facebook\"]]}],\" - \",[\"$\",\"$L11\",null,{\"href\":\"https://bsky.app/intent/compose?text=https%3A%2F%2Finsertafter.com%2Fblog%2Ftoward_stricter_query_string_parser\",\"className\":\"a_root__WEPS7\",\"title\":\"Comment on Bluesky\",\"target\":\"_blank\",\"children\":[null,[[\"$\",\"span\",null,{\"className\":\"share_icon__bi4Q3 share_bluesky__ahvrM\"}],\"Bluesky\"]]}],\" - \",[\"$\",\"$L11\",null,{\"href\":\"mailto:nicolas.froidure@gmail.com?subject=Toward%20a%20stricter%20query%20string%20parser\",\"className\":\"a_root__WEPS7\",\"title\":\"Answer via email\",\"target\":\"_self\",\"children\":[null,[[\"$\",\"span\",null,{\"className\":\"share_icon__bi4Q3 share_mail__yvBDK\"}],\"Email\"]]}]]}]]}]}],[\"$\",\"section\",null,{\"className\":\"contentBlock_root__802UK\",\"children\":null}]]\n"])</script><script>self.__next_f.push([1,"8:null\n"])</script><script>self.__next_f.push([1,"c:[[\"$\",\"title\",\"0\",{\"children\":\"Toward a stricter query string parser - Nicolas Froidure\"}],[\"$\",\"meta\",\"1\",{\"name\":\"description\",\"content\":\"With most query string parsers, a lot of URIs can point to the same content. It not only mess you cache system but make your logs less expressive. To avoid those problems I just wrote a stricter query string parser.\"}],[\"$\",\"link\",\"2\",{\"rel\":\"author\",\"href\":\"https://insertafter.com\"}],[\"$\",\"meta\",\"3\",{\"name\":\"author\",\"content\":\"Nicolas Froidure\"}],[\"$\",\"meta\",\"4\",{\"name\":\"robots\",\"content\":\"index, follow\"}],[\"$\",\"link\",\"5\",{\"rel\":\"canonical\",\"href\":\"https://insertafter.com/en/blog/toward_stricter_query_string_parser\"}],[\"$\",\"meta\",\"6\",{\"property\":\"og:title\",\"content\":\"Toward a stricter query string parser - Nicolas Froidure\"}],[\"$\",\"meta\",\"7\",{\"property\":\"og:description\",\"content\":\"With most query string parsers, a lot of URIs can point to the same content. It not only mess you cache system but make your logs less expressive. To avoid those problems I just wrote a stricter query string parser.\"}],[\"$\",\"meta\",\"8\",{\"property\":\"og:url\",\"content\":\"https://insertafter.com/en/blog/toward_stricter_query_string_parser\"}],[\"$\",\"meta\",\"9\",{\"property\":\"og:site_name\",\"content\":\"Nicolas Froidure\"}],[\"$\",\"meta\",\"10\",{\"property\":\"og:locale\",\"content\":\"en_US\"}],[\"$\",\"meta\",\"11\",{\"property\":\"og:image:alt\",\"content\":\"Website banner\"}],[\"$\",\"meta\",\"12\",{\"property\":\"og:image\",\"content\":\"https://insertafter.com/images/banner.png\"}],[\"$\",\"meta\",\"13\",{\"property\":\"og:type\",\"content\":\"article\"}],[\"$\",\"meta\",\"14\",{\"name\":\"twitter:card\",\"content\":\"summary_large_image\"}],[\"$\",\"meta\",\"15\",{\"name\":\"twitter:title\",\"content\":\"Toward a stricter query string parser - Nicolas Froidure\"}],[\"$\",\"meta\",\"16\",{\"name\":\"twitter:description\",\"content\":\"With most query string parsers, a lot of URIs can point to the same content. It not only mess you cache system but make your logs less expressive. To avoid those problems I just wrote a stricter query string parser.\"}],[\"$\",\"meta\",\"17\",{\"name\":\"twitter:image:alt\",\"content\":\"Website banner\"}],[\"$\",\"meta\",\"18\",{\"name\":\"twitter:image\",\"content\":\"https://insertafter.com/images/banner.png\"}],[\"$\",\"link\",\"19\",{\"rel\":\"icon\",\"href\":\"/images/favicon.svg\",\"type\":\"image/svg+xml\",\"sizes\":\"any\"}],[\"$\",\"link\",\"20\",{\"rel\":\"icon\",\"href\":\"/images/favicon-16.png\",\"type\":\"image/png\",\"sizes\":\"16x16\"}],[\"$\",\"link\",\"21\",{\"rel\":\"icon\",\"href\":\"/images/favicon-128.png\",\"type\":\"image/png\",\"sizes\":\"128x128\"}]]\n"])</script></body></html>