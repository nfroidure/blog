<!--VarStream
title=Print your Markdown content with React through AST
description=A journey to printing my blog Markdown contents \
with my custom components.
shortTitle=Markdown AST and React
shortDesc=Discover own I render my markdown content
published=2021-12-01T22:00:00.000Z
lang=en
location=US
keywords.+=JavaScript
keywords.+=TypeScript
keywords.+=React
keywords.+=Markdown
keywords.+=AST
categories.+=.*
disqus=true
-->

<h2>Print your Markdown content with React through AST</h2>
<p>
  If you ever used Contentful, the head-less CMS, chances are that, like I did,
  you ended up <a
    href="https://github.com/nfroidure/douaisis-2021/blob/7c154197556fea1a86744c38a730a9cc21f567aa/utils/contentful.tsx#L131-L160">creating
    some code to map your contentful blocks to your React components</a>.
</p>
<p>
  I found out this approach really neat, but for my own blog,
  I didn't want to use anything else then Markdown files committed
  in my repository.
</p>
<h2>Get a tree from your Markdown</h2>
<p>
  The first thing I start looking for is to have a tree
  from my Markdown files, preferably, something resembling
  the Contenful block tree.
</p>
<p>
  I found out that by combining the <a
    href="https://github.com/nfroidure/politics/blob/main/utils/markdown.tsx#L323-L325">unified and
    remark</a> modules, you end up with something that really looks like
  the Contenful data.
</p>
<h2>Dealing with HTML</h2>
<p>
  The hard part were to deal with the HTML markup. Indeed, it wasn't
  parsed taking in count the start and end of the elements. I had to
  create a recursive algorithm to <a
    href="https://github.com/nfroidure/politics/blob/main/utils/markdown.tsx#L361-L439">wrap it up altogether</a> in
  something
  meaningful. I still have to parse the HTML attributes to have something
  usable for most use cases.
</p>
<h2>Finally, mapping to elements</h2>
<p>
  The <a href="https://github.com/nfroidure/politics/blob/main/utils/markdown.tsx#L327-L342">final rendering
    function</a> is pretty similar to the Contenful one. Never use the <code>dangerouslySetInnerHTML</code>
  method again ;).
</p>
<h2>Neat things</h2>
<p>
  Additionally, I managed to make of all my <code>&lt;h2+&gt;</code>
  titles to have anchors automatically generated so that one can link
  to a <a
    href="https://nicolasfroidure.fr/blog/pour-une-region-actrice-d-un-numerique-humain#une-fuite-en-avant-sans-vision-politique">particular
    section easily (like here with the "Une fuite en avant sans vision politique" title)</a>.
</p>
<p>
  I just had to create a function that retrieve the title text <a
    href="https://github.com/nfroidure/politics/blob/main/utils/markdown.tsx#L344-L359">whatever its
    contents and its depth</a>. And add my <a
    href="https://github.com/nfroidure/politics/blob/main/components/anchored.tsx">anchor</a> component to the <a
    href="https://github.com/nfroidure/politics/blob/main/utils/markdown.tsx#L156-L161">element mapper</a>.
</p>
<p>
  I hope you will enjoy the code, feel free to reuse parts of it in your
  own repos. I'll make a library of it once I get something stable and reusable.
</p>