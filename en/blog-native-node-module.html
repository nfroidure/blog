<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="preload" as="image" href="/images/logo.svg"/><link rel="stylesheet" href="https://insertafter.com/_next/static/css/655a273f6fe37552.css" crossorigin="" data-precedence="next"/><link rel="stylesheet" href="https://insertafter.com/_next/static/css/4909000cd2d942cc.css" crossorigin="" data-precedence="next"/><link rel="preload" as="script" fetchPriority="low" href="https://insertafter.com/_next/static/chunks/webpack-f65a69f5b063a746.js" crossorigin=""/><script src="https://insertafter.com/_next/static/chunks/fd9d1056-5bc70f044f3cb802.js" async="" crossorigin=""></script><script src="https://insertafter.com/_next/static/chunks/938-bf741a2eb8fd4828.js" async="" crossorigin=""></script><script src="https://insertafter.com/_next/static/chunks/main-app-2e6280b5273157a5.js" async="" crossorigin=""></script><script src="https://insertafter.com/_next/static/chunks/176-0a03be62efe5672b.js" async=""></script><script src="https://insertafter.com/_next/static/chunks/app/(withLocale)/%5Blocale%5D/layout-3730889d272dc34b.js" async=""></script><script src="https://insertafter.com/_next/static/chunks/790-a194f74901d33197.js" async=""></script><script src="https://insertafter.com/_next/static/chunks/app/(withLocale)/%5Blocale%5D/%5B...slug%5D/page-b1c29cb9d5f75cce.js" async=""></script><meta name="theme-color" content="#3e78b2"/><title>Create Native NodeJS Modules Fallbacking To Emscripten Ones - Nicolas Froidure</title><meta name="description" content="Suprisingly, creating a native module is not that hard. Making it compile on any platform and gracefully handle compilation fails is a bit more tricky."/><link rel="author" href="https://insertafter.com"/><meta name="author" content="Nicolas Froidure"/><meta name="robots" content="index, follow"/><link rel="canonical" href="https://insertafter.com/en/blog/native-node-module"/><meta property="og:title" content="Create Native NodeJS Modules Fallbacking To Emscripten Ones - Nicolas Froidure"/><meta property="og:description" content="Suprisingly, creating a native module is not that hard. Making it compile on any platform and gracefully handle compilation fails is a bit more tricky."/><meta property="og:url" content="https://insertafter.com/en/blog/native-node-module"/><meta property="og:site_name" content="Nicolas Froidure"/><meta property="og:locale" content="en_US"/><meta property="og:image:alt" content="Website banner"/><meta property="og:image" content="https://insertafter.com/images/banner.png"/><meta property="og:type" content="article"/><meta name="twitter:card" content="summary"/><meta name="twitter:site" content="@nfroidure"/><meta name="twitter:creator" content="@nfroidure"/><meta name="twitter:title" content="Create Native NodeJS Modules Fallbacking To Emscripten Ones - Nicolas Froidure"/><meta name="twitter:description" content="Suprisingly, creating a native module is not that hard. Making it compile on any platform and gracefully handle compilation fails is a bit more tricky."/><meta name="twitter:image:alt" content="Website banner"/><meta name="twitter:image" content="https://insertafter.com/images/banner.png"/><link rel="icon" href="/images/favicon.svg" type="image/svg+xml" sizes="any"/><link rel="icon" href="/images/favicon-16.png" type="image/png" sizes="16x16"/><link rel="icon" href="/images/favicon-128.png" type="image/png" sizes="128x128"/><script src="https://insertafter.com/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js" crossorigin="" noModule=""></script></head><body class="layout_body__jFZuu"><header class="header_iaHeader__4vCMA"><div><h1><a href="/en" title="Go back to home page" class="header_iaHeaderLogo__0uNr1"><img src="/images/logo.svg" alt="InsertAfter&#x27;s Logo"/></a></h1></div></header><nav class="menu_iaMenu__B_rtj"><ul class="menu_iaMenuBody__0Zveq"><li class="menu_iaMenuItem__rOch4"><a href="/en" title="Go back to home page" class="">Home</a></li><li class="menu_iaMenuItem__rOch4"><a href="/en/blog" title="Read my blog posts" class="">Blog</a></li><li class="menu_iaMenuItem__rOch4"><a href="/en/projects" title="Discover my projects" class="">Projects</a></li><li class="menu_iaMenuItem__rOch4"><a href="/en/about" title="Read more about me" class="">About me</a></li></ul></nav><nav class="languages_iaLanguages__K2J3W"><ul><li class="languages_iaLanguagesFlag__ruQ4j languages_iaLanguagesFlagEn__angfJ"><a href="/en"><span>en</span></a></li><li class="languages_iaLanguagesFlag__ruQ4j languages_iaLanguagesFlagFr__Us5Jb languages_selected__w1dKv"><a href="/fr"><span>fr</span></a></li></ul></nav><main class="layout_iaMain__6s2gl"><div><section class="contentBlock_root__802UK"><h1 class="h1_root__VPXQG"><span>Create Native NodeJS Modules Fallbacking To Emscripten Ones</span></h1><hr class="hr_root__iMEe9"/><p class="p_root__SHE_W"><strong class="strong_root__kOzFq"><span>Retrospective note:</span></strong></p><p class="p_root__SHE_W"><span>This article is outdated and here for historical reasons. It was an interesting journey but you will probably find better tools to do the same thing now.</span></p><hr class="hr_root__iMEe9"/><p class="p_root__SHE_W"><span>If you&#x27;re a frontend developer, you probably already heard about icon fonts. If you use the Gulp build tool, you maybe already used </span><a class="a_root__WEPS7" target="_blank" href="https://www.npmjs.com/package/gulp-iconfont"><span>gulp-iconfont</span></a><span>. As its maintainer, when I heard about the WOFF2 font format, I really wanted to get it in output of my gulp plugin.</span></p><p class="p_root__SHE_W"><span>Sadly, there were no JavaScript implementation of it. It was the time for me to dive deeper into NodeJS C++ add-ons and the Emscripten project.</span></p><h2 class="h2_root__Y02lX"><span class="anchored_root__HWi6K"><span>NodeJS C++ add-on: easy!</span> <small><a class="anchored_icon__N5Sem" id="nodejs-c-add-on-easy" title="Lien vers cette section" href="#nodejs-c-add-on-easy"><span>ðŸ”—</span></a></small></span></h2><p class="p_root__SHE_W"><span>Creating a NodeJS add-on was blazing fast. The build system is incredibly well documented and works like a charm.</span></p><p class="p_root__SHE_W"><span>Typically when creating a native add-on you need to create a wrapper written in C++ that glue the library you want to use to the V8 engine. Mine is </span><a class="a_root__WEPS7" target="_blank" href="https://github.com/nfroidure/ttf2woff2/blob/8060224462994f283842c7ff5dec13cb0914376c/csrc/addon.cc"><span>pretty simple</span></a><span>. It indeed wraps the Google&#x27;s </span><a class="a_root__WEPS7" target="_blank" href="https://github.com/google/woff2/blob/09c4eba0f679640ddddfd5315edbb72e4d7d8447/src/woff2%5Fenc.cc#L175"><span>woff2 project</span></a><span> encoding function. This C++ function signature:</span></p><div class="code_root__5JLV_"><code><pre>bool ConvertTTFToWOFF2(
  const uint8_t *data, size_t length,
  uint8_t *result, size_t *result_length
);</pre></code></div><p class="p_root__SHE_W"><span>becomes this NodeJS one:</span></p><p class="p_root__SHE_W"><span>output:Buffer function ttf2woff2(input:Buffer);</span></p><p class="p_root__SHE_W"><span>The most complex work was to figure out how to create a NodeJS Buffer from a C one. Indeed, I had to create a new JavaScript Buffer instance by invoking its global constructor from the C++ code. That way, when no more references to the Buffer will be set in the JS user land, then, it will automatically be garbage collected per the V8 engine avoiding the need to free it manually via another function call.</span></p><p class="p_root__SHE_W"><span>Once the wrapper is made, you just have to create a file named </span><a class="a_root__WEPS7" target="_blank" href="https://github.com/nfroidure/ttf2woff2/blob/8060224462994f283842c7ff5dec13cb0914376c/binding.gyp"><span>binding.gyp</span></a><span> that allows you to specify building instruction for the various compilers. We had to struggle a bit with the MacOSX one since I couldn&#x27;t test by myself.</span></p><p class="p_root__SHE_W"><span>And that&#x27;s it! Your module gets compiled at </span><code class="code_root__5JLV_">npm install</code><span>. In fact, I had to test a few time and correct compilation errors progressively but it was suprisingly fast to get it up and running. For that testing matter I set up a </span><a class="a_root__WEPS7" target="_blank" href="https://github.com/nfroidure/ttf2woff2/blob/8060224462994f283842c7ff5dec13cb0914376c/package.json#L14-L15"><span>few commands</span></a><span> to my </span><code class="code_root__5JLV_">package.json</code><span>.</span></p><p class="p_root__SHE_W"><span>But what about users whose OS can&#x27;t build it? How to not let them down?</span></p><h2 class="h2_root__Y02lX"><span class="anchored_root__HWi6K"><span>Emscripten for the win!</span> <small><a class="anchored_icon__N5Sem" id="emscripten-for-the-win" title="Lien vers cette section" href="#emscripten-for-the-win"><span>ðŸ”—</span></a></small></span></h2><p class="p_root__SHE_W"><span>The Emscripten project allows you to compile C/C++ projects to JavaScript. It was a great chance for me to improve my module quality by fallbacking to such a build.</span></p><p class="p_root__SHE_W"><span>It was a bit harder to get it running. First the Emscripten documentation is really light especially on how to interface your build with your other JavaScript code.</span></p><p class="p_root__SHE_W"><span>I finally managed to </span><a class="a_root__WEPS7" target="_blank" href="https://github.com/nfroidure/ttf2woff2/blob/8060224462994f283842c7ff5dec13cb0914376c/jssrc/index.js"><span>create a wrapper</span></a><span> for it. As you can see, I had to manually manage the allocated memory in the JS wrapper except for the output buffer that I had to free on the C side with a second function call (strange errors happens when trying to free C side allocated memory from the JavaScript module).</span></p><p class="p_root__SHE_W"><span>Once again, I made </span><a class="a_root__WEPS7" target="_blank" href="https://github.com/nfroidure/ttf2woff2/blob/8060224462994f283842c7ff5dec13cb0914376c/package.json#L16-L17"><span>some scripts</span></a><span> to simplify the build. Basically, it query the </span><code class="code_root__5JLV_">binding.gyp</code><span> file with </span><a class="a_root__WEPS7" target="_blank" href="https://github.com/SimpliField/miniquery"><span>miniquery</span></a><span> for the C/C++ files to build, remove the </span><code class="code_root__5JLV_">addon.cc</code><span> one that we do not want and then set it as args to the </span><a class="a_root__WEPS7" target="_blank" href="http://kripken.github.io/emscripten-site/docs/tools%5Freference/emcc.html"><span>emcc</span></a><span> compiler.</span></p><p class="p_root__SHE_W"><span>The output file is basically a JavaScript module that can either be used with NodeJS or in the browser.</span></p><h2 class="h2_root__Y02lX"><span class="anchored_root__HWi6K"><span>Gracefully fail compilation</span> <small><a class="anchored_icon__N5Sem" id="gracefully-fail-compilation" title="Lien vers cette section" href="#gracefully-fail-compilation"><span>ðŸ”—</span></a></small></span></h2><p class="p_root__SHE_W"><span>So, now we have our Emscripten build, let&#x27;s fallback to him when the native NodeJS add-on compilation goes wrong. First, we must ensure that any failure won&#x27;t impeach the module to install. We&#x27;re basically doing this by </span><a class="a_root__WEPS7" target="_blank" href="https://github.com/nfroidure/ttf2woff2/blob/8060224462994f283842c7ff5dec13cb0914376c/package.json#L18"><span>overriding</span></a><span> the default installation script to exit with a 0 code whatever result the compiler gives.</span></p><p class="p_root__SHE_W"><span>Then, as a main JavaScript file we will ensure failing to bind to the native add-on will result in requiring the Emscripten fallback. It is simply done by </span><a class="a_root__WEPS7" target="_blank" href="https://github.com/nfroidure/ttf2woff2/blob/8060224462994f283842c7ff5dec13cb0914376c/src/index.js"><span>catching exceptions</span></a><span> when requiring the bindings.</span></p><p class="p_root__SHE_W"><span>It works! But what about browserifying it?</span></p><h2 class="h2_root__Y02lX"><span class="anchored_root__HWi6K"><span>Browserify</span> <small><a class="anchored_icon__N5Sem" id="browserify" title="Lien vers cette section" href="#browserify"><span>ðŸ”—</span></a></small></span></h2><p class="p_root__SHE_W"><span>In order to allow </span><code class="code_root__5JLV_">gulp-iconfont</code><span> users to preview and download the resulting fonts made with it (and to see if it was feasibleÂ :p), I made a </span><a class="a_root__WEPS7" target="_blank" href="http://nfroidure.github.io/svgiconfont/"><span>full frontend font builder</span></a><span>. So, I immediately tried to use my shinny new module to also output WOFF2 files.</span></p><p class="p_root__SHE_W"><span>The fact is that it doesn&#x27;t work out of the box. Browserify try to add every NodeJS dependencies that appears to be useless when using the Emscripten module on the front-end side.</span></p><p class="p_root__SHE_W"><span>Chances are that Browserify allows to skip the parsing for some files. Plus </span><a class="a_root__WEPS7" target="_blank" href="https://github.com/nfroidure/ttf2woff2/blob/master/jssrc/post.js"><span>a simple trick</span></a><span> to fix the Emscripten require, I&#x27;ve finally been able to make the magic happen.</span></p><p class="p_root__SHE_W"><span>I&#x27;m really impressed by how a C/C++ noob like me have been able to do this in the free time of a few days. If you didn&#x27;t already, you really should have a look at NodeJS native bindings!</span></p><p class="p_root__SHE_W">Published at<!-- --> <!-- -->vendredi 26 juin 2015 Ã  17:50:23<!-- -->.</p></section><section class="contentBlock_root__802UK"><aside class="share_root__Qm_RR"><h2 class="h2_root__Y02lX">Comment and share</h2><p class="p_root__SHE_W"><a class="a_root__WEPS7" title="Comment on Facebook" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Finsertafter.com%2Fblog%2Fnative-node-module"><span class="share_icon__bi4Q3 share_facebook__JKn8d"></span>Facebook</a> - <a class="a_root__WEPS7" title="Comment on Twitter" target="_blank" href="https://twitter.com/intent/tweet/?url=https%3A%2F%2Finsertafter.com%2Fblog%2Fnative-node-module&amp;text=Create%20Native%20NodeJS%20Modules%20Fallbacking%20To%20Emscripten%20Ones&amp;via=nfroidure"><span class="share_icon__bi4Q3 "></span>Twitter</a> - <a class="a_root__WEPS7" title="Answer via email" target="_self" href="mailto:nicolas.froidure@gmail.com"><span class="share_icon__bi4Q3 share_mail__yvBDK"></span>Email</a></p></aside></section><section class="contentBlock_root__802UK"><aside class="page_linkedEntries__jiPuT"><h2 class="h2_root__Y02lX">Similar posts</h2><p class="p_root__SHE_W">In the categories<!-- --> <!-- -->JavaScript<!-- -->.</p><div class="items_entries__5hkLG"><div class="items_entry_item__GWeg7"><h2 class="h2_root__Y02lX items_entry_title__vJ_8h"><a class="a_root__WEPS7 items_entry_link__EtVod" title="Read this blog post" target="_self" href=".//watchdeps">Watching Your NodeJS Projects&#x27;s Dependencies The Easy Way</a></h2><p class="p_root__SHE_W items_entry_description__ZWt9y">Using watchdeps to automagically watch your project&#x27;s dependencies.<!-- --> <br/><a class="a_root__WEPS7" title="Read this blog post" target="_self" href=".//watchdeps">Read the full post</a></p><p class="p_root__SHE_W items_entry_time__iNrot">Published at<!-- --> <!-- -->dimanche 8 mars 2015 Ã  11:07:32<!-- -->.</p><div class="items_clear__3fyGk"></div></div><div class="items_entry_item__GWeg7"><h2 class="h2_root__Y02lX items_entry_title__vJ_8h"><a class="a_root__WEPS7 items_entry_link__EtVod" title="Read this blog post" target="_self" href=".//reaccess">REST API access control with reaccess</a></h2><p class="p_root__SHE_W items_entry_description__ZWt9y">A presentation introducing reaccess an its use on a MEAN stack.<!-- --> <br/><a class="a_root__WEPS7" title="Read this blog post" target="_self" href=".//reaccess">Read the full post</a></p><p class="p_root__SHE_W items_entry_time__iNrot">Published at<!-- --> <!-- -->mercredi 1 octobre 2014 Ã  13:44:58<!-- -->.</p><div class="items_clear__3fyGk"></div></div><div class="items_entry_item__GWeg7"><h2 class="h2_root__Y02lX items_entry_title__vJ_8h"><a class="a_root__WEPS7 items_entry_link__EtVod" title="Read this blog post" target="_self" href=".//jsperf_use_with_caution">Detecting Bad JavaScript Performance Tests On JSPerf</a></h2><p class="p_root__SHE_W items_entry_description__ZWt9y">JSPerf gives us a simple way to write JavaScript performance tests.Unfortunately, tests found aren&#x27;t always well designed. Here&#x27;s how to detect and avoid them.<!-- --> <br/><a class="a_root__WEPS7" title="Read this blog post" target="_self" href=".//jsperf_use_with_caution">Read the full post</a></p><p class="p_root__SHE_W items_entry_time__iNrot">Published at<!-- --> <!-- -->jeudi 6 juin 2013 Ã  18:21:50<!-- -->.</p><div class="items_clear__3fyGk"></div></div></div></aside></section></div></main><aside class="social_iaSocial__kdR1x"><nav><ul><li><a href="https://mastodon.social/@nfroidure" rel="me" title="Follow me on Mastodon" class="social_iaSocialMastodon__MTF6o"><span>Mastodon</span></a></li><li><a href="https://bsky.app/profile/nfroidure.bsky.social" rel="me" title="Follow me on Bluesky" class="social_iaSocialBluesky__fKW6M"><span>Bluesky</span></a></li><li><a href="https://twitter.com/nfroidure" title="Follow me on Twitter" class="social_iaSocialTwitter__9nU6R"><span>Twitter</span></a></li><li><a href="https://github.com/nfroidure" title="See my GitHub projects" class="social_iaSocialGithub__vcU5_"><span>GitHub</span></a></li><li><a href="https://www.npmjs.org/~nfroidure" title="Check my NPM modules" class="social_iaSocialNpm__6nku5"><span>NPM</span></a></li><li><a href="https://www.linkedin.com/in/nfroidure/" rel="me" title="See my LinkedIn profile" class="social_iaSocialLinkedin__pWACO"><span>LinkedIn</span></a></li><li><a href="https://facebook.com/nicolas.froidure.douai" rel="me" title="Follow me on Facebook" class="social_iaSocialFacebook__w4wfH"><span>Facebook</span></a></li><li><a href="/en/blog/index.atom" title="Subscribe to my RSS feed" class="social_iaSocialFeed__gEQQ0"><span>RSS Feed</span></a></li></ul></nav></aside><footer class="footer_iaFooter__rhlnQ"><p class="footer_iaFooterContent__VZndF">Â© Nicolas Froidure 2012-<!-- -->2024</p></footer><script src="https://insertafter.com/_next/static/chunks/webpack-f65a69f5b063a746.js" crossorigin="" async=""></script><script>(self.__next_f=self.__next_f||[]).push([0]);self.__next_f.push([2,null])</script><script>self.__next_f.push([1,"0:\"$L1\"\n"])</script><script>self.__next_f.push([1,"2:HL[\"https://insertafter.com/_next/static/css/655a273f6fe37552.css\",\"style\",{\"crossOrigin\":\"\"}]\n3:HL[\"https://insertafter.com/_next/static/css/4909000cd2d942cc.css\",\"style\",{\"crossOrigin\":\"\"}]\n"])</script><script>self.__next_f.push([1,"4:I[7690,[],\"\"]\n7:I[5613,[],\"\"]\na:I[1778,[],\"\"]\n11:I[8955,[],\"\"]\n8:[\"locale\",\"en\",\"d\"]\n9:[\"slug\",\"blog-native-node-module\",\"c\"]\nc:{\"fontFamily\":\"system-ui,\\\"Segoe UI\\\",Roboto,Helvetica,Arial,sans-serif,\\\"Apple Color Emoji\\\",\\\"Segoe UI Emoji\\\"\",\"height\":\"100vh\",\"textAlign\":\"center\",\"display\":\"flex\",\"flexDirection\":\"column\",\"alignItems\":\"center\",\"justifyContent\":\"center\"}\nd:{\"display\":\"inline-block\",\"margin\":\"0 20px 0 0\",\"padding\":\"0 23px 0 0\",\"fontSize\":24,\"fontWeight\":500,\"verticalAlign\":\"top\",\"lineHeight\":"])</script><script>self.__next_f.push([1,"\"49px\"}\ne:{\"display\":\"inline-block\"}\nf:{\"fontSize\":14,\"fontWeight\":400,\"lineHeight\":\"49px\",\"margin\":0}\n"])</script><script>self.__next_f.push([1,"1:[null,[\"$\",\"$L4\",null,{\"buildId\":\"KvaQf7Occ1_mTQr28YDxi\",\"assetPrefix\":\"https://insertafter.com\",\"initialCanonicalUrl\":\"/en/blog-native-node-module\",\"initialTree\":[\"\",{\"children\":[\"(withLocale)\",{\"children\":[[\"locale\",\"en\",\"d\"],{\"children\":[[\"slug\",\"blog-native-node-module\",\"c\"],{\"children\":[\"__PAGE__?{\\\"locale\\\":\\\"en\\\",\\\"slug\\\":[\\\"blog-native-node-module\\\"]}\",{}]}]},\"$undefined\",\"$undefined\",true]}]}],\"initialSeedData\":[\"\",{\"children\":[\"(withLocale)\",{\"children\":[[\"locale\",\"en\",\"d\"],{\"children\":[[\"slug\",\"blog-native-node-module\",\"c\"],{\"children\":[\"__PAGE__\",{},[\"$L5\",\"$L6\",null]]},[\"$\",\"$L7\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"(withLocale)\",\"children\",\"$8\",\"children\",\"$9\",\"children\"],\"loading\":\"$undefined\",\"loadingStyles\":\"$undefined\",\"loadingScripts\":\"$undefined\",\"hasLoading\":false,\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$La\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"notFoundStyles\":\"$undefined\",\"styles\":[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"https://insertafter.com/_next/static/css/4909000cd2d942cc.css\",\"precedence\":\"next\",\"crossOrigin\":\"\"}]]}]]},[null,\"$Lb\",null]]},[\"$\",\"$L7\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"(withLocale)\",\"children\"],\"loading\":\"$undefined\",\"loadingStyles\":\"$undefined\",\"loadingScripts\":\"$undefined\",\"hasLoading\":false,\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$La\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":[[\"$\",\"title\",null,{\"children\":\"404: This page could not be found.\"}],[\"$\",\"div\",null,{\"style\":{\"fontFamily\":\"system-ui,\\\"Segoe UI\\\",Roboto,Helvetica,Arial,sans-serif,\\\"Apple Color Emoji\\\",\\\"Segoe UI Emoji\\\"\",\"height\":\"100vh\",\"textAlign\":\"center\",\"display\":\"flex\",\"flexDirection\":\"column\",\"alignItems\":\"center\",\"justifyContent\":\"center\"},\"children\":[\"$\",\"div\",null,{\"children\":[[\"$\",\"style\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"body{color:#000;background:#fff;margin:0}.next-error-h1{border-right:1px solid rgba(0,0,0,.3)}@media (prefers-color-scheme:dark){body{color:#fff;background:#000}.next-error-h1{border-right:1px solid rgba(255,255,255,.3)}}\"}}],[\"$\",\"h1\",null,{\"className\":\"next-error-h1\",\"style\":{\"display\":\"inline-block\",\"margin\":\"0 20px 0 0\",\"padding\":\"0 23px 0 0\",\"fontSize\":24,\"fontWeight\":500,\"verticalAlign\":\"top\",\"lineHeight\":\"49px\"},\"children\":\"404\"}],[\"$\",\"div\",null,{\"style\":{\"display\":\"inline-block\"},\"children\":[\"$\",\"h2\",null,{\"style\":{\"fontSize\":14,\"fontWeight\":400,\"lineHeight\":\"49px\",\"margin\":0},\"children\":\"This page could not be found.\"}]}]]}]}]],\"notFoundStyles\":[],\"styles\":[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"https://insertafter.com/_next/static/css/655a273f6fe37552.css\",\"precedence\":\"next\",\"crossOrigin\":\"\"}]]}]]},[\"$\",\"$L7\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\"],\"loading\":\"$undefined\",\"loadingStyles\":\"$undefined\",\"loadingScripts\":\"$undefined\",\"hasLoading\":false,\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$La\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":[[\"$\",\"title\",null,{\"children\":\"404: This page could not be found.\"}],[\"$\",\"div\",null,{\"style\":\"$c\",\"children\":[\"$\",\"div\",null,{\"children\":[[\"$\",\"style\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"body{color:#000;background:#fff;margin:0}.next-error-h1{border-right:1px solid rgba(0,0,0,.3)}@media (prefers-color-scheme:dark){body{color:#fff;background:#000}.next-error-h1{border-right:1px solid rgba(255,255,255,.3)}}\"}}],[\"$\",\"h1\",null,{\"className\":\"next-error-h1\",\"style\":\"$d\",\"children\":\"404\"}],[\"$\",\"div\",null,{\"style\":\"$e\",\"children\":[\"$\",\"h2\",null,{\"style\":\"$f\",\"children\":\"This page could not be found.\"}]}]]}]}]],\"notFoundStyles\":[],\"styles\":null}]],\"initialHead\":[false,\"$L10\"],\"globalErrorComponent\":\"$11\"}]]\n"])</script><script>self.__next_f.push([1,"12:\"$Sreact.strict_mode\"\n13:I[4630,[\"176\",\"static/chunks/176-0a03be62efe5672b.js\",\"960\",\"static/chunks/app/(withLocale)/%5Blocale%5D/layout-3730889d272dc34b.js\"],\"\"]\n14:I[4341,[\"176\",\"static/chunks/176-0a03be62efe5672b.js\",\"960\",\"static/chunks/app/(withLocale)/%5Blocale%5D/layout-3730889d272dc34b.js\"],\"\"]\n"])</script><script>self.__next_f.push([1,"b:[\"$\",\"$12\",null,{\"children\":[\"$\",\"html\",null,{\"lang\":\"en\",\"children\":[\"$\",\"body\",null,{\"className\":\"layout_body__jFZuu\",\"children\":[null,[\"$\",\"header\",null,{\"className\":\"header_iaHeader__4vCMA\",\"children\":[\"$\",\"div\",null,{\"className\":\"$undefined\",\"children\":[\"$\",\"h1\",null,{\"children\":[\"$\",\"a\",null,{\"href\":\"/en\",\"title\":\"Go back to home page\",\"className\":\"header_iaHeaderLogo__0uNr1\",\"children\":[\"$\",\"img\",null,{\"src\":\"/images/logo.svg\",\"alt\":\"InsertAfter's Logo\"}]}]}]}]}],[\"$\",\"$L13\",null,{\"locale\":\"en\",\"dictionary\":{\"home\":{\"label\":\"Home\",\"title\":\"Go back to home page\"},\"blog\":{\"label\":\"Blog\",\"title\":\"Read my blog posts\"},\"projects\":{\"label\":\"Projects\",\"title\":\"Discover my projects\"},\"about\":{\"label\":\"About me\",\"title\":\"Read more about me\"}}}],[\"$\",\"$L14\",null,{\"locale\":\"en\"}],[\"$\",\"main\",null,{\"className\":\"layout_iaMain__6s2gl\",\"children\":[\"$\",\"div\",null,{\"children\":[\"$\",\"$L7\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"(withLocale)\",\"children\",\"$8\",\"children\"],\"loading\":\"$undefined\",\"loadingStyles\":\"$undefined\",\"loadingScripts\":\"$undefined\",\"hasLoading\":false,\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$La\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$L15\",\"notFoundStyles\":[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"https://insertafter.com/_next/static/css/09b5c201fbf055fc.css\",\"precedence\":\"next\",\"crossOrigin\":\"\"}]],\"styles\":null}]}]}],[\"$\",\"aside\",null,{\"className\":\"social_iaSocial__kdR1x\",\"children\":[\"$\",\"nav\",null,{\"children\":[\"$\",\"ul\",null,{\"children\":[[\"$\",\"li\",null,{\"children\":[\"$\",\"a\",null,{\"href\":\"https://mastodon.social/@nfroidure\",\"rel\":\"me\",\"title\":\"Follow me on Mastodon\",\"className\":\"social_iaSocialMastodon__MTF6o\",\"children\":[\"$\",\"span\",null,{\"children\":\"Mastodon\"}]}]}],[\"$\",\"li\",null,{\"children\":[\"$\",\"a\",null,{\"href\":\"https://bsky.app/profile/nfroidure.bsky.social\",\"rel\":\"me\",\"title\":\"Follow me on Bluesky\",\"className\":\"social_iaSocialBluesky__fKW6M\",\"children\":[\"$\",\"span\",null,{\"children\":\"Bluesky\"}]}]}],[\"$\",\"li\",null,{\"children\":[\"$\",\"a\",null,{\"href\":\"https://twitter.com/nfroidure\",\"title\":\"Follow me on Twitter\",\"className\":\"social_iaSocialTwitter__9nU6R\",\"children\":[\"$\",\"span\",null,{\"children\":\"Twitter\"}]}]}],[\"$\",\"li\",null,{\"children\":[\"$\",\"a\",null,{\"href\":\"https://github.com/nfroidure\",\"title\":\"See my GitHub projects\",\"className\":\"social_iaSocialGithub__vcU5_\",\"children\":[\"$\",\"span\",null,{\"children\":\"GitHub\"}]}]}],[\"$\",\"li\",null,{\"children\":[\"$\",\"a\",null,{\"href\":\"https://www.npmjs.org/~nfroidure\",\"title\":\"Check my NPM modules\",\"className\":\"social_iaSocialNpm__6nku5\",\"children\":[\"$\",\"span\",null,{\"children\":\"NPM\"}]}]}],[\"$\",\"li\",null,{\"children\":[\"$\",\"a\",null,{\"href\":\"https://www.linkedin.com/in/nfroidure/\",\"rel\":\"me\",\"title\":\"See my LinkedIn profile\",\"className\":\"social_iaSocialLinkedin__pWACO\",\"children\":[\"$\",\"span\",null,{\"children\":\"LinkedIn\"}]}]}],[\"$\",\"li\",null,{\"children\":[\"$\",\"a\",null,{\"href\":\"https://facebook.com/nicolas.froidure.douai\",\"rel\":\"me\",\"title\":\"Follow me on Facebook\",\"className\":\"social_iaSocialFacebook__w4wfH\",\"children\":[\"$\",\"span\",null,{\"children\":\"Facebook\"}]}]}],[\"$\",\"li\",null,{\"children\":[\"$\",\"a\",null,{\"href\":\"/en/blog/index.atom\",\"title\":\"Subscribe to my RSS feed\",\"className\":\"social_iaSocialFeed__gEQQ0\",\"children\":[\"$\",\"span\",null,{\"children\":\"RSS Feed\"}]}]}]]}]}]}],[\"$\",\"footer\",null,{\"className\":\"footer_iaFooter__rhlnQ\",\"children\":[\"$\",\"p\",null,{\"className\":\"footer_iaFooterContent__VZndF\",\"children\":[\"Â© Nicolas Froidure 2012-\",2024]}]}]]}]}]}]\n"])</script><script>self.__next_f.push([1,"15:[\"$\",\"section\",null,{\"className\":\"contentBlock_root__802UK\",\"children\":[[\"$\",\"h1\",null,{\"className\":\"h1_root__VPXQG\",\"children\":\"Page not found\"}],[\"$\",\"p\",null,{\"className\":\"not-found_p__fvcGn\",\"children\":[[\"$\",\"img\",null,{\"className\":\"not-found_img__IT2jY\",\"src\":\"https://media.giphy.com/media/12mPcp41D9a1i0/giphy.gif\",\"alt\":\"404.png\"}],[\"$\",\"p\",null,{\"className\":\"p_root__SHE_W\",\"children\":\"It seems that the page you look for doesn't exist.\"}]]}]]}]\n"])</script><script>self.__next_f.push([1,"16:I[5250,[\"176\",\"static/chunks/176-0a03be62efe5672b.js\",\"790\",\"static/chunks/790-a194f74901d33197.js\",\"654\",\"static/chunks/app/(withLocale)/%5Blocale%5D/%5B...slug%5D/page-b1c29cb9d5f75cce.js\"],\"\"]\n"])</script><script>self.__next_f.push([1,"6:[[\"$\",\"section\",null,{\"className\":\"contentBlock_root__802UK\",\"children\":[[[\"$\",\"h1\",null,{\"className\":\"h1_root__VPXQG\",\"children\":[[\"$\",\"span\",\"0\",{\"children\":\"Create Native NodeJS Modules Fallbacking To Emscripten Ones\"}]]}],[\"$\",\"hr\",null,{\"className\":\"hr_root__iMEe9\"}],[\"$\",\"p\",null,{\"className\":\"p_root__SHE_W\",\"children\":[[\"$\",\"strong\",null,{\"className\":\"strong_root__kOzFq\",\"children\":[[\"$\",\"span\",\"0\",{\"children\":\"Retrospective note:\"}]]}]]}],[\"$\",\"p\",null,{\"className\":\"p_root__SHE_W\",\"children\":[[\"$\",\"span\",\"0\",{\"children\":\"This article is outdated and here for historical reasons. It was an interesting journey but you will probably find better tools to do the same thing now.\"}]]}],[\"$\",\"hr\",null,{\"className\":\"hr_root__iMEe9\"}],[\"$\",\"p\",null,{\"className\":\"p_root__SHE_W\",\"children\":[[\"$\",\"span\",\"0\",{\"children\":\"If you're a frontend developer, you probably already heard about icon fonts. If you use the Gulp build tool, you maybe already used \"}],[\"$\",\"$L16\",null,{\"href\":\"https://www.npmjs.com/package/gulp-iconfont\",\"className\":\"a_root__WEPS7\",\"title\":null,\"target\":\"_blank\",\"children\":[null,[[\"$\",\"span\",\"0\",{\"children\":\"gulp-iconfont\"}]]]}],[\"$\",\"span\",\"2\",{\"children\":\". As its maintainer, when I heard about the WOFF2 font format, I really wanted to get it in output of my gulp plugin.\"}]]}],[\"$\",\"p\",null,{\"className\":\"p_root__SHE_W\",\"children\":[[\"$\",\"span\",\"0\",{\"children\":\"Sadly, there were no JavaScript implementation of it. It was the time for me to dive deeper into NodeJS C++ add-ons and the Emscripten project.\"}]]}],[\"$\",\"h2\",null,{\"className\":\"h2_root__Y02lX\",\"children\":[\"$\",\"span\",null,{\"className\":\"anchored_root__HWi6K\",\"children\":[[[\"$\",\"span\",\"0\",{\"children\":\"NodeJS C++ add-on: easy!\"}]],\" \",[\"$\",\"small\",null,{\"children\":[\"$\",\"$L16\",null,{\"href\":\"#nodejs-c-add-on-easy\",\"className\":\"anchored_icon__N5Sem\",\"id\":\"nodejs-c-add-on-easy\",\"title\":\"Lien vers cette section\",\"children\":[\"$\",\"span\",null,{\"children\":\"ðŸ”—\"}]}]}]]}]}],[\"$\",\"p\",null,{\"className\":\"p_root__SHE_W\",\"children\":[[\"$\",\"span\",\"0\",{\"children\":\"Creating a NodeJS add-on was blazing fast. The build system is incredibly well documented and works like a charm.\"}]]}],[\"$\",\"p\",null,{\"className\":\"p_root__SHE_W\",\"children\":[[\"$\",\"span\",\"0\",{\"children\":\"Typically when creating a native add-on you need to create a wrapper written in C++ that glue the library you want to use to the V8 engine. Mine is \"}],[\"$\",\"$L16\",null,{\"href\":\"https://github.com/nfroidure/ttf2woff2/blob/8060224462994f283842c7ff5dec13cb0914376c/csrc/addon.cc\",\"className\":\"a_root__WEPS7\",\"title\":null,\"target\":\"_blank\",\"children\":[null,[[\"$\",\"span\",\"0\",{\"children\":\"pretty simple\"}]]]}],[\"$\",\"span\",\"2\",{\"children\":\". It indeed wraps the Google's \"}],[\"$\",\"$L16\",null,{\"href\":\"https://github.com/google/woff2/blob/09c4eba0f679640ddddfd5315edbb72e4d7d8447/src/woff2%5Fenc.cc#L175\",\"className\":\"a_root__WEPS7\",\"title\":null,\"target\":\"_blank\",\"children\":[null,[[\"$\",\"span\",\"0\",{\"children\":\"woff2 project\"}]]]}],[\"$\",\"span\",\"4\",{\"children\":\" encoding function. This C++ function signature:\"}]]}],[\"$\",\"div\",null,{\"className\":\"code_root__5JLV_\",\"children\":[\"$\",\"code\",null,{\"children\":[\"$\",\"pre\",null,{\"children\":\"bool ConvertTTFToWOFF2(\\n  const uint8_t *data, size_t length,\\n  uint8_t *result, size_t *result_length\\n);\"}]}]}],[\"$\",\"p\",null,{\"className\":\"p_root__SHE_W\",\"children\":[[\"$\",\"span\",\"0\",{\"children\":\"becomes this NodeJS one:\"}]]}],[\"$\",\"p\",null,{\"className\":\"p_root__SHE_W\",\"children\":[[\"$\",\"span\",\"0\",{\"children\":\"output:Buffer function ttf2woff2(input:Buffer);\"}]]}],[\"$\",\"p\",null,{\"className\":\"p_root__SHE_W\",\"children\":[[\"$\",\"span\",\"0\",{\"children\":\"The most complex work was to figure out how to create a NodeJS Buffer from a C one. Indeed, I had to create a new JavaScript Buffer instance by invoking its global constructor from the C++ code. That way, when no more references to the Buffer will be set in the JS user land, then, it will automatically be garbage collected per the V8 engine avoiding the need to free it manually via another function call.\"}]]}],[\"$\",\"p\",null,{\"className\":\"p_root__SHE_W\",\"children\":[[\"$\",\"span\",\"0\",{\"children\":\"Once the wrapper is made, you just have to create a file named \"}],[\"$\",\"$L16\",null,{\"href\":\"https://github.com/nfroidure/ttf2woff2/blob/8060224462994f283842c7ff5dec13cb0914376c/binding.gyp\",\"className\":\"a_root__WEPS7\",\"title\":null,\"target\":\"_blank\",\"children\":[null,[[\"$\",\"span\",\"0\",{\"children\":\"binding.gyp\"}]]]}],[\"$\",\"span\",\"2\",{\"children\":\" that allows you to specify building instruction for the various compilers. We had to struggle a bit with the MacOSX one since I couldn't test by myself.\"}]]}],[\"$\",\"p\",null,{\"className\":\"p_root__SHE_W\",\"children\":[[\"$\",\"span\",\"0\",{\"children\":\"And that's it! Your module gets compiled at \"}],[\"$\",\"code\",null,{\"className\":\"code_root__5JLV_\",\"children\":\"npm install\"}],[\"$\",\"span\",\"2\",{\"children\":\". In fact, I had to test a few time and correct compilation errors progressively but it was suprisingly fast to get it up and running. For that testing matter I set up a \"}],[\"$\",\"$L16\",null,{\"href\":\"https://github.com/nfroidure/ttf2woff2/blob/8060224462994f283842c7ff5dec13cb0914376c/package.json#L14-L15\",\"className\":\"a_root__WEPS7\",\"title\":null,\"target\":\"_blank\",\"children\":[null,[[\"$\",\"span\",\"0\",{\"children\":\"few commands\"}]]]}],[\"$\",\"span\",\"4\",{\"children\":\" to my \"}],[\"$\",\"code\",null,{\"className\":\"code_root__5JLV_\",\"children\":\"package.json\"}],[\"$\",\"span\",\"6\",{\"children\":\".\"}]]}],[\"$\",\"p\",null,{\"className\":\"p_root__SHE_W\",\"children\":[[\"$\",\"span\",\"0\",{\"children\":\"But what about users whose OS can't build it? How to not let them down?\"}]]}],[\"$\",\"h2\",null,{\"className\":\"h2_root__Y02lX\",\"children\":[\"$\",\"span\",null,{\"className\":\"anchored_root__HWi6K\",\"children\":[[[\"$\",\"span\",\"0\",{\"children\":\"Emscripten for the win!\"}]],\" \",[\"$\",\"small\",null,{\"children\":[\"$\",\"$L16\",null,{\"href\":\"#emscripten-for-the-win\",\"className\":\"anchored_icon__N5Sem\",\"id\":\"emscripten-for-the-win\",\"title\":\"Lien vers cette section\",\"children\":[\"$\",\"span\",null,{\"children\":\"ðŸ”—\"}]}]}]]}]}],[\"$\",\"p\",null,{\"className\":\"p_root__SHE_W\",\"children\":[[\"$\",\"span\",\"0\",{\"children\":\"The Emscripten project allows you to compile C/C++ projects to JavaScript. It was a great chance for me to improve my module quality by fallbacking to such a build.\"}]]}],[\"$\",\"p\",null,{\"className\":\"p_root__SHE_W\",\"children\":[[\"$\",\"span\",\"0\",{\"children\":\"It was a bit harder to get it running. First the Emscripten documentation is really light especially on how to interface your build with your other JavaScript code.\"}]]}],[\"$\",\"p\",null,{\"className\":\"p_root__SHE_W\",\"children\":[[\"$\",\"span\",\"0\",{\"children\":\"I finally managed to \"}],[\"$\",\"$L16\",null,{\"href\":\"https://github.com/nfroidure/ttf2woff2/blob/8060224462994f283842c7ff5dec13cb0914376c/jssrc/index.js\",\"className\":\"a_root__WEPS7\",\"title\":null,\"target\":\"_blank\",\"children\":[null,[[\"$\",\"span\",\"0\",{\"children\":\"create a wrapper\"}]]]}],[\"$\",\"span\",\"2\",{\"children\":\" for it. As you can see, I had to manually manage the allocated memory in the JS wrapper except for the output buffer that I had to free on the C side with a second function call (strange errors happens when trying to free C side allocated memory from the JavaScript module).\"}]]}],[\"$\",\"p\",null,{\"className\":\"p_root__SHE_W\",\"children\":[[\"$\",\"span\",\"0\",{\"children\":\"Once again, I made \"}],[\"$\",\"$L16\",null,{\"href\":\"https://github.com/nfroidure/ttf2woff2/blob/8060224462994f283842c7ff5dec13cb0914376c/package.json#L16-L17\",\"className\":\"a_root__WEPS7\",\"title\":null,\"target\":\"_blank\",\"children\":[null,[[\"$\",\"span\",\"0\",{\"children\":\"some scripts\"}]]]}],[\"$\",\"span\",\"2\",{\"children\":\" to simplify the build. Basically, it query the \"}],[\"$\",\"code\",null,{\"className\":\"code_root__5JLV_\",\"children\":\"binding.gyp\"}],[\"$\",\"span\",\"4\",{\"children\":\" file with \"}],[\"$\",\"$L16\",null,{\"href\":\"https://github.com/SimpliField/miniquery\",\"className\":\"a_root__WEPS7\",\"title\":null,\"target\":\"_blank\",\"children\":[null,[[\"$\",\"span\",\"0\",{\"children\":\"miniquery\"}]]]}],[\"$\",\"span\",\"6\",{\"children\":\" for the C/C++ files to build, remove the \"}],[\"$\",\"code\",null,{\"className\":\"code_root__5JLV_\",\"children\":\"addon.cc\"}],[\"$\",\"span\",\"8\",{\"children\":\" one that we do not want and then set it as args to the \"}],[\"$\",\"$L16\",null,{\"href\":\"http://kripken.github.io/emscripten-site/docs/tools%5Freference/emcc.html\",\"className\":\"a_root__WEPS7\",\"title\":null,\"target\":\"_blank\",\"children\":[null,[[\"$\",\"span\",\"0\",{\"children\":\"emcc\"}]]]}],[\"$\",\"span\",\"10\",{\"children\":\" compiler.\"}]]}],[\"$\",\"p\",null,{\"className\":\"p_root__SHE_W\",\"children\":[[\"$\",\"span\",\"0\",{\"children\":\"The output file is basically a JavaScript module that can either be used with NodeJS or in the browser.\"}]]}],[\"$\",\"h2\",null,{\"className\":\"h2_root__Y02lX\",\"children\":[\"$\",\"span\",null,{\"className\":\"anchored_root__HWi6K\",\"children\":[[[\"$\",\"span\",\"0\",{\"children\":\"Gracefully fail compilation\"}]],\" \",[\"$\",\"small\",null,{\"children\":[\"$\",\"$L16\",null,{\"href\":\"#gracefully-fail-compilation\",\"className\":\"anchored_icon__N5Sem\",\"id\":\"gracefully-fail-compilation\",\"title\":\"Lien vers cette section\",\"children\":[\"$\",\"span\",null,{\"children\":\"ðŸ”—\"}]}]}]]}]}],[\"$\",\"p\",null,{\"className\":\"p_root__SHE_W\",\"children\":[[\"$\",\"span\",\"0\",{\"children\":\"So, now we have our Emscripten build, let's fallback to him when the native NodeJS add-on compilation goes wrong. First, we must ensure that any failure won't impeach the module to install. We're basically doing this by \"}],[\"$\",\"$L16\",null,{\"href\":\"https://github.com/nfroidure/ttf2woff2/blob/8060224462994f283842c7ff5dec13cb0914376c/package.json#L18\",\"className\":\"a_root__WEPS7\",\"title\":null,\"target\":\"_blank\",\"children\":[null,[[\"$\",\"span\",\"0\",{\"children\":\"overriding\"}]]]}],[\"$\",\"span\",\"2\",{\"children\":\" the default installation script to exit with a 0 code whatever result the compiler gives.\"}]]}],[\"$\",\"p\",null,{\"className\":\"p_root__SHE_W\",\"children\":[[\"$\",\"span\",\"0\",{\"children\":\"Then, as a main JavaScript file we will ensure failing to bind to the native add-on will result in requiring the Emscripten fallback. It is simply done by \"}],[\"$\",\"$L16\",null,{\"href\":\"https://github.com/nfroidure/ttf2woff2/blob/8060224462994f283842c7ff5dec13cb0914376c/src/index.js\",\"className\":\"a_root__WEPS7\",\"title\":null,\"target\":\"_blank\",\"children\":[null,[[\"$\",\"span\",\"0\",{\"children\":\"catching exceptions\"}]]]}],[\"$\",\"span\",\"2\",{\"children\":\" when requiring the bindings.\"}]]}],[\"$\",\"p\",null,{\"className\":\"p_root__SHE_W\",\"children\":[[\"$\",\"span\",\"0\",{\"children\":\"It works! But what about browserifying it?\"}]]}],[\"$\",\"h2\",null,{\"className\":\"h2_root__Y02lX\",\"children\":[\"$\",\"span\",null,{\"className\":\"anchored_root__HWi6K\",\"children\":[[[\"$\",\"span\",\"0\",{\"children\":\"Browserify\"}]],\" \",[\"$\",\"small\",null,{\"children\":[\"$\",\"$L16\",null,{\"href\":\"#browserify\",\"className\":\"anchored_icon__N5Sem\",\"id\":\"browserify\",\"title\":\"Lien vers cette section\",\"children\":[\"$\",\"span\",null,{\"children\":\"ðŸ”—\"}]}]}]]}]}],[\"$\",\"p\",null,{\"className\":\"p_root__SHE_W\",\"children\":[[\"$\",\"span\",\"0\",{\"children\":\"In order to allow \"}],[\"$\",\"code\",null,{\"className\":\"code_root__5JLV_\",\"children\":\"gulp-iconfont\"}],[\"$\",\"span\",\"2\",{\"children\":\" users to preview and download the resulting fonts made with it (and to see if it was feasibleÂ :p), I made a \"}],[\"$\",\"$L16\",null,{\"href\":\"http://nfroidure.github.io/svgiconfont/\",\"className\":\"a_root__WEPS7\",\"title\":null,\"target\":\"_blank\",\"children\":[null,[[\"$\",\"span\",\"0\",{\"children\":\"full frontend font builder\"}]]]}],[\"$\",\"span\",\"4\",{\"children\":\". So, I immediately tried to use my shinny new module to also output WOFF2 files.\"}]]}],[\"$\",\"p\",null,{\"className\":\"p_root__SHE_W\",\"children\":[[\"$\",\"span\",\"0\",{\"children\":\"The fact is that it doesn't work out of the box. Browserify try to add every NodeJS dependencies that appears to be useless when using the Emscripten module on the front-end side.\"}]]}],[\"$\",\"p\",null,{\"className\":\"p_root__SHE_W\",\"children\":[[\"$\",\"span\",\"0\",{\"children\":\"Chances are that Browserify allows to skip the parsing for some files. Plus \"}],[\"$\",\"$L16\",null,{\"href\":\"https://github.com/nfroidure/ttf2woff2/blob/master/jssrc/post.js\",\"className\":\"a_root__WEPS7\",\"title\":null,\"target\":\"_blank\",\"children\":[null,[[\"$\",\"span\",\"0\",{\"children\":\"a simple trick\"}]]]}],[\"$\",\"span\",\"2\",{\"children\":\" to fix the Emscripten require, I've finally been able to make the magic happen.\"}]]}],[\"$\",\"p\",null,{\"className\":\"p_root__SHE_W\",\"children\":[[\"$\",\"span\",\"0\",{\"children\":\"I'm really impressed by how a C/C++ noob like me have been able to do this in the free time of a few days. If you didn't already, you really should have a look at NodeJS native bindings!\"}]]}]],[\"$\",\"p\",null,{\"className\":\"p_root__SHE_W\",\"children\":[\"Published at\",\" \",\"vendredi 26 juin 2015 Ã  17:50:23\",\".\"]}]]}],[\"$\",\"section\",null,{\"className\":\"contentBlock_root__802UK\",\"children\":[\"$\",\"aside\",null,{\"className\":\"share_root__Qm_RR\",\"children\":[[\"$\",\"h2\",null,{\"className\":\"h2_root__Y02lX\",\"children\":\"Comment and share\"}],[\"$\",\"p\",null,{\"className\":\"p_root__SHE_W\",\"children\":[[\"$\",\"$L16\",null,{\"href\":\"https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Finsertafter.com%2Fblog%2Fnative-node-module\",\"className\":\"a_root__WEPS7\",\"title\":\"Comment on Facebook\",\"target\":\"_blank\",\"children\":[null,[[\"$\",\"span\",null,{\"className\":\"share_icon__bi4Q3 share_facebook__JKn8d\"}],\"Facebook\"]]}],\" - \",[\"$\",\"$L16\",null,{\"href\":\"https://twitter.com/intent/tweet/?url=https%3A%2F%2Finsertafter.com%2Fblog%2Fnative-node-module\u0026text=Create%20Native%20NodeJS%20Modules%20Fallbacking%20To%20Emscripten%20Ones\u0026via=nfroidure\",\"className\":\"a_root__WEPS7\",\"title\":\"Comment on Twitter\",\"target\":\"_blank\",\"children\":[null,[[\"$\",\"span\",null,{\"className\":\"share_icon__bi4Q3 \"}],\"Twitter\"]]}],\" - \",[\"$\",\"$L16\",null,{\"href\":\"mailto:nicolas.froidure@gmail.com\",\"className\":\"a_root__WEPS7\",\"title\":\"Answer via email\",\"target\":\"_self\",\"children\":[null,[[\"$\",\"span\",null,{\"className\":\"share_icon__bi4Q3 share_mail__yvBDK\"}],\"Email\"]]}]]}]]}]}],[\"$\",\"section\",null,{\"className\":\"contentBlock_root__802UK\",\"children\":[\"$\",\"aside\",null,{\"className\":\"page_linkedEntries__jiPuT\",\"children\":[[\"$\",\"h2\",null,{\"className\":\"h2_root__Y02lX\",\"children\":\"Similar posts\"}],[\"$\",\"p\",null,{\"className\":\"p_root__SHE_W\",\"children\":[\"In the categories\",\" \",\"JavaScript\",\".\"]}],[\"$\",\"div\",null,{\"className\":\"items_entries__5hkLG\",\"children\":[[\"$\",\"div\",\"watchdeps\",{\"className\":\"items_entry_item__GWeg7\",\"children\":[null,[\"$\",\"h2\",null,{\"className\":\"h2_root__Y02lX items_entry_title__vJ_8h\",\"children\":[\"$\",\"$L16\",null,{\"href\":\".//watchdeps\",\"className\":\"a_root__WEPS7 items_entry_link__EtVod\",\"title\":\"Read this blog post\",\"target\":\"_self\",\"children\":[null,\"Watching Your NodeJS Projects's Dependencies The Easy Way\"]}]}],[\"$\",\"p\",null,{\"className\":\"p_root__SHE_W items_entry_description__ZWt9y\",\"children\":[\"Using watchdeps to automagically watch your project's dependencies.\",\" \",[\"$\",\"br\",null,{}],[\"$\",\"$L16\",null,{\"href\":\".//watchdeps\",\"className\":\"a_root__WEPS7\",\"title\":\"Read this blog post\",\"target\":\"_self\",\"children\":[null,\"Read the full post\"]}]]}],[\"$\",\"p\",null,{\"className\":\"p_root__SHE_W items_entry_time__iNrot\",\"children\":[\"Published at\",\" \",\"dimanche 8 mars 2015 Ã  11:07:32\",\".\"]}],[\"$\",\"div\",null,{\"className\":\"items_clear__3fyGk\"}]]}],[\"$\",\"div\",\"reaccess\",{\"className\":\"items_entry_item__GWeg7\",\"children\":[null,[\"$\",\"h2\",null,{\"className\":\"h2_root__Y02lX items_entry_title__vJ_8h\",\"children\":[\"$\",\"$L16\",null,{\"href\":\".//reaccess\",\"className\":\"a_root__WEPS7 items_entry_link__EtVod\",\"title\":\"Read this blog post\",\"target\":\"_self\",\"children\":[null,\"REST API access control with reaccess\"]}]}],[\"$\",\"p\",null,{\"className\":\"p_root__SHE_W items_entry_description__ZWt9y\",\"children\":[\"A presentation introducing reaccess an its use on a MEAN stack.\",\" \",[\"$\",\"br\",null,{}],[\"$\",\"$L16\",null,{\"href\":\".//reaccess\",\"className\":\"a_root__WEPS7\",\"title\":\"Read this blog post\",\"target\":\"_self\",\"children\":[null,\"Read the full post\"]}]]}],[\"$\",\"p\",null,{\"className\":\"p_root__SHE_W items_entry_time__iNrot\",\"children\":[\"Published at\",\" \",\"mercredi 1 octobre 2014 Ã  13:44:58\",\".\"]}],[\"$\",\"div\",null,{\"className\":\"items_clear__3fyGk\"}]]}],[\"$\",\"div\",\"jsperf_use_with_caution\",{\"className\":\"items_entry_item__GWeg7\",\"children\":[null,[\"$\",\"h2\",null,{\"className\":\"h2_root__Y02lX items_entry_title__vJ_8h\",\"children\":[\"$\",\"$L16\",null,{\"href\":\".//jsperf_use_with_caution\",\"className\":\"a_root__WEPS7 items_entry_link__EtVod\",\"title\":\"Read this blog post\",\"target\":\"_self\",\"children\":[null,\"Detecting Bad JavaScript Performance Tests On JSPerf\"]}]}],[\"$\",\"p\",null,{\"className\":\"p_root__SHE_W items_entry_description__ZWt9y\",\"children\":[\"JSPerf gives us a simple way to write JavaScript performance tests.Unfortunately, tests found aren't always well designed. Here's how to detect and avoid them.\",\" \",[\"$\",\"br\",null,{}],[\"$\",\"$L16\",null,{\"href\":\".//jsperf_use_with_caution\",\"className\":\"a_root__WEPS7\",\"title\":\"Read this blog post\",\"target\":\"_self\",\"children\":[null,\"Read the full post\"]}]]}],[\"$\",\"p\",null,{\"className\":\"p_root__SHE_W items_entry_time__iNrot\",\"children\":[\"Published at\",\" \",\"jeudi 6 juin 2013 Ã  18:21:50\",\".\"]}],[\"$\",\"div\",null,{\"className\":\"items_clear__3fyGk\"}]]}]]}]]}]}]]\n"])</script><script>self.__next_f.push([1,"10:[[\"$\",\"meta\",\"0\",{\"name\":\"viewport\",\"content\":\"width=device-width, initial-scale=1\"}],[\"$\",\"meta\",\"1\",{\"name\":\"theme-color\",\"content\":\"#3e78b2\"}],[\"$\",\"meta\",\"2\",{\"charSet\":\"utf-8\"}],[\"$\",\"title\",\"3\",{\"children\":\"Create Native NodeJS Modules Fallbacking To Emscripten Ones - Nicolas Froidure\"}],[\"$\",\"meta\",\"4\",{\"name\":\"description\",\"content\":\"Suprisingly, creating a native module is not that hard. Making it compile on any platform and gracefully handle compilation fails is a bit more tricky.\"}],[\"$\",\"link\",\"5\",{\"rel\":\"author\",\"href\":\"https://insertafter.com\"}],[\"$\",\"meta\",\"6\",{\"name\":\"author\",\"content\":\"Nicolas Froidure\"}],[\"$\",\"meta\",\"7\",{\"name\":\"robots\",\"content\":\"index, follow\"}],[\"$\",\"link\",\"8\",{\"rel\":\"canonical\",\"href\":\"https://insertafter.com/en/blog/native-node-module\"}],[\"$\",\"meta\",\"9\",{\"property\":\"og:title\",\"content\":\"Create Native NodeJS Modules Fallbacking To Emscripten Ones - Nicolas Froidure\"}],[\"$\",\"meta\",\"10\",{\"property\":\"og:description\",\"content\":\"Suprisingly, creating a native module is not that hard. Making it compile on any platform and gracefully handle compilation fails is a bit more tricky.\"}],[\"$\",\"meta\",\"11\",{\"property\":\"og:url\",\"content\":\"https://insertafter.com/en/blog/native-node-module\"}],[\"$\",\"meta\",\"12\",{\"property\":\"og:site_name\",\"content\":\"Nicolas Froidure\"}],[\"$\",\"meta\",\"13\",{\"property\":\"og:locale\",\"content\":\"en_US\"}],[\"$\",\"meta\",\"14\",{\"property\":\"og:image:alt\",\"content\":\"Website banner\"}],[\"$\",\"meta\",\"15\",{\"property\":\"og:image\",\"content\":\"https://insertafter.com/images/banner.png\"}],[\"$\",\"meta\",\"16\",{\"property\":\"og:type\",\"content\":\"article\"}],[\"$\",\"meta\",\"17\",{\"name\":\"twitter:card\",\"content\":\"summary\"}],[\"$\",\"meta\",\"18\",{\"name\":\"twitter:site\",\"content\":\"@nfroidure\"}],[\"$\",\"meta\",\"19\",{\"name\":\"twitter:creator\",\"content\":\"@nfroidure\"}],[\"$\",\"meta\",\"20\",{\"name\":\"twitter:title\",\"content\":\"Create Native NodeJS Modules Fallbacking To Emscripten Ones - Nicolas Froidure\"}],[\"$\",\"meta\",\"21\",{\"name\":\"twitter:description\",\"content\":\"Suprisingly, creating a native module is not that hard. Making it compile on any platform and gracefully handle compilation fails is a bit more tricky.\"}],[\"$\",\"meta\",\"22\",{\"name\":\"twitter:image:alt\",\"content\":\"Website banner\"}],[\"$\",\"meta\",\"23\",{\"name\":\"twitter:image\",\"content\":\"https://insertafter.com/images/banner.png\"}],[\"$\",\"link\",\"24\",{\"rel\":\"icon\",\"href\":\"/images/favicon.svg\",\"type\":\"image/svg+xml\",\"sizes\":\"any\"}],[\"$\",\"link\",\"25\",{\"rel\":\"icon\",\"href\":\"/images/favicon-16.png\",\"type\":\"image/png\",\"sizes\":\"16x16\"}],[\"$\",\"link\",\"26\",{\"rel\":\"icon\",\"href\":\"/images/favicon-128.png\",\"type\":\"image/png\",\"sizes\":\"128x128\"}]]\n"])</script><script>self.__next_f.push([1,"5:null\n"])</script><script>self.__next_f.push([1,""])</script></body></html>