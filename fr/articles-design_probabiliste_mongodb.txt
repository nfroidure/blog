3:I[5613,[],""]
6:I[1778,[],""]
4:["locale","fr","d"]
5:["slug","articles-design_probabiliste_mongodb","oc"]
8:{"fontFamily":"system-ui,\"Segoe UI\",Roboto,Helvetica,Arial,sans-serif,\"Apple Color Emoji\",\"Segoe UI Emoji\"","height":"100vh","textAlign":"center","display":"flex","flexDirection":"column","alignItems":"center","justifyContent":"center"}
9:{"display":"inline-block","margin":"0 20px 0 0","padding":"0 23px 0 0","fontSize":24,"fontWeight":500,"verticalAlign":"top","lineHeight":"49px"}
a:{"display":"inline-block"}
b:{"fontSize":14,"fontWeight":400,"lineHeight":"49px","margin":0}
0:["0iMe3vHKCcHPUIZbS85nF",[[["",{"children":["(withLocale)",{"children":[["locale","fr","d"],{"children":[["slug","articles-design_probabiliste_mongodb","oc"],{"children":["__PAGE__?{\"locale\":\"fr\",\"slug\":[\"articles-design_probabiliste_mongodb\"]}",{}]}]},"$undefined","$undefined",true]}]}],["",{"children":["(withLocale)",{"children":[["locale","fr","d"],{"children":[["slug","articles-design_probabiliste_mongodb","oc"],{"children":["__PAGE__",{},["$L1","$L2",null]]},["$","$L3",null,{"parallelRouterKey":"children","segmentPath":["children","(withLocale)","children","$4","children","$5","children"],"loading":"$undefined","loadingStyles":"$undefined","loadingScripts":"$undefined","hasLoading":false,"error":"$undefined","errorStyles":"$undefined","errorScripts":"$undefined","template":["$","$L6",null,{}],"templateStyles":"$undefined","templateScripts":"$undefined","notFound":"$undefined","notFoundStyles":"$undefined","styles":[["$","link","0",{"rel":"stylesheet","href":"https://insertafter.com/_next/static/css/cd8d1ff5c688cf4d.css","precedence":"next","crossOrigin":""}]]}]]},[null,"$L7",null]]},["$","$L3",null,{"parallelRouterKey":"children","segmentPath":["children","(withLocale)","children"],"loading":"$undefined","loadingStyles":"$undefined","loadingScripts":"$undefined","hasLoading":false,"error":"$undefined","errorStyles":"$undefined","errorScripts":"$undefined","template":["$","$L6",null,{}],"templateStyles":"$undefined","templateScripts":"$undefined","notFound":[["$","title",null,{"children":"404: This page could not be found."}],["$","div",null,{"style":{"fontFamily":"system-ui,\"Segoe UI\",Roboto,Helvetica,Arial,sans-serif,\"Apple Color Emoji\",\"Segoe UI Emoji\"","height":"100vh","textAlign":"center","display":"flex","flexDirection":"column","alignItems":"center","justifyContent":"center"},"children":["$","div",null,{"children":[["$","style",null,{"dangerouslySetInnerHTML":{"__html":"body{color:#000;background:#fff;margin:0}.next-error-h1{border-right:1px solid rgba(0,0,0,.3)}@media (prefers-color-scheme:dark){body{color:#fff;background:#000}.next-error-h1{border-right:1px solid rgba(255,255,255,.3)}}"}}],["$","h1",null,{"className":"next-error-h1","style":{"display":"inline-block","margin":"0 20px 0 0","padding":"0 23px 0 0","fontSize":24,"fontWeight":500,"verticalAlign":"top","lineHeight":"49px"},"children":"404"}],["$","div",null,{"style":{"display":"inline-block"},"children":["$","h2",null,{"style":{"fontSize":14,"fontWeight":400,"lineHeight":"49px","margin":0},"children":"This page could not be found."}]}]]}]}]],"notFoundStyles":[],"styles":[["$","link","0",{"rel":"stylesheet","href":"https://insertafter.com/_next/static/css/655a273f6fe37552.css","precedence":"next","crossOrigin":""}]]}]]},["$","$L3",null,{"parallelRouterKey":"children","segmentPath":["children"],"loading":"$undefined","loadingStyles":"$undefined","loadingScripts":"$undefined","hasLoading":false,"error":"$undefined","errorStyles":"$undefined","errorScripts":"$undefined","template":["$","$L6",null,{}],"templateStyles":"$undefined","templateScripts":"$undefined","notFound":[["$","title",null,{"children":"404: This page could not be found."}],["$","div",null,{"style":"$8","children":["$","div",null,{"children":[["$","style",null,{"dangerouslySetInnerHTML":{"__html":"body{color:#000;background:#fff;margin:0}.next-error-h1{border-right:1px solid rgba(0,0,0,.3)}@media (prefers-color-scheme:dark){body{color:#fff;background:#000}.next-error-h1{border-right:1px solid rgba(255,255,255,.3)}}"}}],["$","h1",null,{"className":"next-error-h1","style":"$9","children":"404"}],["$","div",null,{"style":"$a","children":["$","h2",null,{"style":"$b","children":"This page could not be found."}]}]]}]}]],"notFoundStyles":[],"styles":null}]],[null,"$Lc"]]]]
d:"$Sreact.strict_mode"
e:I[4630,["176","static/chunks/176-0a03be62efe5672b.js","960","static/chunks/app/(withLocale)/%5Blocale%5D/layout-3730889d272dc34b.js"],""]
f:I[4341,["176","static/chunks/176-0a03be62efe5672b.js","960","static/chunks/app/(withLocale)/%5Blocale%5D/layout-3730889d272dc34b.js"],""]
7:["$","$d",null,{"children":["$","html",null,{"lang":"fr","children":["$","body",null,{"className":"layout_body__jFZuu","children":[null,["$","header",null,{"className":"header_iaHeader__4vCMA","children":["$","div",null,{"className":"$undefined","children":["$","h1",null,{"children":["$","a",null,{"href":"/fr","title":"Retour à l’accueil","className":"header_iaHeaderLogo__0uNr1","children":["$","img",null,{"src":"/images/logo.svg","alt":"Logo d’InsertAfter"}]}]}]}]}],["$","$Le",null,{"locale":"fr","dictionary":{"home":{"label":"Accueil","title":"Retour à l’accueil"},"blog":{"label":"Blog","title":"Retour à l’index du blog"},"projects":{"label":"Projets","title":"Découvrir mes divers projets"},"about":{"label":"À propos","title":"En savoir plus à mon sujet"}}}],["$","$Lf",null,{"locale":"fr"}],["$","main",null,{"className":"layout_iaMain__6s2gl","children":["$","div",null,{"children":["$","$L3",null,{"parallelRouterKey":"children","segmentPath":["children","(withLocale)","children","$4","children"],"loading":"$undefined","loadingStyles":"$undefined","loadingScripts":"$undefined","hasLoading":false,"error":"$undefined","errorStyles":"$undefined","errorScripts":"$undefined","template":["$","$L6",null,{}],"templateStyles":"$undefined","templateScripts":"$undefined","notFound":"$L10","notFoundStyles":[["$","link","0",{"rel":"stylesheet","href":"https://insertafter.com/_next/static/css/719d59f1b635ba1d.css","precedence":"next","crossOrigin":""}]],"styles":null}]}]}],["$","aside",null,{"className":"social_iaSocial__kdR1x","children":["$","nav",null,{"children":["$","ul",null,{"children":[["$","li",null,{"children":["$","a",null,{"href":"https://mastodon.social/@nfroidure","rel":"me","title":"Me suivre sur Mastodon","className":"social_iaSocialMastodon__MTF6o","children":["$","span",null,{"children":"Mastodon"}]}]}],["$","li",null,{"children":["$","a",null,{"href":"https://bsky.app/profile/nfroidure.bsky.social","rel":"me","title":"Me suivre sur Bluesky","className":"social_iaSocialBluesky__fKW6M","children":["$","span",null,{"children":"Bluesky"}]}]}],["$","li",null,{"children":["$","a",null,{"href":"https://twitter.com/nfroidure","title":"Me suivre sur Twitter","className":"social_iaSocialTwitter__9nU6R","children":["$","span",null,{"children":"Twitter"}]}]}],["$","li",null,{"children":["$","a",null,{"href":"https://github.com/nfroidure","title":"Voir mes projets sur GitHub","className":"social_iaSocialGithub__vcU5_","children":["$","span",null,{"children":"GitHub"}]}]}],["$","li",null,{"children":["$","a",null,{"href":"https://www.npmjs.org/~nfroidure","title":"Voir mon compte NPM","className":"social_iaSocialNpm__6nku5","children":["$","span",null,{"children":"NPM"}]}]}],["$","li",null,{"children":["$","a",null,{"href":"https://www.linkedin.com/in/nfroidure/","rel":"me","title":"Voir mon profil LinkedIn","className":"social_iaSocialLinkedin__pWACO","children":["$","span",null,{"children":"LinkedIn"}]}]}],["$","li",null,{"children":["$","a",null,{"href":"https://facebook.com/nicolas.froidure.douai","rel":"me","title":"Me suivre sur Facebook","className":"social_iaSocialFacebook__w4wfH","children":["$","span",null,{"children":"Facebook"}]}]}],["$","li",null,{"children":["$","a",null,{"href":"/fr/blog/index.atom","title":"S’abonner au flux RSS","className":"social_iaSocialFeed__gEQQ0","children":["$","span",null,{"children":"Flux RSS"}]}]}]]}]}]}],["$","footer",null,{"className":"footer_iaFooter__rhlnQ","children":["$","p",null,{"className":"footer_iaFooterContent__VZndF","children":["© Nicolas Froidure 2012-",2024]}]}]]}]}]}]
10:["$","section",null,{"className":"contentBlock_root__802UK","children":[["$","h1",null,{"className":"h1_root__VPXQG","children":"Page not found"}],["$","p",null,{"className":"not-found_p__fvcGn","children":[["$","img",null,{"className":"not-found_img__IT2jY","src":"https://media.giphy.com/media/12mPcp41D9a1i0/giphy.gif","alt":"404.png"}],["$","p",null,{"className":"p_root__SHE_W","children":"It seems that the page you look for doesn't exist."}]]}]]}]
11:I[5250,["176","static/chunks/176-0a03be62efe5672b.js","790","static/chunks/790-a194f74901d33197.js","730","static/chunks/app/(withLocale)/%5Blocale%5D/%5B%5B...slug%5D%5D/page-992952bac383cfc2.js"],""]
12:T54d,// Récupération des identifiants des lieux de l'utilisateur
db.users.find(
  {
    query: {
      _id: ObjectId("abbacacaabbacacaabbacacaabbacaca"),
    },
    fields: ["locations_ids"],
  },
  function (err, results) {
    var locationsIds = results[0].locations_ids;
    // Récupération des lieux
    db.locations.find(
      {
        query: {
          _id: {
            $in: locationsIds,
          },
        },
        fields: ["location"],
      },
      function (err, results) {
        // On a uniquement les lieux trouvé donc, si un identifiant était
        // mauvais, osef
        var locations = results.map(function (result) {
          return result.location;
        });
        // Petit ajout pour traiter les inconsistances
        var badLocationsIds = locationsIds.filter(function (locationId) {
          return locations.every(function (location) {
            return location._id.toString() !== locationId.toString();
          });
        });
        // Si on en a, on fait la requête qui va bien
        if (badLocationsIds.length) {
          db.users.update(
            {
              _id: ObjectId("abbacacaabbacacaabbacacaabbacaca"),
            },
            {
              $pullAll: {
                locations_ids: badLocationsIds,
              },
            },
          );
        }
      },
    );
  },
);2:[["$","section",null,{"className":"contentBlock_root__802UK","children":[[["$","h1",null,{"className":"h1_root__VPXQG","children":[["$","span","0",{"children":"MongoDB ou la conception probabiliste"}]]}],["$","p",null,{"className":"p_root__SHE_W","children":[["$","span","0",{"children":"Comme je ne vous ai pas tout dit dans mon "}],["$","$L11",null,{"href":"./design_base_donnee_mongodb","className":"a_root__WEPS7","title":null,"target":"_self","children":[null,[["$","span","0",{"children":"dernier billet sur le design de base de donnée avec MongoDB"}]]]}],["$","span","2",{"children":", je me fends d'un second billet plus généraliste sur la philosophie que je mets en œuvre pour la gestion d'une base de donnée MongoDB."}]]}],["$","p",null,{"className":"p_root__SHE_W","children":[["$","span","0",{"children":"La majeure partie des décisions en matière d'architecture et de conception de schéma avec MongoDB se résume à un calcul de probabilité (les plus pessimistes diront risque) d'inconsistance des données. Et ça, pour un DBA, c'est plutôt, nouveau."}]]}],["$","p",null,{"className":"p_root__SHE_W","children":[["$","span","0",{"children":"D'ailleurs, quand on gratte un peu la surface, on se rend compte que ces probabilités sont au cœur de la conception de MongoDB lui même. Pour illustrer ce fait, parlons un peu de l'ObjectId."}]]}],["$","h2",null,{"className":"h2_root__Y02lX","children":["$","span",null,{"className":"anchored_root__HWi6K","children":[[["$","span","0",{"children":"ObjectId, the WTF primary key"}]]," ",["$","small",null,{"children":["$","$L11",null,{"href":"#objectid-the-wtf-primary-key","className":"anchored_icon__N5Sem","id":"objectid-the-wtf-primary-key","title":"Lien vers cette section","children":["$","span",null,{"children":"🔗"}]}]}]]}]}],["$","p",null,{"className":"p_root__SHE_W","children":[["$","span","0",{"children":"Les clés utilisées par MongoDB, les "}],["$","$L11",null,{"href":"https://docs.mongodb.com/manual/reference/method/ObjectId/","className":"a_root__WEPS7","title":null,"target":"_blank","children":[null,[["$","span","0",{"children":"ObjectIds"}]]]}],["$","span","2",{"children":", sont facilement reconnaissables sous forme de chaîne de caractère. Derrière cette séquence hexadécimale de 24 caractères (ex. : babacafebabacafebabacafebabacafe) se cache bien des concepts."}]]}],["$","p",null,{"className":"p_root__SHE_W","children":[["$","span","0",{"children":"Contrairement aux clés auto-incrémentées que l'on observe dans la plupart, sinon la totalité, des bases de données relationnelles, les clés de MongoDB sont générées grâce à une combinaison de quatre valeurs (un timestamp représentant le nombre de secondes écoulées depuis l'Epoch Unix, un identifiant \"machine\", le pid du processus qui a généré l'ObjectId et enfin un compteur incrémenté automatiquement à chaque création d'id avec une valeur aléatoire comme base)."}]]}],["$","p",null,{"className":"p_root__SHE_W","children":[["$","span","0",{"children":"La question légitime que vous êtes probablement entrain de vous poser est pourquoi ? A première vue, c'est bien plus compliqué à retenir qu'un simple identifiant numérique."}]]}],["$","p",null,{"className":"p_root__SHE_W","children":[["$","span","0",{"children":"La raison est simple : pouvoir créer un identifiant sans avoir besoin de synchroniser toutes les instances de MongoDB."}]]}],["$","p",null,{"className":"p_root__SHE_W","children":[["$","span","0",{"children":"En effet, il est déjà difficile "}],["$","$L11",null,{"href":"http://highscalability.com/blog/2015/3/9/the-architecture-of-algolias-distributed-search-network.html","className":"a_root__WEPS7","title":"Voir un article sur l'infrastructure d'Algolia traitant de ce sujet","target":"_blank","children":[null,[["$","span","0",{"children":"d'incrémenter un simple un entier"}]]]}],["$","span","2",{"children":" entre les diverses instances d'un cluster alors imaginez si c'était le cas pour toutes les collections de MongoDB. Le parti pris est donc de créer cette clé unique d'une façon telle qu'il devient impossible de créer la même clé sur deux instances différentes."}]]}],["$","p",null,{"className":"p_root__SHE_W","children":[["$","span","0",{"children":"Ou presque ;). Il existe bel et bien une probabilité que ceci arrive, mais cette dernière est tellement faible qu'elle devient négligeable. En effet, il faudrait que deux machines, ayant chacune un processus avec le même pid (ou "}],["$","$L11",null,{"href":"https://fr.wikipedia.org/wiki/Identifiant%5Fde%5Fprocessus","className":"a_root__WEPS7","title":null,"target":"_blank","children":[null,[["$","span","0",{"children":"identifiant de processus"}]]]}],["$","span","2",{"children":") et le même identifiant machine, créent dans la même milliseconde, un ObjectId alors que leur compteur interne a la même valeur."}]]}],["$","p",null,{"className":"p_root__SHE_W","children":[["$","span","0",{"children":"Dans la conception d'API REST, cette caractéristique devient même un précieux avantage puisqu'elle permet de générer l'ObjectId de cette ressource directement sur le client qui consomme cette même API. Ainsi, tirer avantage des requêtes créationnelles idempotentes du type PUT et PATCH devient un jeu d'enfant. En embarquant une bibliothèque permettant de "}],["$","$L11",null,{"href":"https://github.com/justaprogrammer/ObjectId.js","className":"a_root__WEPS7","title":null,"target":"_blank","children":[null,[["$","span","0",{"children":"générer des ObjectIds"}]]]}],["$","span","2",{"children":" on peu s'assurer de l'unicité des ressources créées côté mobile malgré les très probables coupures intempestives typiques des connexions itinérantes."}]]}],["$","h2",null,{"className":"h2_root__Y02lX","children":["$","span",null,{"className":"anchored_root__HWi6K","children":[[["$","span","0",{"children":"Transactions optimistes"}]]," ",["$","small",null,{"children":["$","$L11",null,{"href":"#transactions-optimistes","className":"anchored_icon__N5Sem","id":"transactions-optimistes","title":"Lien vers cette section","children":["$","span",null,{"children":"🔗"}]}]}]]}]}],["$","p",null,{"className":"p_root__SHE_W","children":[["$","span","0",{"children":"MongoDB ne propose pas de système de transaction. C'est d'ailleurs ce qui m'a rebuté de prime abord quand j'ai découvert MongoDB. Les données étant le cœur de tout système, ne pouvoir garantir l'état de ces dernières et risquer de les voir lentement se dégrader est inenvisageable pour un concepteur de service web qui se respecte."}]]}],["$","p",null,{"className":"p_root__SHE_W","children":[["$","span","0",{"children":"Alors que faire ? Faîtes comme dans la vraie vie. Quand vous prenez votre voiture pour aller chercher du pain, vous savez que ce n'est pas sans risque. Vous pourriez crever un pneu, avoir un accident etc... Malheureusement, vous ne pouvez pas réduire le risque à néant."}]]}],["$","p",null,{"className":"p_root__SHE_W","children":[["$","span","0",{"children":"En sortant quand même de chez vous, vous arbitrez sur le fait que ces risques sont somme toute négligeables et que la seule façon d'arriver à vos fins efficacement est de prendre ce risque. Vous le prenez cependant de manière intelligente."}]]}],["$","p",null,{"className":"p_root__SHE_W","children":[["$","span","0",{"children":"Vous avez un véhicule contrôlé techniquement tous les deux ans, vos pneus sont vérifiés régulièrement. Vous avez mis en place toute une batterie de mesures pour réduire ce risque."}]]}],["$","p",null,{"className":"p_root__SHE_W","children":[["$","span","0",{"children":"Vous avez également une roue de secours, une trousse de premier soins, un chasuble peut-être même une couverture au cas où vous seriez bloqué par la neige. Vous avez pris des mesures pour anticiper ce risque, pour être prêt si par malchance il se réalisait."}]]}],["$","p",null,{"className":"p_root__SHE_W","children":[["$","span","0",{"children":"Bref, vous faîtes une transaction optimiste. Selon toute vraisemblance dans 20 minutes vous serez de retour chez vous avec du pain. Et vous pourrez passer à l'opération suivante, préparer le petit déjeuner."}]]}],["$","p",null,{"className":"p_root__SHE_W","children":[["$","span","0",{"children":"Là où les bases relationnelles sont basées sur le fait qu'avec les transactions, théoriquement, il n'y a aucun risque, les bases de données NoSQL se basent sur le fait que généralement, tout se passe bien."}]]}],["$","p",null,{"className":"p_root__SHE_W","children":[["$","span","0",{"children":"C'est pourquoi la conception avec MongoDB est plus complexe. Elle demande une bonne réflexion et une bonne capacité à mesurer et anticiper les risques là où une conception relationnelle demande simplement du formalisme."}]]}],["$","p",null,{"className":"p_root__SHE_W","children":[["$","span","0",{"children":"Reprenons mon exemple du billet précédent dans lequel on met à jour les lieux associés à un utilisateur :"}]]}],["$","div",null,{"className":"code_root__5JLV_","children":["$","code",null,{"children":["$","pre",null,{"children":"// On s'assure que les ids donnés sont corrects\ndb.collection(\"location\").count(\n  {\n    _id: {\n      $in: myNewLocationsIds,\n    },\n  },\n  function (err, count) {\n    if (count != myNewLocationsIds.length) {\n      throw new Error(\"Bad locations ids\");\n    }\n    // On met à jour l'utilisateur\n    UserModel.update(\n      {\n        _id: ObjectId(\"abbacacaabbacacaabbacaca\"),\n      },\n      {\n        $set: {\n          locations_ids: myNewLocationsIds,\n        },\n      },\n      { multi: true },\n    );\n  },\n);"}]}]}],["$","p",null,{"className":"p_root__SHE_W","children":[["$","span","0",{"children":"Quels sont les risques ? La majorité des risques se situent souvent entre deux requêtes (d'où l'intérêt des techniques présentées dans l'article précédent pour les limiter). Le risque se situe donc entre la vérification de l'existence des lieux liés et la liaison effective des lieux dans le document correspondant à l'utilisateur."}]]}],["$","p",null,{"className":"p_root__SHE_W","children":[["$","span","0",{"children":"Pour que ce risque se réalise, il faudrait que l'un de ces lieux soit supprimé entre la requête de vérification et celle de modification. Soyons clairs, ce risque bien qu'existant est infime. Il est si infime, qu'on ne peut pas vraiment le réduire. On peut, par contre, très certainement l'augmenter en utilisant Mongoose ;) (voir billet précédent)."}]]}],["$","p",null,{"className":"p_root__SHE_W","children":[["$","span","0",{"children":"En revanche, puisque le risque existe, il s'agit de ne pas l'ignorer. Accepter la probabilité qu'un accident survienne en allant chercher du pain ne signifie pas mettre des œillères et se retrouver dépourvu face à sa réalisation."}]]}],["$","p",null,{"className":"p_root__SHE_W","children":[["$","span","0",{"children":"Plusieurs stratégies peuvent être mises en œuvre pour pallier à ces risques, parfois conjointement."}]]}],["$","h4",null,{"className":"h4_root__NsehS","children":["$","span",null,{"className":"anchored_root__HWi6K","children":[[["$","span","0",{"children":"Résilience face à l'inconsistance"}]]," ",["$","small",null,{"children":["$","$L11",null,{"href":"#resilience-face-a-l-inconsistance","className":"anchored_icon__N5Sem","id":"resilience-face-a-l-inconsistance","title":"Lien vers cette section","children":["$","span",null,{"children":"🔗"}]}]}]]}]}],["$","p",null,{"className":"p_root__SHE_W","children":[["$","span","0",{"children":"La première stratégie qui, selon moi, se doit d'être automatique. Votre plateforme se doit de continuer de fonctionner en cas d'inconsistance. Dans le cas de l'exemple ci-dessus, si il s'avère qu'un lieu n'existe plus quand vous cherchez à obtenir la liste des lieux d'un utilisateur, vous devez donc silencieusement l'invalider et non renvoyer une erreur aux consommateurs de votre API. Vous devez aussi logger cette erreur avec une flag reconnaissable pour votre supervision."}]]}],["$","p",null,{"className":"p_root__SHE_W","children":[["$","span","0",{"children":"Typiquement, l'architecte logiciel se chargera d'ajouter des tests à la base de code pour les risques d'inconsistance identifiés et acceptés par sa conception de façon à alerter les développeurs de ces derniers. Au niveau code, ceci donnerait :"}]]}],["$","div",null,{"className":"code_root__5JLV_","children":["$","code",null,{"children":["$","pre",null,{"children":"// Récupération des identifiants des lieux de l'utilisateur\ndb.users.find(\n  {\n    query: {\n      _id: ObjectId(\"abbacacaabbacacaabbacacaabbacaca\"),\n    },\n    fields: [\"locations_ids\"],\n  },\n  function (err, results) {\n    // Récupération des lieux\n    db.locations.find(\n      {\n        query: {\n          _id: {\n            $in: results[0].locations_ids,\n          },\n        },\n        fields: [\"location\"],\n      },\n      function (err, results) {\n        // On a uniquement les lieux trouvé donc, si un identifiant était\n        // mauvais, osef\n        var locations = results.map(function (result) {\n          return result.location;\n        });\n      },\n    );\n  },\n);"}]}]}],["$","p",null,{"className":"p_root__SHE_W","children":[["$","span","0",{"children":"Ici, le système de querying de MongoDB nous épargne la peine de prendre le cas en charge dans le code."}],["$","strong",null,{"className":"strong_root__kOzFq","children":[["$","span","0",{"children":"Il doit cependant, je le répète, être pris en charge par les tests."}]]}]]}],["$","h4",null,{"className":"h4_root__NsehS","children":["$","span",null,{"className":"anchored_root__HWi6K","children":[[["$","span","0",{"children":"Contrôle d'intégrité périodique"}]]," ",["$","small",null,{"children":["$","$L11",null,{"href":"#controle-d-integrite-periodique","className":"anchored_icon__N5Sem","id":"controle-d-integrite-periodique","title":"Lien vers cette section","children":["$","span",null,{"children":"🔗"}]}]}]]}]}],["$","p",null,{"className":"p_root__SHE_W","children":[["$","span","0",{"children":"Votre base de donnée peu devenir inconsistante. Donc, créez des scripts ! Ça peut paraître bête, mais créer des scripts pour contrôler et réparer les possibles inconsistances de votre base MongoDB est un excellent moyen de lutter contre elles. Ces scripts peuvent également servir de reminder de toutes les inconsistances possibles."}]]}],["$","p",null,{"className":"p_root__SHE_W","children":[["$","span","0",{"children":"Vous serez également bien contents de les avoir sous la main dans la cas où une inconsistance surviendrait plus souvent que prévu. Afin de pouvoir les utiliser comme palliatif le temps de réduire la probabilité de leur survenance grâce aux techniques que je vous ai présenté."}]]}],["$","h4",null,{"className":"h4_root__NsehS","children":["$","span",null,{"className":"anchored_root__HWi6K","children":[[["$","span","0",{"children":"Contrôle et traitement opportuniste d'intégrité"}]]," ",["$","small",null,{"children":["$","$L11",null,{"href":"#controle-et-traitement-opportuniste-d-integrite","className":"anchored_icon__N5Sem","id":"controle-et-traitement-opportuniste-d-integrite","title":"Lien vers cette section","children":["$","span",null,{"children":"🔗"}]}]}]]}]}],["$","p",null,{"className":"p_root__SHE_W","children":[["$","span","0",{"children":"Mais il y a mieux :). Dans notre exemple de code tolérant à l'inconsistance, je vois une belle opportunité de gérer à posteriori les inconsistances. En effet, puisque nous avons fait les requêtes permettant de voir l'inconsistance, pourquoi ne pas la corriger ?"}]]}],["$","div",null,{"className":"code_root__5JLV_","children":["$","code",null,{"children":["$","pre",null,{"children":"$12"}]}]}],["$","p",null,{"className":"p_root__SHE_W","children":[["$","span","0",{"children":"On peut s'inquiéter de l'empreinte de cette correction d'inconsistance sur les performances du système. Il faut cependant tempérer cette crainte par le fait que les inconsistances dans un système bien conçu sont rares."}]]}],["$","p",null,{"className":"p_root__SHE_W","children":[["$","span","0",{"children":"De plus, il est possible d'utiliser la fonction "}],["$","code",null,{"className":"code_root__5JLV_","children":"setTimeout()"}],["$","span","2",{"children":" de JavaScript pour découpler ces vérifications du reste du code pour ne pas nuire aux performances si cela s'avérait nécessaire."}]]}],["$","h4",null,{"className":"h4_root__NsehS","children":["$","span",null,{"className":"anchored_root__HWi6K","children":[[["$","span","0",{"children":"Isolation"}]]," ",["$","small",null,{"children":["$","$L11",null,{"href":"#isolation","className":"anchored_icon__N5Sem","id":"isolation","title":"Lien vers cette section","children":["$","span",null,{"children":"🔗"}]}]}]]}]}],["$","p",null,{"className":"p_root__SHE_W","children":[["$","span","0",{"children":"Vous avez probablement remarqué que les risques d'inconsistances sont souvent dûs à la concurrence possible sur les même données de deux utilisateurs différents de votre API."}]]}],["$","p",null,{"className":"p_root__SHE_W","children":[["$","span","0",{"children":"La résultante de ceci est bien sûr que le trafic sur votre plateforme change totalement les probabilités d'inconsistance. Ainsi, si vous avez un seul utilisateur elles sont quasi nulles, en revanche, si des millions d'utilisateurs l'utilisent, elles deviennent plus probables."}]]}],["$","p",null,{"className":"p_root__SHE_W","children":[["$","span","0",{"children":"Un bon moyen de limiter les inconsistances est donc la création de silos artificiels. Par exemple, si votre plateforme contient des organisations différentes et qu'aucun document n'est partagé entre deux organisations à aucun moment, félicitations, vous avez divisé le risque d'inconsistance dû au trafic par le nombre d'organisations existantes."}]]}],["$","h4",null,{"className":"h4_root__NsehS","children":["$","span",null,{"className":"anchored_root__HWi6K","children":[[["$","span","0",{"children":"Supervision"}]]," ",["$","small",null,{"children":["$","$L11",null,{"href":"#supervision","className":"anchored_icon__N5Sem","id":"supervision","title":"Lien vers cette section","children":["$","span",null,{"children":"🔗"}]}]}]]}]}],["$","p",null,{"className":"p_root__SHE_W","children":[["$","span","0",{"children":"Traiter silencieusement les inconsistances n'est pas suffisant. Vous devez recueillir du feedback sur ces dernières de manière à pouvoir faire évoluer votre système en connaissance de causes."}]]}],["$","p",null,{"className":"p_root__SHE_W","children":[["$","span","0",{"children":"La supervision et l'analyse des logs doit être une priorité. Par chance, les inconsistances sont sensées être rares. C'est pourquoi, ceci ne devrait pas être trop compliqué à gérer. Je suis pour ma part, partisan de l'envoi de mail à chaque inconsistance tant que c'est soutenable (l'idée est de tout faire pour que ça le reste ;) )."}]]}],["$","p",null,{"className":"p_root__SHE_W","children":[["$","span","0",{"children":"Toutes ces stratégies permettent de gérer l'incertitude pour obtenir un système scalable. Ce qui est clair, c'est que cette nouvelle façon d'appréhender la gestion des données m'a clairement fait sortir de ma zone de confort, mais l'essentiel est d'avoir retrouvé un niveau de confiance presque équivalent à celui induit par l'utilisation d'une base de données relationnelle."}]]}],["$","h2",null,{"className":"h2_root__Y02lX","children":["$","span",null,{"className":"anchored_root__HWi6K","children":[[["$","span","0",{"children":"Inception"}]]," ",["$","small",null,{"children":["$","$L11",null,{"href":"#inception","className":"anchored_icon__N5Sem","id":"inception","title":"Lien vers cette section","children":["$","span",null,{"children":"🔗"}]}]}]]}]}],["$","p",null,{"className":"p_root__SHE_W","children":[["$","span","0",{"children":"On pourrait ébrécher cette confiance en réfléchissant à toutes les stratégies mises en œuvre ci-dessus. Puisqu'elles-mêmes agissent sur les données, elles peuvent donc également générer des inconsistances."}]]}],["$","p",null,{"className":"p_root__SHE_W","children":[["$","span","0",{"children":"Il est possible que la suppression d'un identifiant de lieu dans la liste des lieux d'un utilisateur supprime en fait une association parfaitement légitime."}]]}],["$","p",null,{"className":"p_root__SHE_W","children":[["$","span","0",{"children":"En effet, on a vu qu'il était possible que deux identifiants MongoDB soient créés en même temps et soient identiques. Il est donc possible qu'un lieu soit créé avec l'un de ces identifiants et associé à l'utilisateur alors même qu'on est entrain de supprimer cet identifiant par ailleurs pour rétablir une intégrité supposée :)."}]]}],["$","h2",null,{"className":"h2_root__Y02lX","children":["$","span",null,{"className":"anchored_root__HWi6K","children":[[["$","span","0",{"children":"Conception organique"}]]," ",["$","small",null,{"children":["$","$L11",null,{"href":"#conception-organique","className":"anchored_icon__N5Sem","id":"conception-organique","title":"Lien vers cette section","children":["$","span",null,{"children":"🔗"}]}]}]]}]}],["$","p",null,{"className":"p_root__SHE_W","children":[["$","span","0",{"children":"J'aime bien le terme de conception organique. Là où les bases de données relationnelles sont comme une négation de la nature imprévisible de l'univers, MongoDB impose une conception qui rejoint l'approche naturelle. Une conception organique."}]]}],["$","p",null,{"className":"p_root__SHE_W","children":[["$","span","0",{"children":"J'aime cette vision philosophique de l'état d'un système qui jongle avec les probabilité et compose avec l'infini. MongoDB, c'est aussi une conception optimiste, car oui, dans la nature, les choses se passent plus souvent bien que mal."}]]}],["$","p",null,{"className":"p_root__SHE_W","children":[["$","span","0",{"children":"J'aime ces points de jonction entre la science et la vie. N'est-ce pas ainsi qu'on explique désormais la plupart des mystères de l'univers ?"}]]}],["$","p",null,{"className":"p_root__SHE_W","children":[["$","span","0",{"children":"Toutes les bonnes choses ont une fin, je pense que je reparlerai de MongoDB sur ce blog, en attendant, n'hésitez pas à donner votre avis. Désolé pour les gifs :p."}]]}]],["$","p",null,{"className":"p_root__SHE_W","children":["Published at"," ","samedi 4 avril 2015 à 15:29:02","."]}]]}],["$","section",null,{"className":"contentBlock_root__802UK","children":["$","aside",null,{"className":"share_root__Qm_RR","children":[["$","h2",null,{"className":"h2_root__Y02lX","children":"Commenter et partager"}],["$","p",null,{"className":"p_root__SHE_W","children":[["$","$L11",null,{"href":"https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Finsertafter.com%2Fblog%2Fdesign_probabiliste_mongodb","className":"a_root__WEPS7","title":"Commenter sur Facebook","target":"_blank","children":[null,[["$","span",null,{"className":"share_icon__bi4Q3 share_facebook__JKn8d"}],"Facebook"]]}]," - ",["$","$L11",null,{"href":"https://twitter.com/intent/tweet/?url=https%3A%2F%2Finsertafter.com%2Fblog%2Fdesign_probabiliste_mongodb&text=MongoDB%20ou%20la%20conception%20probabiliste&via=nfroidure","className":"a_root__WEPS7","title":"Commenter sur Twitter","target":"_blank","children":[null,[["$","span",null,{"className":"share_icon__bi4Q3 "}],"Twitter"]]}]," - ",["$","$L11",null,{"href":"mailto:nicolas.froidure@gmail.com","className":"a_root__WEPS7","title":"Me répondre par mail","target":"_self","children":[null,[["$","span",null,{"className":"share_icon__bi4Q3 share_mail__yvBDK"}],"Courriel"]]}]]}]]}]}],["$","section",null,{"className":"contentBlock_root__802UK","children":["$","aside",null,{"className":"page_linkedEntries__jiPuT","children":[["$","h2",null,{"className":"h2_root__Y02lX","children":"Articles similaires"}],["$","p",null,{"className":"p_root__SHE_W","children":["Dans les catégories"," ","MongoDB et Base de données","."]}],["$","div",null,{"className":"items_entries__5hkLG","children":[["$","div","design_base_donnee_mongodb",{"className":"items_entry_item__GWeg7","children":[null,["$","h2",null,{"className":"h2_root__Y02lX items_entry_title__vJ_8h","children":["$","$L11",null,{"href":".//design_base_donnee_mongodb","className":"a_root__WEPS7 items_entry_link__EtVod","title":"Lire cet article de blog","target":"_self","children":[null,"Design de bases de données MongoDB"]}]}],["$","p",null,{"className":"p_root__SHE_W items_entry_description__ZWt9y","children":["Le design de bases de données MongoDB est une activité complexe qui nécessite d'avoir une profonde connaissance des implications des divers choix possibles."," ",["$","br",null,{}],["$","$L11",null,{"href":".//design_base_donnee_mongodb","className":"a_root__WEPS7","title":"Lire cet article de blog","target":"_self","children":[null,"Lire la suite"]}]]}],["$","p",null,{"className":"p_root__SHE_W items_entry_time__iNrot","children":["Published at"," ","samedi 28 mars 2015 à 13:40:32","."]}],["$","div",null,{"className":"items_clear__3fyGk"}]]}],["$","div","retour_xp_mongodb",{"className":"items_entry_item__GWeg7","children":[null,["$","h2",null,{"className":"h2_root__Y02lX items_entry_title__vJ_8h","children":["$","$L11",null,{"href":".//retour_xp_mongodb","className":"a_root__WEPS7 items_entry_link__EtVod","title":"Lire cet article de blog","target":"_self","children":[null,"MongoDB : Retour d'expérience"]}]}],["$","p",null,{"className":"p_root__SHE_W items_entry_description__ZWt9y","children":["Je travaille avec MongoDB depuis maintenant presque un an, il est temps pour moi de faire un petit retour sur cette base de données et sur le NoSQL de manière générale."," ",["$","br",null,{}],["$","$L11",null,{"href":".//retour_xp_mongodb","className":"a_root__WEPS7","title":"Lire cet article de blog","target":"_self","children":[null,"Lire la suite"]}]]}],["$","p",null,{"className":"p_root__SHE_W items_entry_time__iNrot","children":["Published at"," ","jeudi 4 décembre 2014 à 20:44:40","."]}],["$","div",null,{"className":"items_clear__3fyGk"}]]}],["$","div","gerer_monnaies_logiciel",{"className":"items_entry_item__GWeg7","children":[null,["$","h2",null,{"className":"h2_root__Y02lX items_entry_title__vJ_8h","children":["$","$L11",null,{"href":".//gerer_monnaies_logiciel","className":"a_root__WEPS7 items_entry_link__EtVod","title":"Lire cet article de blog","target":"_self","children":[null,"Gérer les monnaies dans un logiciel (CRM,ERP)"]}]}],["$","p",null,{"className":"p_root__SHE_W items_entry_description__ZWt9y","children":["Je suis actuellement entrain de développer une solution CRM basée sur mon framework Rest PHP. Il faut donc gérer les différentes monnaies."," ",["$","br",null,{}],["$","$L11",null,{"href":".//gerer_monnaies_logiciel","className":"a_root__WEPS7","title":"Lire cet article de blog","target":"_self","children":[null,"Lire la suite"]}]]}],["$","p",null,{"className":"p_root__SHE_W items_entry_time__iNrot","children":["Published at"," ","vendredi 16 novembre 2012 à 10:24:57","."]}],["$","div",null,{"className":"items_clear__3fyGk"}]]}]]}]]}]}]]
c:[["$","meta","0",{"name":"viewport","content":"width=device-width, initial-scale=1"}],["$","meta","1",{"name":"theme-color","content":"#3e78b2"}],["$","meta","2",{"charSet":"utf-8"}],["$","title","3",{"children":"MongoDB ou la conception probabiliste - Nicolas Froidure"}],["$","meta","4",{"name":"description","content":"Concevoir une base de donnée MongoDB c'est composer avec le hasard. Dans ce billet je vous propose de découvrir pourquoi et comment."}],["$","link","5",{"rel":"author","href":"https://insertafter.com"}],["$","meta","6",{"name":"author","content":"Nicolas Froidure"}],["$","meta","7",{"name":"robots","content":"index, follow"}],["$","link","8",{"rel":"canonical","href":"https://insertafter.com/fr/blog/design_probabiliste_mongodb"}],["$","meta","9",{"property":"og:title","content":"MongoDB ou la conception probabiliste - Nicolas Froidure"}],["$","meta","10",{"property":"og:description","content":"Concevoir une base de donnée MongoDB c'est composer avec le hasard. Dans ce billet je vous propose de découvrir pourquoi et comment."}],["$","meta","11",{"property":"og:url","content":"https://insertafter.com/fr/blog/design_probabiliste_mongodb"}],["$","meta","12",{"property":"og:site_name","content":"Nicolas Froidure"}],["$","meta","13",{"property":"og:locale","content":"fr_FR"}],["$","meta","14",{"property":"og:image:alt","content":"Bannière du site"}],["$","meta","15",{"property":"og:image","content":"https://insertafter.com/images/banner.png"}],["$","meta","16",{"property":"og:type","content":"article"}],["$","meta","17",{"name":"twitter:card","content":"summary"}],["$","meta","18",{"name":"twitter:site","content":"@nfroidure"}],["$","meta","19",{"name":"twitter:creator","content":"@nfroidure"}],["$","meta","20",{"name":"twitter:title","content":"MongoDB ou la conception probabiliste - Nicolas Froidure"}],["$","meta","21",{"name":"twitter:description","content":"Concevoir une base de donnée MongoDB c'est composer avec le hasard. Dans ce billet je vous propose de découvrir pourquoi et comment."}],["$","meta","22",{"name":"twitter:image:alt","content":"Bannière du site"}],["$","meta","23",{"name":"twitter:image","content":"https://insertafter.com/images/banner.png"}],["$","link","24",{"rel":"icon","href":"/images/favicon.svg","type":"image/svg+xml","sizes":"any"}],["$","link","25",{"rel":"icon","href":"/images/favicon-16.png","type":"image/png","sizes":"16x16"}],["$","link","26",{"rel":"icon","href":"/images/favicon-128.png","type":"image/png","sizes":"128x128"}]]
1:null
