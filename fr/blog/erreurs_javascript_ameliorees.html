<!DOCTYPE html><html lang="fr"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="preload" as="image" href="/images/logo.svg"/><link rel="preload" as="image" href="https://www.commitstrip.com/wp-content/uploads/2013/03/Strips-Expressions-r%C3%A9guli%C3%A8res-550-final.jpg"/><link rel="stylesheet" href="https://insertafter.com/_next/static/css/655a273f6fe37552.css" crossorigin="" data-precedence="next"/><link rel="stylesheet" href="https://insertafter.com/_next/static/css/b3a30849af1e683f.css" crossorigin="" data-precedence="next"/><link rel="preload" as="script" fetchPriority="low" href="https://insertafter.com/_next/static/chunks/webpack-f65a69f5b063a746.js" crossorigin=""/><script src="https://insertafter.com/_next/static/chunks/fd9d1056-5bc70f044f3cb802.js" async="" crossorigin=""></script><script src="https://insertafter.com/_next/static/chunks/938-bf741a2eb8fd4828.js" async="" crossorigin=""></script><script src="https://insertafter.com/_next/static/chunks/main-app-2e6280b5273157a5.js" async="" crossorigin=""></script><script src="https://insertafter.com/_next/static/chunks/176-0a03be62efe5672b.js" async=""></script><script src="https://insertafter.com/_next/static/chunks/app/(withLocale)/%5Blocale%5D/layout-3730889d272dc34b.js" async=""></script><script src="https://insertafter.com/_next/static/chunks/790-a194f74901d33197.js" async=""></script><script src="https://insertafter.com/_next/static/chunks/app/(withLocale)/%5Blocale%5D/blog/%5Bid%5D/page-8524fb70a93a8de3.js" async=""></script><meta name="theme-color" content="#3e78b2"/><title>Am√©liorer les erreurs JavaScript - Nicolas Froidure</title><meta name="description" content="Pour un meilleur d√©bogage, il faut de meilleures erreurs. C&#x27;est pourquoi j&#x27;ai mis en place une strat√©gie pour les rendre plus pertinentes."/><link rel="author" href="https://insertafter.com"/><meta name="author" content="Nicolas Froidure"/><meta name="robots" content="index, follow"/><link rel="canonical" href="https://insertafter.com/fr/blog/erreurs_javascript_ameliorees"/><meta property="og:title" content="Am√©liorer les erreurs JavaScript - Nicolas Froidure"/><meta property="og:description" content="Pour un meilleur d√©bogage, il faut de meilleures erreurs. C&#x27;est pourquoi j&#x27;ai mis en place une strat√©gie pour les rendre plus pertinentes."/><meta property="og:url" content="https://insertafter.com/fr/blog/erreurs_javascript_ameliorees"/><meta property="og:site_name" content="Nicolas Froidure"/><meta property="og:locale" content="fr_FR"/><meta property="og:image:alt" content="Banni√®re du site"/><meta property="og:image" content="https://insertafter.com/images/banner.png"/><meta property="og:type" content="article"/><meta name="twitter:card" content="summary"/><meta name="twitter:site" content="@nfroidure"/><meta name="twitter:creator" content="@nfroidure"/><meta name="twitter:title" content="Am√©liorer les erreurs JavaScript - Nicolas Froidure"/><meta name="twitter:description" content="Pour un meilleur d√©bogage, il faut de meilleures erreurs. C&#x27;est pourquoi j&#x27;ai mis en place une strat√©gie pour les rendre plus pertinentes."/><meta name="twitter:image:alt" content="Banni√®re du site"/><meta name="twitter:image" content="https://insertafter.com/images/banner.png"/><link rel="icon" href="/images/favicon.svg" type="image/svg+xml" sizes="any"/><link rel="icon" href="/images/favicon-16.png" type="image/png" sizes="16x16"/><link rel="icon" href="/images/favicon-128.png" type="image/png" sizes="128x128"/><script src="https://insertafter.com/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js" crossorigin="" noModule=""></script></head><body class="layout_body__jFZuu"><header class="header_iaHeader__4vCMA"><div><h1><a href="/fr" title="Retour √† l‚Äôaccueil" class="header_iaHeaderLogo__0uNr1"><img src="/images/logo.svg" alt="Logo d‚ÄôInsertAfter"/></a></h1></div></header><nav class="menu_iaMenu__B_rtj"><ul class="menu_iaMenuBody__0Zveq"><li class="menu_iaMenuItem__rOch4"><a href="/fr" title="Retour √† l‚Äôaccueil" class="">Accueil</a></li><li class="menu_iaMenuItem__rOch4"><a href="/fr/blog" title="Retour √† l‚Äôindex du blog" class="">Blog</a></li><li class="menu_iaMenuItem__rOch4"><a href="/fr/projets" title="D√©couvrir mes divers projets" class="">Projets</a></li><li class="menu_iaMenuItem__rOch4"><a href="/fr/a_propos" title="En savoir plus √† mon sujet" class="">√Ä propos</a></li></ul></nav><nav class="languages_iaLanguages__K2J3W"><ul><li class="languages_iaLanguagesFlag__ruQ4j languages_iaLanguagesFlagEn__angfJ languages_selected__w1dKv"><a href="/en/blog"><span>en</span></a></li><li class="languages_iaLanguagesFlag__ruQ4j languages_iaLanguagesFlagFr__Us5Jb"><a href="/fr/blog"><span>fr</span></a></li></ul></nav><main class="layout_iaMain__6s2gl"><div><section class="contentBlock_root__802UK"><h1 class="h1_root__VPXQG"><span>Am√©liorer les erreurs JavaScript</span></h1><p class="p_root__SHE_W"><span>Chez SimpliField, nous avons une base de code JavaScript tr√®s cons√©quente, de plus, nous avons un cycle de release tr√®s court. C&#x27;est pourquoi une gestion des erreurs pertinente est une n√©cessit√© pour nous.</span></p><p class="p_root__SHE_W"><span>J&#x27;ai d√©j√† parl√© de la </span><a class="a_root__WEPS7" target="_self" href="./erreurs_javascript"><span>gestion des erreurs en JavaScript</span></a><span> sur ce blog, mais de fa√ßon purement th√©orique et architecturale. Je voudrais parler ici de d√©tails d&#x27;impl√©mentation que nous avons mis en pratique avec succ√®s.</span></p><h2 class="h2_root__Y02lX"><span class="anchored_root__HWi6K"><span>s/message d&#x27;erreur/code d&#x27;erreur/</span> <small><a class="anchored_icon__N5Sem" id="s-message-d-erreur-code-d-erreur" title="Lien vers cette section" href="#s-message-d-erreur-code-d-erreur"><span>üîó</span></a></small></span></h2><p class="p_root__SHE_W"><span>La premi√®re strat√©gie que je mets en place sur tous mes d√©veloppements est de pr√©f√©rer des codes d&#x27;erreurs que des messages. Pour comprendre pourquoi, prenons un exemple simple ; la v√©rification qu&#x27;un nombre est dans un intervalle donn√©.</span></p><p class="p_root__SHE_W"><span>Un choix de POO classique serait d&#x27;utiliser une &quot;classe&quot; d&#x27;erreur. En JavaScript, nous en avons m√™me une native¬†:</span></p><div class="code_root__5JLV_"><code><pre>function checkBounds(n) {
  if (n &lt; 2) {
    throw new RangeError(&quot;Out of range (&quot; + n + &quot;&lt;2)&quot;);
  }
  if (n &gt; 4) {
    throw new RangeError(&quot;Out of range (&quot; + n + &quot;&gt;4)&quot;);
  }
}</pre></code></div><p class="p_root__SHE_W"><span>A priori, cette erreur peut sembler tout √† fait claire et exploitable. Mais √† l&#x27;usage, on va rencontrer divers probl√®mes, dont un majeur, la qualification de cette erreur √† un autre niveau du programme.</span></p><p class="p_root__SHE_W"><span>En effet, comment savoir, quand on l&#x27;attrapera par ailleurs dans notre application, ce qu&#x27;il faut en faire¬†? Simple me direz-vous, nous allons utiliser l&#x27;op√©rateur </span><code class="code_root__5JLV_">instanceof</code><span>¬†!</span></p><div class="code_root__5JLV_"><code><pre>try {
  checkBounds(6);
} catch(err) {
  if(err instanceof RangeError) {
    console.log(&#x27;Erreur d&#x27;intervalle&#x27;);
  }
}</pre></code></div><p class="p_root__SHE_W"><span>Cette approche marche dans une petite application, mais avec des applications de dizaines, voire centaines, de milliers de lignes, elle n&#x27;est plus du tout viable.</span></p><p class="p_root__SHE_W"><span>En effet, ceci n√©cessiterait d&#x27;h√©riter du constructeur </span><code class="code_root__5JLV_">Error</code><span> pour chaque type d&#x27;erreur et cr√©erait tout une base de code annexe bien connue des d√©veloppeurs Java...</span></p><p class="p_root__SHE_W"><span>Nous devons faire mieux. Une autre strat√©gie est de se baser sur le message d&#x27;erreur¬†:</span></p><div class="code_root__5JLV_"><code><pre>try {
  checkBounds(6);
} catch (err) {
  if (err.message.startsWith(&quot;Out of range&quot;)) {
    console.log(&quot;Erreur d&#x27;intervalle&quot;);
  }
}</pre></code></div><p class="p_root__SHE_W"><span>Ici, ce n&#x27;est pas tr√®s parlant, mais un message d&#x27;erreur sous forme de phrase est la porte ouverte √† tous les abus¬†:). Si l&#x27;auteur du message a tendance √† √©crire un roman pour chaque erreur, votre code va se d√©t√©riorer rapidement.</span></p><p class="p_root__SHE_W"><span>Sans compter qu&#x27;au moindre changement de mot ou √† la moindre correction de faute d&#x27;orthographe, vous pourrez revoir votre logique de diff√©rentiation des erreurs. C&#x27;est pour ces raisons que je n&#x27;utilise plus de messages d&#x27;erreur, mais plut√¥t des codes d&#x27;erreur simples et concis.</span></p><p class="p_root__SHE_W"><span>Autre probl√®me avec cette approche, si vous souhaitez obtenir des informations sur l&#x27;erreur (du style n est sup√©rieur ou inf√©rieur √† l&#x27;intervalle), vous pouvez sortir vos </span><code class="code_root__5JLV_">RegExp</code><span>¬†:).</span></p><p class="p_root__SHE_W"><span class="img_root__vTZoG img_landscape__qBqfT"><span class="img_picture__pfsl0"><img alt="A propos des personnes qui font leur RegExp elles m√™me, transcription sur le site de la source." src="https://www.commitstrip.com/wp-content/uploads/2013/03/Strips-Expressions-r%C3%A9guli%C3%A8res-550-final.jpg"/></span></span><span>
</span><a class="a_root__WEPS7" title="Voir la planche sur le site des auteurs" target="_blank" href="https://www.commitstrip.com/fr/2013/03/06/quelquun-sy-connait-en-expressions-regulieres/"><span>Source: Commit Strip</span></a></p><p class="p_root__SHE_W"><span>Chez moi, la fonction de v√©rification d&#x27;intervalle ressemble plut√¥t √† √ßa¬†:</span></p><div class="code_root__5JLV_"><code><pre>var YError = require(&quot;yerror&quot;);
function checkBounds(n) {
  if (n &lt; 2) {
    throw new YError(&quot;E_RANGE&quot;, &quot;2&quot;, n);
  }
  if (n &gt; 4) {
    throw new YError(&quot;E_RANGE&quot;, 4, n);
  }
}</pre></code></div><p class="p_root__SHE_W"><span>Et son utilisation, √† √ßa¬†:</span></p><div class="code_root__5JLV_"><code><pre>try {
  checkBounds(6);
} catch (err) {
  if (&quot;E_RANGE&quot; === err.code) {
    console.log(&quot;Erreur d&#x27;intervalle, n=&quot; + err.params[1] + &quot;.&quot;);
  }
}</pre></code></div><p class="p_root__SHE_W"><span>Plusieurs avantages¬†:</span></p><ul class="ul_ul__qh0e9"><li class="li_root__oY9Dv"><p class="p_root__SHE_W"><span>le code d&#x27;erreur se suffit √† lui-m√™me, pas besoin d&#x27;une phrase pour le comprendre.</span></p></li><li class="li_root__oY9Dv"><p class="p_root__SHE_W"><span>les param√®tres de l&#x27;erreur permettent de comprendre ce qui l&#x27;a g√©n√©r√©e et m√™me de l&#x27;analyser programmatiquement de fa√ßon simple.</span></p></li><li class="li_root__oY9Dv"><p class="p_root__SHE_W"><span>si cette erreur vient √† faire planter le serveur de production, j&#x27;ai d√©j√† des informations pour comprendre pourquoi sans avoir √† revenir dans le m√™me √©tat.</span></p></li><li class="li_root__oY9Dv"><p class="p_root__SHE_W"><span>si je souhaite afficher cette erreur √† l&#x27;utilisateur, la gestion de l&#x27;internationalisation sera plus facile (le code √©tant la cl√© du message et les param√®tres permettant de le compl√©ter de fa√ßon internationalis√©e, par exemple, en affichant les nombres au format local).</span></p></li></ul><h2 class="h2_root__Y02lX"><span class="anchored_root__HWi6K"><span>Erreurs asynchrones et trace d&#x27;erreur</span> <small><a class="anchored_icon__N5Sem" id="erreurs-asynchrones-et-trace-d-erreur" title="Lien vers cette section" href="#erreurs-asynchrones-et-trace-d-erreur"><span>üîó</span></a></small></span></h2><p class="p_root__SHE_W"><span>Le principal probl√®me des erreurs asynchrones est qu&#x27;elles ne permettent pas toujours de comprendre l&#x27;origine du probl√®me et le parcours de l&#x27;erreur dans votre code asynchrone.</span></p><p class="p_root__SHE_W"><span>Certaines librairies vous proposent des fonctionnalit√©s pour g√©rer ceci comme la m√©thode</span><a class="a_root__WEPS7" target="_blank" href="https://github.com/petkaantonov/bluebird/blob/master/API.md#promiselongstacktraces---void"><span> Promise.longStackTrace()</span></a><span> de BlueBird. Mais il est assez laborieux de faire cohabiter les diff√©rentes librairies entre elles. De plus, les traces produites sont souvent tr√®s verbeuses car pas du tout s√©lectives.</span></p><p class="p_root__SHE_W"><span>√Ä cette fin, je pr√©f√®re g√©rer cette long stack trace manuellement en identifiant les secteurs importants de l&#x27;application qui n√©cessitent que je r√©cup√®re la trace en cours. Prenons la cha√Æne de promise suivante¬†:</span></p><div class="code_root__5JLV_"><code><pre>function updatePassword(id, passwd) {
  return getUser(id)
    .then(checkPassword(passwd))
    .then(changePassword(passwd))
    .then(sendWarningEMail)
    .catch(function (err) {
      return YError.bump(err);
    });
}</pre></code></div><p class="p_root__SHE_W"><span>Dans cette cha√Æne de promise, ce qui m&#x27;int√©resse, c&#x27;est d&#x27;avoir la stack initiale de l&#x27;erreur et de savoir qu&#x27;elle a eu lieu dans cette cha√Æne de promise. Le reste n&#x27;est que du bruit. C&#x27;est pourquoi j&#x27;utilise explicitement la fonction </span><code class="code_root__5JLV_">YError.bump()</code><span>.</span></p><h2 class="h2_root__Y02lX"><span class="anchored_root__HWi6K"><span>Requalification</span> <small><a class="anchored_icon__N5Sem" id="requalification" title="Lien vers cette section" href="#requalification"><span>üîó</span></a></small></span></h2><p class="p_root__SHE_W"><span>Bien souvent, quand on attrape une erreur, c&#x27;est que l&#x27;on souhaite la requalifier. En effet, une erreur de type </span><code class="code_root__5JLV_">&#x27;undefined&#x27; is not a function</code><span> n&#x27;a aucun sens pour les utilisateurs. C&#x27;est √©galement g√©n√©ralement le cas des erreurs de bas niveau que vos librairies remontent.</span></p><p class="p_root__SHE_W"><span>Malheureusement, cette requalification g√©n√®re souvent une perte d&#x27;information si on se contente na√Øvement de cr√©er une autre erreur parall√®lement. Mon approche dans ce cas est d&#x27;utiliser la m√©thode </span><code class="code_root__5JLV_">YError.wrap()</code><span>.</span></p><div class="code_root__5JLV_"><code><pre>function updatePassword(id, passwd) {
  return getUser(id)
    .then(checkPassword(passwd))
    .catch(function(err) {
      return YError.wrap(err, &#x27;E_USER_ERROR&#x27;, id);
    });
    .then(changePassword(passwd))
    .then(sendWarningEMail)
    .catch(function(err) {
      return YError.wrap(err, &#x27;E_UNEXPECTED&#x27;, id);
    });
}</pre></code></div><p class="p_root__SHE_W"><span>Ici, je requalifie un √©chec √† la r√©cup√©ration de l&#x27;utilisateur ou √† la v√©rification du nouveau mot de passe pour qualifier l&#x27;erreur comme √©tant due √† l&#x27;utilisateur. Dans le cadre d&#x27;une API rest, cela permettra de renvoyer une erreur 400. Les autres erreurs seront quand √† elles classifi√©es comme bug et une erreur 500 sera retourn√©e dans ce cas.</span></p><p class="p_root__SHE_W"><span>Mais le v√©ritable avantage de cette m√©thode est que la trace de l&#x27;erreur contiendra non-seulement ces nouvelles informations, mais aussi les pr√©c√©dentes, donnant quelque chose de cet ordre¬†:</span></p><div class="code_root__5JLV_"><code><pre>  E_BAD_PWD_LENGTH (5)
    at line XXX
    at (...)
  E_USER_ERROR (abbacacaabbacacaabbacaca)
    at line XXX
    at (...)</pre></code></div><p class="p_root__SHE_W"><span>En r√©alit√©, nous avons un constructeur d&#x27;erreur d√©riv√© de YError et bas√© sur le m√™me principe cr√©√© sp√©cifiquement pour les erreurs HTTP. Je pense que nous allons l&#x27;open-sourcer d√®s que nous aurons quelques minutes.</span></p><p class="p_root__SHE_W"><span>N&#x27;h√©sitez pas √† partager vos recettes¬†! Le code de YError est, bien-s√ªr, </span><a class="a_root__WEPS7" target="_blank" href="https://github.com/SimpliField/yerror"><span>disponible sur GitHub</span></a><span> .</span></p><p class="p_root__SHE_W">Published at<!-- --> <!-- -->dimanche 15 mars 2015 √† 12:04:02<!-- -->.</p></section><section class="contentBlock_root__802UK"><aside class="share_root__Qm_RR"><h2 class="h2_root__Y02lX">Commenter et partager</h2><p class="p_root__SHE_W"><a class="a_root__WEPS7" title="Commenter sur Facebook" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Finsertafter.com%2Fblog%2Ferreurs_javascript_ameliorees"><span class="share_icon__bi4Q3 share_facebook__JKn8d"></span>Facebook</a> - <a class="a_root__WEPS7" title="Commenter sur Twitter" target="_blank" href="https://twitter.com/intent/tweet/?url=https%3A%2F%2Finsertafter.com%2Fblog%2Ferreurs_javascript_ameliorees&amp;text=Am%C3%A9liorer%20les%20erreurs%20JavaScript&amp;via=nfroidure"><span class="share_icon__bi4Q3 "></span>Twitter</a> - <a class="a_root__WEPS7" title="Me r√©pondre par mail" target="_self" href="mailto:nicolas.froidure@gmail.com"><span class="share_icon__bi4Q3 share_mail__yvBDK"></span>Courriel</a></p></aside></section><section class="contentBlock_root__802UK"><aside class="page_linkedEntries__jiPuT"><h2 class="h2_root__Y02lX">Articles similaires</h2><p class="p_root__SHE_W">Dans les cat√©gories<!-- --> <!-- -->JavaScript<!-- -->.</p><div class="items_entries__5hkLG"><div class="items_entry_item__GWeg7"><h2 class="h2_root__Y02lX items_entry_title__vJ_8h"><a class="a_root__WEPS7 items_entry_link__EtVod" title="Lire cet article de blog" target="_self" href=".//faire-mieux-qu-angular-avec-require">Faire mieux qu&#x27;AngularJS avec require()</a></h2><p class="p_root__SHE_W items_entry_description__ZWt9y">Le syst√®me CommonJS-like de NodeJS permet un grand nombre de subtilit√©s. Je vous propose de les d√©couvrir en reproduisant les fonctionnalit√©s du syst√®me de modules d&#x27;AngularJS.<!-- --> <br/><a class="a_root__WEPS7" title="Lire cet article de blog" target="_self" href=".//faire-mieux-qu-angular-avec-require">Lire la suite</a></p><p class="p_root__SHE_W items_entry_time__iNrot">Published at<!-- --> <!-- -->jeudi 12 mars 2015 √† 08:49:00<!-- -->.</p><div class="items_clear__3fyGk"></div></div><div class="items_entry_item__GWeg7"><h2 class="h2_root__Y02lX items_entry_title__vJ_8h"><a class="a_root__WEPS7 items_entry_link__EtVod" title="Lire cet article de blog" target="_self" href=".//watchdeps">Surveillez les d√©pendances de vos projets NodeJS</a></h2><p class="p_root__SHE_W items_entry_description__ZWt9y">Avec watchdeps abonnez-vous automatiquement aux d√©pendences de vos projets NodeJS sur GitHub.<!-- --> <br/><a class="a_root__WEPS7" title="Lire cet article de blog" target="_self" href=".//watchdeps">Lire la suite</a></p><p class="p_root__SHE_W items_entry_time__iNrot">Published at<!-- --> <!-- -->dimanche 8 mars 2015 √† 11:07:32<!-- -->.</p><div class="items_clear__3fyGk"></div></div><div class="items_entry_item__GWeg7"><h2 class="h2_root__Y02lX items_entry_title__vJ_8h"><a class="a_root__WEPS7 items_entry_link__EtVod" title="Lire cet article de blog" target="_self" href=".//isomorphisme_par_l_exemple">L&#x27;isomorphisme par l&#x27;exemple</a></h2><p class="p_root__SHE_W items_entry_description__ZWt9y">Pr√©sentation sur la gestion des droits dans une application JavaScript de fa√ßon universelle.<!-- --> <br/><a class="a_root__WEPS7" title="Lire cet article de blog" target="_self" href=".//isomorphisme_par_l_exemple">Lire la suite</a></p><p class="p_root__SHE_W items_entry_time__iNrot">Published at<!-- --> <!-- -->mardi 3 f√©vrier 2015 √† 08:08:19<!-- -->.</p><div class="items_clear__3fyGk"></div></div></div></aside></section></div></main><aside class="social_iaSocial__kdR1x"><nav><ul><li><a href="https://mastodon.social/@nfroidure" rel="me" title="Me suivre sur Mastodon" class="social_iaSocialMastodon__MTF6o"><span>Mastodon</span></a></li><li><a href="https://bsky.app/profile/nfroidure.bsky.social" rel="me" title="Me suivre sur Bluesky" class="social_iaSocialBluesky__fKW6M"><span>Bluesky</span></a></li><li><a href="https://twitter.com/nfroidure" title="Me suivre sur Twitter" class="social_iaSocialTwitter__9nU6R"><span>Twitter</span></a></li><li><a href="https://github.com/nfroidure" title="Voir mes projets sur GitHub" class="social_iaSocialGithub__vcU5_"><span>GitHub</span></a></li><li><a href="https://www.npmjs.org/~nfroidure" title="Voir mon compte NPM" class="social_iaSocialNpm__6nku5"><span>NPM</span></a></li><li><a href="https://www.linkedin.com/in/nfroidure/" rel="me" title="Voir mon profil LinkedIn" class="social_iaSocialLinkedin__pWACO"><span>LinkedIn</span></a></li><li><a href="https://facebook.com/nicolas.froidure.douai" rel="me" title="Me suivre sur Facebook" class="social_iaSocialFacebook__w4wfH"><span>Facebook</span></a></li><li><a href="/fr/blog/index.atom" title="S‚Äôabonner au flux RSS" class="social_iaSocialFeed__gEQQ0"><span>Flux RSS</span></a></li></ul></nav></aside><footer class="footer_iaFooter__rhlnQ"><p class="footer_iaFooterContent__VZndF">¬© Nicolas Froidure 2012-<!-- -->2024</p></footer><script src="https://insertafter.com/_next/static/chunks/webpack-f65a69f5b063a746.js" crossorigin="" async=""></script><script>(self.__next_f=self.__next_f||[]).push([0]);self.__next_f.push([2,null])</script><script>self.__next_f.push([1,"0:\"$L1\"\n"])</script><script>self.__next_f.push([1,"2:HL[\"https://insertafter.com/_next/static/css/655a273f6fe37552.css\",\"style\",{\"crossOrigin\":\"\"}]\n3:HL[\"https://insertafter.com/_next/static/css/b3a30849af1e683f.css\",\"style\",{\"crossOrigin\":\"\"}]\n"])</script><script>self.__next_f.push([1,"4:I[7690,[],\"\"]\n7:I[5613,[],\"\"]\na:I[1778,[],\"\"]\n11:I[8955,[],\"\"]\n8:[\"locale\",\"fr\",\"d\"]\n9:[\"id\",\"erreurs_javascript_ameliorees\",\"d\"]\nc:{\"fontFamily\":\"system-ui,\\\"Segoe UI\\\",Roboto,Helvetica,Arial,sans-serif,\\\"Apple Color Emoji\\\",\\\"Segoe UI Emoji\\\"\",\"height\":\"100vh\",\"textAlign\":\"center\",\"display\":\"flex\",\"flexDirection\":\"column\",\"alignItems\":\"center\",\"justifyContent\":\"center\"}\nd:{\"display\":\"inline-block\",\"margin\":\"0 20px 0 0\",\"padding\":\"0 23px 0 0\",\"fontSize\":24,\"fontWeight\":500,\"verticalAlign\":\"top\",\"lineHeig"])</script><script>self.__next_f.push([1,"ht\":\"49px\"}\ne:{\"display\":\"inline-block\"}\nf:{\"fontSize\":14,\"fontWeight\":400,\"lineHeight\":\"49px\",\"margin\":0}\n"])</script><script>self.__next_f.push([1,"1:[null,[\"$\",\"$L4\",null,{\"buildId\":\"KvaQf7Occ1_mTQr28YDxi\",\"assetPrefix\":\"https://insertafter.com\",\"initialCanonicalUrl\":\"/fr/blog/erreurs_javascript_ameliorees\",\"initialTree\":[\"\",{\"children\":[\"(withLocale)\",{\"children\":[[\"locale\",\"fr\",\"d\"],{\"children\":[\"blog\",{\"children\":[[\"id\",\"erreurs_javascript_ameliorees\",\"d\"],{\"children\":[\"__PAGE__?{\\\"locale\\\":\\\"fr\\\",\\\"id\\\":\\\"erreurs_javascript_ameliorees\\\"}\",{}]}]}]},\"$undefined\",\"$undefined\",true]}]}],\"initialSeedData\":[\"\",{\"children\":[\"(withLocale)\",{\"children\":[[\"locale\",\"fr\",\"d\"],{\"children\":[\"blog\",{\"children\":[[\"id\",\"erreurs_javascript_ameliorees\",\"d\"],{\"children\":[\"__PAGE__\",{},[\"$L5\",\"$L6\",null]]},[\"$\",\"$L7\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"(withLocale)\",\"children\",\"$8\",\"children\",\"blog\",\"children\",\"$9\",\"children\"],\"loading\":\"$undefined\",\"loadingStyles\":\"$undefined\",\"loadingScripts\":\"$undefined\",\"hasLoading\":false,\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$La\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"notFoundStyles\":\"$undefined\",\"styles\":[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"https://insertafter.com/_next/static/css/b3a30849af1e683f.css\",\"precedence\":\"next\",\"crossOrigin\":\"\"}]]}]]},[\"$\",\"$L7\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"(withLocale)\",\"children\",\"$8\",\"children\",\"blog\",\"children\"],\"loading\":\"$undefined\",\"loadingStyles\":\"$undefined\",\"loadingScripts\":\"$undefined\",\"hasLoading\":false,\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$La\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"notFoundStyles\":\"$undefined\",\"styles\":null}]]},[null,\"$Lb\",null]]},[\"$\",\"$L7\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"(withLocale)\",\"children\"],\"loading\":\"$undefined\",\"loadingStyles\":\"$undefined\",\"loadingScripts\":\"$undefined\",\"hasLoading\":false,\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$La\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":[[\"$\",\"title\",null,{\"children\":\"404: This page could not be found.\"}],[\"$\",\"div\",null,{\"style\":{\"fontFamily\":\"system-ui,\\\"Segoe UI\\\",Roboto,Helvetica,Arial,sans-serif,\\\"Apple Color Emoji\\\",\\\"Segoe UI Emoji\\\"\",\"height\":\"100vh\",\"textAlign\":\"center\",\"display\":\"flex\",\"flexDirection\":\"column\",\"alignItems\":\"center\",\"justifyContent\":\"center\"},\"children\":[\"$\",\"div\",null,{\"children\":[[\"$\",\"style\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"body{color:#000;background:#fff;margin:0}.next-error-h1{border-right:1px solid rgba(0,0,0,.3)}@media (prefers-color-scheme:dark){body{color:#fff;background:#000}.next-error-h1{border-right:1px solid rgba(255,255,255,.3)}}\"}}],[\"$\",\"h1\",null,{\"className\":\"next-error-h1\",\"style\":{\"display\":\"inline-block\",\"margin\":\"0 20px 0 0\",\"padding\":\"0 23px 0 0\",\"fontSize\":24,\"fontWeight\":500,\"verticalAlign\":\"top\",\"lineHeight\":\"49px\"},\"children\":\"404\"}],[\"$\",\"div\",null,{\"style\":{\"display\":\"inline-block\"},\"children\":[\"$\",\"h2\",null,{\"style\":{\"fontSize\":14,\"fontWeight\":400,\"lineHeight\":\"49px\",\"margin\":0},\"children\":\"This page could not be found.\"}]}]]}]}]],\"notFoundStyles\":[],\"styles\":[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"https://insertafter.com/_next/static/css/655a273f6fe37552.css\",\"precedence\":\"next\",\"crossOrigin\":\"\"}]]}]]},[\"$\",\"$L7\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\"],\"loading\":\"$undefined\",\"loadingStyles\":\"$undefined\",\"loadingScripts\":\"$undefined\",\"hasLoading\":false,\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$La\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":[[\"$\",\"title\",null,{\"children\":\"404: This page could not be found.\"}],[\"$\",\"div\",null,{\"style\":\"$c\",\"children\":[\"$\",\"div\",null,{\"children\":[[\"$\",\"style\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"body{color:#000;background:#fff;margin:0}.next-error-h1{border-right:1px solid rgba(0,0,0,.3)}@media (prefers-color-scheme:dark){body{color:#fff;background:#000}.next-error-h1{border-right:1px solid rgba(255,255,255,.3)}}\"}}],[\"$\",\"h1\",null,{\"className\":\"next-error-h1\",\"style\":\"$d\",\"children\":\"404\"}],[\"$\",\"div\",null,{\"style\":\"$e\",\"children\":[\"$\",\"h2\",null,{\"style\":\"$f\",\"children\":\"This page could not be found.\"}]}]]}]}]],\"notFoundStyles\":[],\"styles\":null}]],\"initialHead\":[false,\"$L10\"],\"globalErrorComponent\":\"$11\"}]]\n"])</script><script>self.__next_f.push([1,"12:\"$Sreact.strict_mode\"\n13:I[4630,[\"176\",\"static/chunks/176-0a03be62efe5672b.js\",\"960\",\"static/chunks/app/(withLocale)/%5Blocale%5D/layout-3730889d272dc34b.js\"],\"\"]\n14:I[4341,[\"176\",\"static/chunks/176-0a03be62efe5672b.js\",\"960\",\"static/chunks/app/(withLocale)/%5Blocale%5D/layout-3730889d272dc34b.js\"],\"\"]\n"])</script><script>self.__next_f.push([1,"b:[\"$\",\"$12\",null,{\"children\":[\"$\",\"html\",null,{\"lang\":\"fr\",\"children\":[\"$\",\"body\",null,{\"className\":\"layout_body__jFZuu\",\"children\":[null,[\"$\",\"header\",null,{\"className\":\"header_iaHeader__4vCMA\",\"children\":[\"$\",\"div\",null,{\"className\":\"$undefined\",\"children\":[\"$\",\"h1\",null,{\"children\":[\"$\",\"a\",null,{\"href\":\"/fr\",\"title\":\"Retour √† l‚Äôaccueil\",\"className\":\"header_iaHeaderLogo__0uNr1\",\"children\":[\"$\",\"img\",null,{\"src\":\"/images/logo.svg\",\"alt\":\"Logo d‚ÄôInsertAfter\"}]}]}]}]}],[\"$\",\"$L13\",null,{\"locale\":\"fr\",\"dictionary\":{\"home\":{\"label\":\"Accueil\",\"title\":\"Retour √† l‚Äôaccueil\"},\"blog\":{\"label\":\"Blog\",\"title\":\"Retour √† l‚Äôindex du blog\"},\"projects\":{\"label\":\"Projets\",\"title\":\"D√©couvrir mes divers projets\"},\"about\":{\"label\":\"√Ä propos\",\"title\":\"En savoir plus √† mon sujet\"}}}],[\"$\",\"$L14\",null,{\"locale\":\"fr\"}],[\"$\",\"main\",null,{\"className\":\"layout_iaMain__6s2gl\",\"children\":[\"$\",\"div\",null,{\"children\":[\"$\",\"$L7\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"(withLocale)\",\"children\",\"$8\",\"children\"],\"loading\":\"$undefined\",\"loadingStyles\":\"$undefined\",\"loadingScripts\":\"$undefined\",\"hasLoading\":false,\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$La\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$L15\",\"notFoundStyles\":[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"https://insertafter.com/_next/static/css/09b5c201fbf055fc.css\",\"precedence\":\"next\",\"crossOrigin\":\"\"}]],\"styles\":null}]}]}],[\"$\",\"aside\",null,{\"className\":\"social_iaSocial__kdR1x\",\"children\":[\"$\",\"nav\",null,{\"children\":[\"$\",\"ul\",null,{\"children\":[[\"$\",\"li\",null,{\"children\":[\"$\",\"a\",null,{\"href\":\"https://mastodon.social/@nfroidure\",\"rel\":\"me\",\"title\":\"Me suivre sur Mastodon\",\"className\":\"social_iaSocialMastodon__MTF6o\",\"children\":[\"$\",\"span\",null,{\"children\":\"Mastodon\"}]}]}],[\"$\",\"li\",null,{\"children\":[\"$\",\"a\",null,{\"href\":\"https://bsky.app/profile/nfroidure.bsky.social\",\"rel\":\"me\",\"title\":\"Me suivre sur Bluesky\",\"className\":\"social_iaSocialBluesky__fKW6M\",\"children\":[\"$\",\"span\",null,{\"children\":\"Bluesky\"}]}]}],[\"$\",\"li\",null,{\"children\":[\"$\",\"a\",null,{\"href\":\"https://twitter.com/nfroidure\",\"title\":\"Me suivre sur Twitter\",\"className\":\"social_iaSocialTwitter__9nU6R\",\"children\":[\"$\",\"span\",null,{\"children\":\"Twitter\"}]}]}],[\"$\",\"li\",null,{\"children\":[\"$\",\"a\",null,{\"href\":\"https://github.com/nfroidure\",\"title\":\"Voir mes projets sur GitHub\",\"className\":\"social_iaSocialGithub__vcU5_\",\"children\":[\"$\",\"span\",null,{\"children\":\"GitHub\"}]}]}],[\"$\",\"li\",null,{\"children\":[\"$\",\"a\",null,{\"href\":\"https://www.npmjs.org/~nfroidure\",\"title\":\"Voir mon compte NPM\",\"className\":\"social_iaSocialNpm__6nku5\",\"children\":[\"$\",\"span\",null,{\"children\":\"NPM\"}]}]}],[\"$\",\"li\",null,{\"children\":[\"$\",\"a\",null,{\"href\":\"https://www.linkedin.com/in/nfroidure/\",\"rel\":\"me\",\"title\":\"Voir mon profil LinkedIn\",\"className\":\"social_iaSocialLinkedin__pWACO\",\"children\":[\"$\",\"span\",null,{\"children\":\"LinkedIn\"}]}]}],[\"$\",\"li\",null,{\"children\":[\"$\",\"a\",null,{\"href\":\"https://facebook.com/nicolas.froidure.douai\",\"rel\":\"me\",\"title\":\"Me suivre sur Facebook\",\"className\":\"social_iaSocialFacebook__w4wfH\",\"children\":[\"$\",\"span\",null,{\"children\":\"Facebook\"}]}]}],[\"$\",\"li\",null,{\"children\":[\"$\",\"a\",null,{\"href\":\"/fr/blog/index.atom\",\"title\":\"S‚Äôabonner au flux RSS\",\"className\":\"social_iaSocialFeed__gEQQ0\",\"children\":[\"$\",\"span\",null,{\"children\":\"Flux RSS\"}]}]}]]}]}]}],[\"$\",\"footer\",null,{\"className\":\"footer_iaFooter__rhlnQ\",\"children\":[\"$\",\"p\",null,{\"className\":\"footer_iaFooterContent__VZndF\",\"children\":[\"¬© Nicolas Froidure 2012-\",2024]}]}]]}]}]}]\n"])</script><script>self.__next_f.push([1,"15:[\"$\",\"section\",null,{\"className\":\"contentBlock_root__802UK\",\"children\":[[\"$\",\"h1\",null,{\"className\":\"h1_root__VPXQG\",\"children\":\"Page not found\"}],[\"$\",\"p\",null,{\"className\":\"not-found_p__fvcGn\",\"children\":[[\"$\",\"img\",null,{\"className\":\"not-found_img__IT2jY\",\"src\":\"https://media.giphy.com/media/12mPcp41D9a1i0/giphy.gif\",\"alt\":\"404.png\"}],[\"$\",\"p\",null,{\"className\":\"p_root__SHE_W\",\"children\":\"It seems that the page you look for doesn't exist.\"}]]}]]}]\n"])</script><script>self.__next_f.push([1,"16:I[5250,[\"176\",\"static/chunks/176-0a03be62efe5672b.js\",\"790\",\"static/chunks/790-a194f74901d33197.js\",\"798\",\"static/chunks/app/(withLocale)/%5Blocale%5D/blog/%5Bid%5D/page-8524fb70a93a8de3.js\"],\"\"]\n"])</script><script>self.__next_f.push([1,"6:[[\"$\",\"section\",null,{\"className\":\"contentBlock_root__802UK\",\"children\":[[[\"$\",\"h1\",null,{\"className\":\"h1_root__VPXQG\",\"children\":[[\"$\",\"span\",\"0\",{\"children\":\"Am√©liorer les erreurs JavaScript\"}]]}],[\"$\",\"p\",null,{\"className\":\"p_root__SHE_W\",\"children\":[[\"$\",\"span\",\"0\",{\"children\":\"Chez SimpliField, nous avons une base de code JavaScript tr√®s cons√©quente, de plus, nous avons un cycle de release tr√®s court. C'est pourquoi une gestion des erreurs pertinente est une n√©cessit√© pour nous.\"}]]}],[\"$\",\"p\",null,{\"className\":\"p_root__SHE_W\",\"children\":[[\"$\",\"span\",\"0\",{\"children\":\"J'ai d√©j√† parl√© de la \"}],[\"$\",\"$L16\",null,{\"href\":\"./erreurs_javascript\",\"className\":\"a_root__WEPS7\",\"title\":null,\"target\":\"_self\",\"children\":[null,[[\"$\",\"span\",\"0\",{\"children\":\"gestion des erreurs en JavaScript\"}]]]}],[\"$\",\"span\",\"2\",{\"children\":\" sur ce blog, mais de fa√ßon purement th√©orique et architecturale. Je voudrais parler ici de d√©tails d'impl√©mentation que nous avons mis en pratique avec succ√®s.\"}]]}],[\"$\",\"h2\",null,{\"className\":\"h2_root__Y02lX\",\"children\":[\"$\",\"span\",null,{\"className\":\"anchored_root__HWi6K\",\"children\":[[[\"$\",\"span\",\"0\",{\"children\":\"s/message d'erreur/code d'erreur/\"}]],\" \",[\"$\",\"small\",null,{\"children\":[\"$\",\"$L16\",null,{\"href\":\"#s-message-d-erreur-code-d-erreur\",\"className\":\"anchored_icon__N5Sem\",\"id\":\"s-message-d-erreur-code-d-erreur\",\"title\":\"Lien vers cette section\",\"children\":[\"$\",\"span\",null,{\"children\":\"üîó\"}]}]}]]}]}],[\"$\",\"p\",null,{\"className\":\"p_root__SHE_W\",\"children\":[[\"$\",\"span\",\"0\",{\"children\":\"La premi√®re strat√©gie que je mets en place sur tous mes d√©veloppements est de pr√©f√©rer des codes d'erreurs que des messages. Pour comprendre pourquoi, prenons un exemple simple ; la v√©rification qu'un nombre est dans un intervalle donn√©.\"}]]}],[\"$\",\"p\",null,{\"className\":\"p_root__SHE_W\",\"children\":[[\"$\",\"span\",\"0\",{\"children\":\"Un choix de POO classique serait d'utiliser une \\\"classe\\\" d'erreur. En JavaScript, nous en avons m√™me une native¬†:\"}]]}],[\"$\",\"div\",null,{\"className\":\"code_root__5JLV_\",\"children\":[\"$\",\"code\",null,{\"children\":[\"$\",\"pre\",null,{\"children\":\"function checkBounds(n) {\\n  if (n \u003c 2) {\\n    throw new RangeError(\\\"Out of range (\\\" + n + \\\"\u003c2)\\\");\\n  }\\n  if (n \u003e 4) {\\n    throw new RangeError(\\\"Out of range (\\\" + n + \\\"\u003e4)\\\");\\n  }\\n}\"}]}]}],[\"$\",\"p\",null,{\"className\":\"p_root__SHE_W\",\"children\":[[\"$\",\"span\",\"0\",{\"children\":\"A priori, cette erreur peut sembler tout √† fait claire et exploitable. Mais √† l'usage, on va rencontrer divers probl√®mes, dont un majeur, la qualification de cette erreur √† un autre niveau du programme.\"}]]}],[\"$\",\"p\",null,{\"className\":\"p_root__SHE_W\",\"children\":[[\"$\",\"span\",\"0\",{\"children\":\"En effet, comment savoir, quand on l'attrapera par ailleurs dans notre application, ce qu'il faut en faire¬†? Simple me direz-vous, nous allons utiliser l'op√©rateur \"}],[\"$\",\"code\",null,{\"className\":\"code_root__5JLV_\",\"children\":\"instanceof\"}],[\"$\",\"span\",\"2\",{\"children\":\"¬†!\"}]]}],[\"$\",\"div\",null,{\"className\":\"code_root__5JLV_\",\"children\":[\"$\",\"code\",null,{\"children\":[\"$\",\"pre\",null,{\"children\":\"try {\\n  checkBounds(6);\\n} catch(err) {\\n  if(err instanceof RangeError) {\\n    console.log('Erreur d'intervalle');\\n  }\\n}\"}]}]}],[\"$\",\"p\",null,{\"className\":\"p_root__SHE_W\",\"children\":[[\"$\",\"span\",\"0\",{\"children\":\"Cette approche marche dans une petite application, mais avec des applications de dizaines, voire centaines, de milliers de lignes, elle n'est plus du tout viable.\"}]]}],[\"$\",\"p\",null,{\"className\":\"p_root__SHE_W\",\"children\":[[\"$\",\"span\",\"0\",{\"children\":\"En effet, ceci n√©cessiterait d'h√©riter du constructeur \"}],[\"$\",\"code\",null,{\"className\":\"code_root__5JLV_\",\"children\":\"Error\"}],[\"$\",\"span\",\"2\",{\"children\":\" pour chaque type d'erreur et cr√©erait tout une base de code annexe bien connue des d√©veloppeurs Java...\"}]]}],[\"$\",\"p\",null,{\"className\":\"p_root__SHE_W\",\"children\":[[\"$\",\"span\",\"0\",{\"children\":\"Nous devons faire mieux. Une autre strat√©gie est de se baser sur le message d'erreur¬†:\"}]]}],[\"$\",\"div\",null,{\"className\":\"code_root__5JLV_\",\"children\":[\"$\",\"code\",null,{\"children\":[\"$\",\"pre\",null,{\"children\":\"try {\\n  checkBounds(6);\\n} catch (err) {\\n  if (err.message.startsWith(\\\"Out of range\\\")) {\\n    console.log(\\\"Erreur d'intervalle\\\");\\n  }\\n}\"}]}]}],[\"$\",\"p\",null,{\"className\":\"p_root__SHE_W\",\"children\":[[\"$\",\"span\",\"0\",{\"children\":\"Ici, ce n'est pas tr√®s parlant, mais un message d'erreur sous forme de phrase est la porte ouverte √† tous les abus¬†:). Si l'auteur du message a tendance √† √©crire un roman pour chaque erreur, votre code va se d√©t√©riorer rapidement.\"}]]}],[\"$\",\"p\",null,{\"className\":\"p_root__SHE_W\",\"children\":[[\"$\",\"span\",\"0\",{\"children\":\"Sans compter qu'au moindre changement de mot ou √† la moindre correction de faute d'orthographe, vous pourrez revoir votre logique de diff√©rentiation des erreurs. C'est pour ces raisons que je n'utilise plus de messages d'erreur, mais plut√¥t des codes d'erreur simples et concis.\"}]]}],[\"$\",\"p\",null,{\"className\":\"p_root__SHE_W\",\"children\":[[\"$\",\"span\",\"0\",{\"children\":\"Autre probl√®me avec cette approche, si vous souhaitez obtenir des informations sur l'erreur (du style n est sup√©rieur ou inf√©rieur √† l'intervalle), vous pouvez sortir vos \"}],[\"$\",\"code\",null,{\"className\":\"code_root__5JLV_\",\"children\":\"RegExp\"}],[\"$\",\"span\",\"2\",{\"children\":\"¬†:).\"}]]}],[\"$\",\"p\",null,{\"className\":\"p_root__SHE_W\",\"children\":[[\"$\",\"span\",null,{\"className\":\"img_root__vTZoG img_landscape__qBqfT\",\"children\":[[\"$\",\"span\",null,{\"className\":\"img_picture__pfsl0\",\"children\":[\"$\",\"img\",null,{\"alt\":\"A propos des personnes qui font leur RegExp elles m√™me, transcription sur le site de la source.\",\"src\":\"https://www.commitstrip.com/wp-content/uploads/2013/03/Strips-Expressions-r%C3%A9guli%C3%A8res-550-final.jpg\"}]}],null]}],[\"$\",\"span\",\"1\",{\"children\":\"\\n\"}],[\"$\",\"$L16\",null,{\"href\":\"https://www.commitstrip.com/fr/2013/03/06/quelquun-sy-connait-en-expressions-regulieres/\",\"className\":\"a_root__WEPS7\",\"title\":\"Voir la planche sur le site des auteurs\",\"target\":\"_blank\",\"children\":[null,[[\"$\",\"span\",\"0\",{\"children\":\"Source: Commit Strip\"}]]]}]]}],[\"$\",\"p\",null,{\"className\":\"p_root__SHE_W\",\"children\":[[\"$\",\"span\",\"0\",{\"children\":\"Chez moi, la fonction de v√©rification d'intervalle ressemble plut√¥t √† √ßa¬†:\"}]]}],[\"$\",\"div\",null,{\"className\":\"code_root__5JLV_\",\"children\":[\"$\",\"code\",null,{\"children\":[\"$\",\"pre\",null,{\"children\":\"var YError = require(\\\"yerror\\\");\\nfunction checkBounds(n) {\\n  if (n \u003c 2) {\\n    throw new YError(\\\"E_RANGE\\\", \\\"2\\\", n);\\n  }\\n  if (n \u003e 4) {\\n    throw new YError(\\\"E_RANGE\\\", 4, n);\\n  }\\n}\"}]}]}],[\"$\",\"p\",null,{\"className\":\"p_root__SHE_W\",\"children\":[[\"$\",\"span\",\"0\",{\"children\":\"Et son utilisation, √† √ßa¬†:\"}]]}],[\"$\",\"div\",null,{\"className\":\"code_root__5JLV_\",\"children\":[\"$\",\"code\",null,{\"children\":[\"$\",\"pre\",null,{\"children\":\"try {\\n  checkBounds(6);\\n} catch (err) {\\n  if (\\\"E_RANGE\\\" === err.code) {\\n    console.log(\\\"Erreur d'intervalle, n=\\\" + err.params[1] + \\\".\\\");\\n  }\\n}\"}]}]}],[\"$\",\"p\",null,{\"className\":\"p_root__SHE_W\",\"children\":[[\"$\",\"span\",\"0\",{\"children\":\"Plusieurs avantages¬†:\"}]]}],[\"$\",\"ul\",null,{\"className\":\"ul_ul__qh0e9\",\"children\":[[\"$\",\"li\",null,{\"className\":\"li_root__oY9Dv\",\"children\":[[\"$\",\"p\",null,{\"className\":\"p_root__SHE_W\",\"children\":[[\"$\",\"span\",\"0\",{\"children\":\"le code d'erreur se suffit √† lui-m√™me, pas besoin d'une phrase pour le comprendre.\"}]]}]]}],[\"$\",\"li\",null,{\"className\":\"li_root__oY9Dv\",\"children\":[[\"$\",\"p\",null,{\"className\":\"p_root__SHE_W\",\"children\":[[\"$\",\"span\",\"0\",{\"children\":\"les param√®tres de l'erreur permettent de comprendre ce qui l'a g√©n√©r√©e et m√™me de l'analyser programmatiquement de fa√ßon simple.\"}]]}]]}],[\"$\",\"li\",null,{\"className\":\"li_root__oY9Dv\",\"children\":[[\"$\",\"p\",null,{\"className\":\"p_root__SHE_W\",\"children\":[[\"$\",\"span\",\"0\",{\"children\":\"si cette erreur vient √† faire planter le serveur de production, j'ai d√©j√† des informations pour comprendre pourquoi sans avoir √† revenir dans le m√™me √©tat.\"}]]}]]}],[\"$\",\"li\",null,{\"className\":\"li_root__oY9Dv\",\"children\":[[\"$\",\"p\",null,{\"className\":\"p_root__SHE_W\",\"children\":[[\"$\",\"span\",\"0\",{\"children\":\"si je souhaite afficher cette erreur √† l'utilisateur, la gestion de l'internationalisation sera plus facile (le code √©tant la cl√© du message et les param√®tres permettant de le compl√©ter de fa√ßon internationalis√©e, par exemple, en affichant les nombres au format local).\"}]]}]]}]]}],[\"$\",\"h2\",null,{\"className\":\"h2_root__Y02lX\",\"children\":[\"$\",\"span\",null,{\"className\":\"anchored_root__HWi6K\",\"children\":[[[\"$\",\"span\",\"0\",{\"children\":\"Erreurs asynchrones et trace d'erreur\"}]],\" \",[\"$\",\"small\",null,{\"children\":[\"$\",\"$L16\",null,{\"href\":\"#erreurs-asynchrones-et-trace-d-erreur\",\"className\":\"anchored_icon__N5Sem\",\"id\":\"erreurs-asynchrones-et-trace-d-erreur\",\"title\":\"Lien vers cette section\",\"children\":[\"$\",\"span\",null,{\"children\":\"üîó\"}]}]}]]}]}],[\"$\",\"p\",null,{\"className\":\"p_root__SHE_W\",\"children\":[[\"$\",\"span\",\"0\",{\"children\":\"Le principal probl√®me des erreurs asynchrones est qu'elles ne permettent pas toujours de comprendre l'origine du probl√®me et le parcours de l'erreur dans votre code asynchrone.\"}]]}],[\"$\",\"p\",null,{\"className\":\"p_root__SHE_W\",\"children\":[[\"$\",\"span\",\"0\",{\"children\":\"Certaines librairies vous proposent des fonctionnalit√©s pour g√©rer ceci comme la m√©thode\"}],[\"$\",\"$L16\",null,{\"href\":\"https://github.com/petkaantonov/bluebird/blob/master/API.md#promiselongstacktraces---void\",\"className\":\"a_root__WEPS7\",\"title\":null,\"target\":\"_blank\",\"children\":[null,[[\"$\",\"span\",\"0\",{\"children\":\" Promise.longStackTrace()\"}]]]}],[\"$\",\"span\",\"2\",{\"children\":\" de BlueBird. Mais il est assez laborieux de faire cohabiter les diff√©rentes librairies entre elles. De plus, les traces produites sont souvent tr√®s verbeuses car pas du tout s√©lectives.\"}]]}],[\"$\",\"p\",null,{\"className\":\"p_root__SHE_W\",\"children\":[[\"$\",\"span\",\"0\",{\"children\":\"√Ä cette fin, je pr√©f√®re g√©rer cette long stack trace manuellement en identifiant les secteurs importants de l'application qui n√©cessitent que je r√©cup√®re la trace en cours. Prenons la cha√Æne de promise suivante¬†:\"}]]}],[\"$\",\"div\",null,{\"className\":\"code_root__5JLV_\",\"children\":[\"$\",\"code\",null,{\"children\":[\"$\",\"pre\",null,{\"children\":\"function updatePassword(id, passwd) {\\n  return getUser(id)\\n    .then(checkPassword(passwd))\\n    .then(changePassword(passwd))\\n    .then(sendWarningEMail)\\n    .catch(function (err) {\\n      return YError.bump(err);\\n    });\\n}\"}]}]}],[\"$\",\"p\",null,{\"className\":\"p_root__SHE_W\",\"children\":[[\"$\",\"span\",\"0\",{\"children\":\"Dans cette cha√Æne de promise, ce qui m'int√©resse, c'est d'avoir la stack initiale de l'erreur et de savoir qu'elle a eu lieu dans cette cha√Æne de promise. Le reste n'est que du bruit. C'est pourquoi j'utilise explicitement la fonction \"}],[\"$\",\"code\",null,{\"className\":\"code_root__5JLV_\",\"children\":\"YError.bump()\"}],[\"$\",\"span\",\"2\",{\"children\":\".\"}]]}],[\"$\",\"h2\",null,{\"className\":\"h2_root__Y02lX\",\"children\":[\"$\",\"span\",null,{\"className\":\"anchored_root__HWi6K\",\"children\":[[[\"$\",\"span\",\"0\",{\"children\":\"Requalification\"}]],\" \",[\"$\",\"small\",null,{\"children\":[\"$\",\"$L16\",null,{\"href\":\"#requalification\",\"className\":\"anchored_icon__N5Sem\",\"id\":\"requalification\",\"title\":\"Lien vers cette section\",\"children\":[\"$\",\"span\",null,{\"children\":\"üîó\"}]}]}]]}]}],[\"$\",\"p\",null,{\"className\":\"p_root__SHE_W\",\"children\":[[\"$\",\"span\",\"0\",{\"children\":\"Bien souvent, quand on attrape une erreur, c'est que l'on souhaite la requalifier. En effet, une erreur de type \"}],[\"$\",\"code\",null,{\"className\":\"code_root__5JLV_\",\"children\":\"'undefined' is not a function\"}],[\"$\",\"span\",\"2\",{\"children\":\" n'a aucun sens pour les utilisateurs. C'est √©galement g√©n√©ralement le cas des erreurs de bas niveau que vos librairies remontent.\"}]]}],[\"$\",\"p\",null,{\"className\":\"p_root__SHE_W\",\"children\":[[\"$\",\"span\",\"0\",{\"children\":\"Malheureusement, cette requalification g√©n√®re souvent une perte d'information si on se contente na√Øvement de cr√©er une autre erreur parall√®lement. Mon approche dans ce cas est d'utiliser la m√©thode \"}],[\"$\",\"code\",null,{\"className\":\"code_root__5JLV_\",\"children\":\"YError.wrap()\"}],[\"$\",\"span\",\"2\",{\"children\":\".\"}]]}],[\"$\",\"div\",null,{\"className\":\"code_root__5JLV_\",\"children\":[\"$\",\"code\",null,{\"children\":[\"$\",\"pre\",null,{\"children\":\"function updatePassword(id, passwd) {\\n  return getUser(id)\\n    .then(checkPassword(passwd))\\n    .catch(function(err) {\\n      return YError.wrap(err, 'E_USER_ERROR', id);\\n    });\\n    .then(changePassword(passwd))\\n    .then(sendWarningEMail)\\n    .catch(function(err) {\\n      return YError.wrap(err, 'E_UNEXPECTED', id);\\n    });\\n}\"}]}]}],[\"$\",\"p\",null,{\"className\":\"p_root__SHE_W\",\"children\":[[\"$\",\"span\",\"0\",{\"children\":\"Ici, je requalifie un √©chec √† la r√©cup√©ration de l'utilisateur ou √† la v√©rification du nouveau mot de passe pour qualifier l'erreur comme √©tant due √† l'utilisateur. Dans le cadre d'une API rest, cela permettra de renvoyer une erreur 400. Les autres erreurs seront quand √† elles classifi√©es comme bug et une erreur 500 sera retourn√©e dans ce cas.\"}]]}],[\"$\",\"p\",null,{\"className\":\"p_root__SHE_W\",\"children\":[[\"$\",\"span\",\"0\",{\"children\":\"Mais le v√©ritable avantage de cette m√©thode est que la trace de l'erreur contiendra non-seulement ces nouvelles informations, mais aussi les pr√©c√©dentes, donnant quelque chose de cet ordre¬†:\"}]]}],[\"$\",\"div\",null,{\"className\":\"code_root__5JLV_\",\"children\":[\"$\",\"code\",null,{\"children\":[\"$\",\"pre\",null,{\"children\":\"  E_BAD_PWD_LENGTH (5)\\n    at line XXX\\n    at (...)\\n  E_USER_ERROR (abbacacaabbacacaabbacaca)\\n    at line XXX\\n    at (...)\"}]}]}],[\"$\",\"p\",null,{\"className\":\"p_root__SHE_W\",\"children\":[[\"$\",\"span\",\"0\",{\"children\":\"En r√©alit√©, nous avons un constructeur d'erreur d√©riv√© de YError et bas√© sur le m√™me principe cr√©√© sp√©cifiquement pour les erreurs HTTP. Je pense que nous allons l'open-sourcer d√®s que nous aurons quelques minutes.\"}]]}],[\"$\",\"p\",null,{\"className\":\"p_root__SHE_W\",\"children\":[[\"$\",\"span\",\"0\",{\"children\":\"N'h√©sitez pas √† partager vos recettes¬†! Le code de YError est, bien-s√ªr, \"}],[\"$\",\"$L16\",null,{\"href\":\"https://github.com/SimpliField/yerror\",\"className\":\"a_root__WEPS7\",\"title\":null,\"target\":\"_blank\",\"children\":[null,[[\"$\",\"span\",\"0\",{\"children\":\"disponible sur GitHub\"}]]]}],[\"$\",\"span\",\"2\",{\"children\":\" .\"}]]}]],[\"$\",\"p\",null,{\"className\":\"p_root__SHE_W\",\"children\":[\"Published at\",\" \",\"dimanche 15 mars 2015 √† 12:04:02\",\".\"]}]]}],[\"$\",\"section\",null,{\"className\":\"contentBlock_root__802UK\",\"children\":[\"$\",\"aside\",null,{\"className\":\"share_root__Qm_RR\",\"children\":[[\"$\",\"h2\",null,{\"className\":\"h2_root__Y02lX\",\"children\":\"Commenter et partager\"}],[\"$\",\"p\",null,{\"className\":\"p_root__SHE_W\",\"children\":[[\"$\",\"$L16\",null,{\"href\":\"https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Finsertafter.com%2Fblog%2Ferreurs_javascript_ameliorees\",\"className\":\"a_root__WEPS7\",\"title\":\"Commenter sur Facebook\",\"target\":\"_blank\",\"children\":[null,[[\"$\",\"span\",null,{\"className\":\"share_icon__bi4Q3 share_facebook__JKn8d\"}],\"Facebook\"]]}],\" - \",[\"$\",\"$L16\",null,{\"href\":\"https://twitter.com/intent/tweet/?url=https%3A%2F%2Finsertafter.com%2Fblog%2Ferreurs_javascript_ameliorees\u0026text=Am%C3%A9liorer%20les%20erreurs%20JavaScript\u0026via=nfroidure\",\"className\":\"a_root__WEPS7\",\"title\":\"Commenter sur Twitter\",\"target\":\"_blank\",\"children\":[null,[[\"$\",\"span\",null,{\"className\":\"share_icon__bi4Q3 \"}],\"Twitter\"]]}],\" - \",[\"$\",\"$L16\",null,{\"href\":\"mailto:nicolas.froidure@gmail.com\",\"className\":\"a_root__WEPS7\",\"title\":\"Me r√©pondre par mail\",\"target\":\"_self\",\"children\":[null,[[\"$\",\"span\",null,{\"className\":\"share_icon__bi4Q3 share_mail__yvBDK\"}],\"Courriel\"]]}]]}]]}]}],[\"$\",\"section\",null,{\"className\":\"contentBlock_root__802UK\",\"children\":[\"$\",\"aside\",null,{\"className\":\"page_linkedEntries__jiPuT\",\"children\":[[\"$\",\"h2\",null,{\"className\":\"h2_root__Y02lX\",\"children\":\"Articles similaires\"}],[\"$\",\"p\",null,{\"className\":\"p_root__SHE_W\",\"children\":[\"Dans les cat√©gories\",\" \",\"JavaScript\",\".\"]}],[\"$\",\"div\",null,{\"className\":\"items_entries__5hkLG\",\"children\":[[\"$\",\"div\",\"faire-mieux-qu-angular-avec-require\",{\"className\":\"items_entry_item__GWeg7\",\"children\":[null,[\"$\",\"h2\",null,{\"className\":\"h2_root__Y02lX items_entry_title__vJ_8h\",\"children\":[\"$\",\"$L16\",null,{\"href\":\".//faire-mieux-qu-angular-avec-require\",\"className\":\"a_root__WEPS7 items_entry_link__EtVod\",\"title\":\"Lire cet article de blog\",\"target\":\"_self\",\"children\":[null,\"Faire mieux qu'AngularJS avec require()\"]}]}],[\"$\",\"p\",null,{\"className\":\"p_root__SHE_W items_entry_description__ZWt9y\",\"children\":[\"Le syst√®me CommonJS-like de NodeJS permet un grand nombre de subtilit√©s. Je vous propose de les d√©couvrir en reproduisant les fonctionnalit√©s du syst√®me de modules d'AngularJS.\",\" \",[\"$\",\"br\",null,{}],[\"$\",\"$L16\",null,{\"href\":\".//faire-mieux-qu-angular-avec-require\",\"className\":\"a_root__WEPS7\",\"title\":\"Lire cet article de blog\",\"target\":\"_self\",\"children\":[null,\"Lire la suite\"]}]]}],[\"$\",\"p\",null,{\"className\":\"p_root__SHE_W items_entry_time__iNrot\",\"children\":[\"Published at\",\" \",\"jeudi 12 mars 2015 √† 08:49:00\",\".\"]}],[\"$\",\"div\",null,{\"className\":\"items_clear__3fyGk\"}]]}],[\"$\",\"div\",\"watchdeps\",{\"className\":\"items_entry_item__GWeg7\",\"children\":[null,[\"$\",\"h2\",null,{\"className\":\"h2_root__Y02lX items_entry_title__vJ_8h\",\"children\":[\"$\",\"$L16\",null,{\"href\":\".//watchdeps\",\"className\":\"a_root__WEPS7 items_entry_link__EtVod\",\"title\":\"Lire cet article de blog\",\"target\":\"_self\",\"children\":[null,\"Surveillez les d√©pendances de vos projets NodeJS\"]}]}],[\"$\",\"p\",null,{\"className\":\"p_root__SHE_W items_entry_description__ZWt9y\",\"children\":[\"Avec watchdeps abonnez-vous automatiquement aux d√©pendences de vos projets NodeJS sur GitHub.\",\" \",[\"$\",\"br\",null,{}],[\"$\",\"$L16\",null,{\"href\":\".//watchdeps\",\"className\":\"a_root__WEPS7\",\"title\":\"Lire cet article de blog\",\"target\":\"_self\",\"children\":[null,\"Lire la suite\"]}]]}],[\"$\",\"p\",null,{\"className\":\"p_root__SHE_W items_entry_time__iNrot\",\"children\":[\"Published at\",\" \",\"dimanche 8 mars 2015 √† 11:07:32\",\".\"]}],[\"$\",\"div\",null,{\"className\":\"items_clear__3fyGk\"}]]}],[\"$\",\"div\",\"isomorphisme_par_l_exemple\",{\"className\":\"items_entry_item__GWeg7\",\"children\":[null,[\"$\",\"h2\",null,{\"className\":\"h2_root__Y02lX items_entry_title__vJ_8h\",\"children\":[\"$\",\"$L16\",null,{\"href\":\".//isomorphisme_par_l_exemple\",\"className\":\"a_root__WEPS7 items_entry_link__EtVod\",\"title\":\"Lire cet article de blog\",\"target\":\"_self\",\"children\":[null,\"L'isomorphisme par l'exemple\"]}]}],[\"$\",\"p\",null,{\"className\":\"p_root__SHE_W items_entry_description__ZWt9y\",\"children\":[\"Pr√©sentation sur la gestion des droits dans une application JavaScript de fa√ßon universelle.\",\" \",[\"$\",\"br\",null,{}],[\"$\",\"$L16\",null,{\"href\":\".//isomorphisme_par_l_exemple\",\"className\":\"a_root__WEPS7\",\"title\":\"Lire cet article de blog\",\"target\":\"_self\",\"children\":[null,\"Lire la suite\"]}]]}],[\"$\",\"p\",null,{\"className\":\"p_root__SHE_W items_entry_time__iNrot\",\"children\":[\"Published at\",\" \",\"mardi 3 f√©vrier 2015 √† 08:08:19\",\".\"]}],[\"$\",\"div\",null,{\"className\":\"items_clear__3fyGk\"}]]}]]}]]}]}]]\n"])</script><script>self.__next_f.push([1,"10:[[\"$\",\"meta\",\"0\",{\"name\":\"viewport\",\"content\":\"width=device-width, initial-scale=1\"}],[\"$\",\"meta\",\"1\",{\"name\":\"theme-color\",\"content\":\"#3e78b2\"}],[\"$\",\"meta\",\"2\",{\"charSet\":\"utf-8\"}],[\"$\",\"title\",\"3\",{\"children\":\"Am√©liorer les erreurs JavaScript - Nicolas Froidure\"}],[\"$\",\"meta\",\"4\",{\"name\":\"description\",\"content\":\"Pour un meilleur d√©bogage, il faut de meilleures erreurs. C'est pourquoi j'ai mis en place une strat√©gie pour les rendre plus pertinentes.\"}],[\"$\",\"link\",\"5\",{\"rel\":\"author\",\"href\":\"https://insertafter.com\"}],[\"$\",\"meta\",\"6\",{\"name\":\"author\",\"content\":\"Nicolas Froidure\"}],[\"$\",\"meta\",\"7\",{\"name\":\"robots\",\"content\":\"index, follow\"}],[\"$\",\"link\",\"8\",{\"rel\":\"canonical\",\"href\":\"https://insertafter.com/fr/blog/erreurs_javascript_ameliorees\"}],[\"$\",\"meta\",\"9\",{\"property\":\"og:title\",\"content\":\"Am√©liorer les erreurs JavaScript - Nicolas Froidure\"}],[\"$\",\"meta\",\"10\",{\"property\":\"og:description\",\"content\":\"Pour un meilleur d√©bogage, il faut de meilleures erreurs. C'est pourquoi j'ai mis en place une strat√©gie pour les rendre plus pertinentes.\"}],[\"$\",\"meta\",\"11\",{\"property\":\"og:url\",\"content\":\"https://insertafter.com/fr/blog/erreurs_javascript_ameliorees\"}],[\"$\",\"meta\",\"12\",{\"property\":\"og:site_name\",\"content\":\"Nicolas Froidure\"}],[\"$\",\"meta\",\"13\",{\"property\":\"og:locale\",\"content\":\"fr_FR\"}],[\"$\",\"meta\",\"14\",{\"property\":\"og:image:alt\",\"content\":\"Banni√®re du site\"}],[\"$\",\"meta\",\"15\",{\"property\":\"og:image\",\"content\":\"https://insertafter.com/images/banner.png\"}],[\"$\",\"meta\",\"16\",{\"property\":\"og:type\",\"content\":\"article\"}],[\"$\",\"meta\",\"17\",{\"name\":\"twitter:card\",\"content\":\"summary\"}],[\"$\",\"meta\",\"18\",{\"name\":\"twitter:site\",\"content\":\"@nfroidure\"}],[\"$\",\"meta\",\"19\",{\"name\":\"twitter:creator\",\"content\":\"@nfroidure\"}],[\"$\",\"meta\",\"20\",{\"name\":\"twitter:title\",\"content\":\"Am√©liorer les erreurs JavaScript - Nicolas Froidure\"}],[\"$\",\"meta\",\"21\",{\"name\":\"twitter:description\",\"content\":\"Pour un meilleur d√©bogage, il faut de meilleures erreurs. C'est pourquoi j'ai mis en place une strat√©gie pour les rendre plus pertinentes.\"}],[\"$\",\"meta\",\"22\",{\"name\":\"twitter:image:alt\",\"content\":\"Banni√®re du site\"}],[\"$\",\"meta\",\"23\",{\"name\":\"twitter:image\",\"content\":\"https://insertafter.com/images/banner.png\"}],[\"$\",\"link\",\"24\",{\"rel\":\"icon\",\"href\":\"/images/favicon.svg\",\"type\":\"image/svg+xml\",\"sizes\":\"any\"}],[\"$\",\"link\",\"25\",{\"rel\":\"icon\",\"href\":\"/images/favicon-16.png\",\"type\":\"image/png\",\"sizes\":\"16x16\"}],[\"$\",\"link\",\"26\",{\"rel\":\"icon\",\"href\":\"/images/favicon-128.png\",\"type\":\"image/png\",\"sizes\":\"128x128\"}]]\n"])</script><script>self.__next_f.push([1,"5:null\n"])</script><script>self.__next_f.push([1,""])</script></body></html>