<!DOCTYPE html><html lang="fr"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="preload" as="image" href="/images/logo.svg"/><link rel="stylesheet" href="https://insertafter.com/_next/static/css/5ae1d7c7e300ccde.css" crossorigin="" data-precedence="next"/><link rel="stylesheet" href="https://insertafter.com/_next/static/css/30c50e2434328b9a.css" crossorigin="" data-precedence="next"/><link rel="preload" as="script" fetchPriority="low" href="https://insertafter.com/_next/static/chunks/webpack-aa95dccaf68483d1.js" crossorigin=""/><script src="https://insertafter.com/_next/static/chunks/fd9d1056-5bc70f044f3cb802.js" async="" crossorigin=""></script><script src="https://insertafter.com/_next/static/chunks/938-bf741a2eb8fd4828.js" async="" crossorigin=""></script><script src="https://insertafter.com/_next/static/chunks/main-app-2e6280b5273157a5.js" async="" crossorigin=""></script><script src="https://insertafter.com/_next/static/chunks/176-0a03be62efe5672b.js" async=""></script><script src="https://insertafter.com/_next/static/chunks/app/(withLocale)/%5Blocale%5D/layout-9d5968bc5fa10dc2.js" async=""></script><script src="https://insertafter.com/_next/static/chunks/876-4c07c683293830f5.js" async=""></script><script src="https://insertafter.com/_next/static/chunks/app/(withLocale)/%5Blocale%5D/blog/%5Bid%5D/page-b35c319b7df441da.js" async=""></script><meta name="theme-color" content="#3e78b2"/><title>MongoDB ou la conception probabiliste - Nicolas Froidure</title><meta name="description" content="Concevoir une base de donn√©e MongoDB c&#x27;est composer avec le hasard. Dans ce billet je vous propose de d√©couvrir pourquoi et comment."/><link rel="author" href="https://insertafter.com"/><meta name="author" content="Nicolas Froidure"/><meta name="robots" content="index, follow"/><link rel="canonical" href="https://insertafter.com/fr/blog/design_probabiliste_mongodb"/><meta property="og:title" content="MongoDB ou la conception probabiliste - Nicolas Froidure"/><meta property="og:description" content="Concevoir une base de donn√©e MongoDB c&#x27;est composer avec le hasard. Dans ce billet je vous propose de d√©couvrir pourquoi et comment."/><meta property="og:url" content="https://insertafter.com/fr/blog/design_probabiliste_mongodb"/><meta property="og:site_name" content="Nicolas Froidure"/><meta property="og:locale" content="fr_FR"/><meta property="og:image:alt" content="Banni√®re du site"/><meta property="og:image" content="https://insertafter.com/images/banner.png"/><meta property="og:type" content="article"/><meta name="twitter:card" content="summary"/><meta name="twitter:site" content="@nfroidure"/><meta name="twitter:creator" content="@nfroidure"/><meta name="twitter:title" content="MongoDB ou la conception probabiliste - Nicolas Froidure"/><meta name="twitter:description" content="Concevoir une base de donn√©e MongoDB c&#x27;est composer avec le hasard. Dans ce billet je vous propose de d√©couvrir pourquoi et comment."/><meta name="twitter:image:alt" content="Banni√®re du site"/><meta name="twitter:image" content="https://insertafter.com/images/banner.png"/><link rel="icon" href="/images/favicon.svg" type="image/svg+xml" sizes="any"/><link rel="icon" href="/images/favicon-16.png" type="image/png" sizes="16x16"/><link rel="icon" href="/images/favicon-128.png" type="image/png" sizes="128x128"/><script src="https://insertafter.com/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js" crossorigin="" noModule=""></script></head><body class="layout_body__jFZuu"><header class="header_iaHeader__4vCMA"><div><h1><a href="/fr" title="Retour √† l‚Äôaccueil" class="header_iaHeaderLogo__0uNr1"><img src="/images/logo.svg" alt="Logo d‚ÄôInsertAfter"/></a></h1></div></header><nav class="menu_iaMenu__B_rtj"><ul class="menu_iaMenuBody__0Zveq"><li class="menu_iaMenuItem__rOch4"><a href="/fr" title="Retour √† l‚Äôaccueil" class="">Accueil</a></li><li class="menu_iaMenuItem__rOch4"><a href="/fr/blog" title="Retour √† l‚Äôindex du blog" class="">Blog</a></li><li class="menu_iaMenuItem__rOch4"><a href="/fr/projets" title="D√©couvrir mes divers projets" class="">Projets</a></li><li class="menu_iaMenuItem__rOch4"><a href="/fr/a_propos" title="En savoir plus √† mon sujet" class="">√Ä propos</a></li></ul></nav><nav class="languages_iaLanguages__K2J3W"><ul><li class="languages_iaLanguagesFlag__ruQ4j languages_iaLanguagesFlagEn__angfJ languages_selected__w1dKv"><a href="/en/blog"><span>en</span></a></li><li class="languages_iaLanguagesFlag__ruQ4j languages_iaLanguagesFlagFr__Us5Jb"><a href="/fr/blog"><span>fr</span></a></li></ul></nav><main class="layout_iaMain__6s2gl"><div><section class="contentBlock_root__802UK"><h1 class="h1_root__VPXQG"><span>MongoDB ou la conception probabiliste</span></h1><p class="p_root__SHE_W"><span>Comme je ne vous ai pas tout dit dans mon </span><a class="a_root__WEPS7" target="_self" href="./design_base_donnee_mongodb"><span>dernier billet sur le design de base de donn√©e avec MongoDB</span></a><span>, je me fends d&#x27;un second billet plus g√©n√©raliste sur la philosophie que je mets en ≈ìuvre pour la gestion d&#x27;une base de donn√©e MongoDB.</span></p><p class="p_root__SHE_W"><span>La majeure partie des d√©cisions en mati√®re d&#x27;architecture et de conception de sch√©ma avec MongoDB se r√©sume √† un calcul de probabilit√© (les plus pessimistes diront risque) d&#x27;inconsistance des donn√©es. Et √ßa, pour un DBA, c&#x27;est plut√¥t, nouveau.</span></p><p class="p_root__SHE_W"><span>D&#x27;ailleurs, quand on gratte un peu la surface, on se rend compte que ces probabilit√©s sont au c≈ìur de la conception de MongoDB lui m√™me. Pour illustrer ce fait, parlons un peu de l&#x27;ObjectId.</span></p><h2 class="h2_root__Y02lX"><span class="anchored_root__HWi6K"><span>ObjectId, the WTF primary key</span> <small><a class="anchored_icon__N5Sem" id="objectid-the-wtf-primary-key" title="Lien vers cette section" href="#objectid-the-wtf-primary-key"><span>üîó</span></a></small></span></h2><p class="p_root__SHE_W"><span>Les cl√©s utilis√©es par MongoDB, les </span><a class="a_root__WEPS7" target="_blank" href="https://docs.mongodb.com/manual/reference/method/ObjectId/"><span>ObjectIds</span></a><span>, sont facilement reconnaissables sous forme de cha√Æne de caract√®re. Derri√®re cette s√©quence hexad√©cimale de 24 caract√®res (ex.¬†: babacafebabacafebabacafebabacafe) se cache bien des concepts.</span></p><p class="p_root__SHE_W"><span>Contrairement aux cl√©s auto-incr√©ment√©es que l&#x27;on observe dans la plupart, sinon la totalit√©, des bases de donn√©es relationnelles, les cl√©s de MongoDB sont g√©n√©r√©es gr√¢ce √† une combinaison de quatre valeurs (un timestamp repr√©sentant le nombre de secondes √©coul√©es depuis l&#x27;Epoch Unix, un identifiant &quot;machine&quot;, le pid du processus qui a g√©n√©r√© l&#x27;ObjectId et enfin un compteur incr√©ment√© automatiquement √† chaque cr√©ation d&#x27;id avec une valeur al√©atoire comme base).</span></p><p class="p_root__SHE_W"><span>La question l√©gitime que vous √™tes probablement entrain de vous poser est pourquoi¬†? A premi√®re vue, c&#x27;est bien plus compliqu√© √† retenir qu&#x27;un simple identifiant num√©rique.</span></p><p class="p_root__SHE_W"><span>La raison est simple¬†: pouvoir cr√©er un identifiant sans avoir besoin de synchroniser toutes les instances de MongoDB.</span></p><p class="p_root__SHE_W"><span>En effet, il est d√©j√† difficile </span><a class="a_root__WEPS7" title="Voir un article sur l&#x27;infrastructure d&#x27;Algolia traitant de ce sujet" target="_blank" href="http://highscalability.com/blog/2015/3/9/the-architecture-of-algolias-distributed-search-network.html"><span>d&#x27;incr√©menter un simple un entier</span></a><span> entre les diverses instances d&#x27;un cluster alors imaginez si c&#x27;√©tait le cas pour toutes les collections de MongoDB. Le parti pris est donc de cr√©er cette cl√© unique d&#x27;une fa√ßon telle qu&#x27;il devient impossible de cr√©er la m√™me cl√© sur deux instances diff√©rentes.</span></p><p class="p_root__SHE_W"><span>Ou presque ;). Il existe bel et bien une probabilit√© que ceci arrive, mais cette derni√®re est tellement faible qu&#x27;elle devient n√©gligeable. En effet, il faudrait que deux machines, ayant chacune un processus avec le m√™me pid (ou </span><a class="a_root__WEPS7" target="_blank" href="https://fr.wikipedia.org/wiki/Identifiant%5Fde%5Fprocessus"><span>identifiant de processus</span></a><span>) et le m√™me identifiant machine, cr√©ent dans la m√™me milliseconde, un ObjectId alors que leur compteur interne a la m√™me valeur.</span></p><p class="p_root__SHE_W"><span>Dans la conception d&#x27;API REST, cette caract√©ristique devient m√™me un pr√©cieux avantage puisqu&#x27;elle permet de g√©n√©rer l&#x27;ObjectId de cette ressource directement sur le client qui consomme cette m√™me API. Ainsi, tirer avantage des requ√™tes cr√©ationnelles idempotentes du type PUT et PATCH devient un jeu d&#x27;enfant. En embarquant une biblioth√®que permettant de </span><a class="a_root__WEPS7" target="_blank" href="https://github.com/justaprogrammer/ObjectId.js"><span>g√©n√©rer des ObjectIds</span></a><span> on peu s&#x27;assurer de l&#x27;unicit√© des ressources cr√©√©es c√¥t√© mobile malgr√© les tr√®s probables coupures intempestives typiques des connexions itin√©rantes.</span></p><h2 class="h2_root__Y02lX"><span class="anchored_root__HWi6K"><span>Transactions optimistes</span> <small><a class="anchored_icon__N5Sem" id="transactions-optimistes" title="Lien vers cette section" href="#transactions-optimistes"><span>üîó</span></a></small></span></h2><p class="p_root__SHE_W"><span>MongoDB ne propose pas de syst√®me de transaction. C&#x27;est d&#x27;ailleurs ce qui m&#x27;a rebut√© de prime abord quand j&#x27;ai d√©couvert MongoDB. Les donn√©es √©tant le c≈ìur de tout syst√®me, ne pouvoir garantir l&#x27;√©tat de ces derni√®res et risquer de les voir lentement se d√©grader est inenvisageable pour un concepteur de service web qui se respecte.</span></p><p class="p_root__SHE_W"><span>Alors que faire¬†? Fa√Ætes comme dans la vraie vie. Quand vous prenez votre voiture pour aller chercher du pain, vous savez que ce n&#x27;est pas sans risque. Vous pourriez crever un pneu, avoir un accident etc... Malheureusement, vous ne pouvez pas r√©duire le risque √† n√©ant.</span></p><p class="p_root__SHE_W"><span>En sortant quand m√™me de chez vous, vous arbitrez sur le fait que ces risques sont somme toute n√©gligeables et que la seule fa√ßon d&#x27;arriver √† vos fins efficacement est de prendre ce risque. Vous le prenez cependant de mani√®re intelligente.</span></p><p class="p_root__SHE_W"><span>Vous avez un v√©hicule contr√¥l√© techniquement tous les deux ans, vos pneus sont v√©rifi√©s r√©guli√®rement. Vous avez mis en place toute une batterie de mesures pour r√©duire ce risque.</span></p><p class="p_root__SHE_W"><span>Vous avez √©galement une roue de secours, une trousse de premier soins, un chasuble peut-√™tre m√™me une couverture au cas o√π vous seriez bloqu√© par la neige. Vous avez pris des mesures pour anticiper ce risque, pour √™tre pr√™t si par malchance il se r√©alisait.</span></p><p class="p_root__SHE_W"><span>Bref, vous fa√Ætes une transaction optimiste. Selon toute vraisemblance dans 20 minutes vous serez de retour chez vous avec du pain. Et vous pourrez passer √† l&#x27;op√©ration suivante, pr√©parer le petit d√©jeuner.</span></p><p class="p_root__SHE_W"><span>L√† o√π les bases relationnelles sont bas√©es sur le fait qu&#x27;avec les transactions, th√©oriquement, il n&#x27;y a aucun risque, les bases de donn√©es NoSQL se basent sur le fait que g√©n√©ralement, tout se passe bien.</span></p><p class="p_root__SHE_W"><span>C&#x27;est pourquoi la conception avec MongoDB est plus complexe. Elle demande une bonne r√©flexion et une bonne capacit√© √† mesurer et anticiper les risques l√† o√π une conception relationnelle demande simplement du formalisme.</span></p><p class="p_root__SHE_W"><span>Reprenons mon exemple du billet pr√©c√©dent dans lequel on met √† jour les lieux associ√©s √† un utilisateur¬†:</span></p><div class="code_root__5JLV_"><code><pre>// On s&#x27;assure que les ids donn√©s sont corrects
db.collection(&quot;location&quot;).count(
  {
    _id: {
      $in: myNewLocationsIds,
    },
  },
  function (err, count) {
    if (count != myNewLocationsIds.length) {
      throw new Error(&quot;Bad locations ids&quot;);
    }
    // On met √† jour l&#x27;utilisateur
    UserModel.update(
      {
        _id: ObjectId(&quot;abbacacaabbacacaabbacaca&quot;),
      },
      {
        $set: {
          locations_ids: myNewLocationsIds,
        },
      },
      { multi: true },
    );
  },
);</pre></code></div><p class="p_root__SHE_W"><span>Quels sont les risques¬†? La majorit√© des risques se situent souvent entre deux requ√™tes (d&#x27;o√π l&#x27;int√©r√™t des techniques pr√©sent√©es dans l&#x27;article pr√©c√©dent pour les limiter). Le risque se situe donc entre la v√©rification de l&#x27;existence des lieux li√©s et la liaison effective des lieux dans le document correspondant √† l&#x27;utilisateur.</span></p><p class="p_root__SHE_W"><span>Pour que ce risque se r√©alise, il faudrait que l&#x27;un de ces lieux soit supprim√© entre la requ√™te de v√©rification et celle de modification. Soyons clairs, ce risque bien qu&#x27;existant est infime. Il est si infime, qu&#x27;on ne peut pas vraiment le r√©duire. On peut, par contre, tr√®s certainement l&#x27;augmenter en utilisant Mongoose ;) (voir billet pr√©c√©dent).</span></p><p class="p_root__SHE_W"><span>En revanche, puisque le risque existe, il s&#x27;agit de ne pas l&#x27;ignorer. Accepter la probabilit√© qu&#x27;un accident survienne en allant chercher du pain ne signifie pas mettre des ≈ìill√®res et se retrouver d√©pourvu face √† sa r√©alisation.</span></p><p class="p_root__SHE_W"><span>Plusieurs strat√©gies peuvent √™tre mises en ≈ìuvre pour pallier √† ces risques, parfois conjointement.</span></p><h4 class="h4_root__NsehS"><span class="anchored_root__HWi6K"><span>R√©silience face √† l&#x27;inconsistance</span> <small><a class="anchored_icon__N5Sem" id="resilience-face-a-l-inconsistance" title="Lien vers cette section" href="#resilience-face-a-l-inconsistance"><span>üîó</span></a></small></span></h4><p class="p_root__SHE_W"><span>La premi√®re strat√©gie qui, selon moi, se doit d&#x27;√™tre automatique. Votre plateforme se doit de continuer de fonctionner en cas d&#x27;inconsistance. Dans le cas de l&#x27;exemple ci-dessus, si il s&#x27;av√®re qu&#x27;un lieu n&#x27;existe plus quand vous cherchez √† obtenir la liste des lieux d&#x27;un utilisateur, vous devez donc silencieusement l&#x27;invalider et non renvoyer une erreur aux consommateurs de votre API. Vous devez aussi logger cette erreur avec une flag reconnaissable pour votre supervision.</span></p><p class="p_root__SHE_W"><span>Typiquement, l&#x27;architecte logiciel se chargera d&#x27;ajouter des tests √† la base de code pour les risques d&#x27;inconsistance identifi√©s et accept√©s par sa conception de fa√ßon √† alerter les d√©veloppeurs de ces derniers. Au niveau code, ceci donnerait¬†:</span></p><div class="code_root__5JLV_"><code><pre>// R√©cup√©ration des identifiants des lieux de l&#x27;utilisateur
db.users.find(
  {
    query: {
      _id: ObjectId(&quot;abbacacaabbacacaabbacacaabbacaca&quot;),
    },
    fields: [&quot;locations_ids&quot;],
  },
  function (err, results) {
    // R√©cup√©ration des lieux
    db.locations.find(
      {
        query: {
          _id: {
            $in: results[0].locations_ids,
          },
        },
        fields: [&quot;location&quot;],
      },
      function (err, results) {
        // On a uniquement les lieux trouv√© donc, si un identifiant √©tait
        // mauvais, osef
        var locations = results.map(function (result) {
          return result.location;
        });
      },
    );
  },
);</pre></code></div><p class="p_root__SHE_W"><span>Ici, le syst√®me de querying de MongoDB nous √©pargne la peine de prendre le cas en charge dans le code.</span><strong class="strong_root__kOzFq"><span>Il doit cependant, je le r√©p√®te, √™tre pris en charge par les tests.</span></strong></p><h4 class="h4_root__NsehS"><span class="anchored_root__HWi6K"><span>Contr√¥le d&#x27;int√©grit√© p√©riodique</span> <small><a class="anchored_icon__N5Sem" id="controle-d-integrite-periodique" title="Lien vers cette section" href="#controle-d-integrite-periodique"><span>üîó</span></a></small></span></h4><p class="p_root__SHE_W"><span>Votre base de donn√©e peu devenir inconsistante. Donc, cr√©ez des scripts¬†! √áa peut para√Ætre b√™te, mais cr√©er des scripts pour contr√¥ler et r√©parer les possibles inconsistances de votre base MongoDB est un excellent moyen de lutter contre elles. Ces scripts peuvent √©galement servir de reminder de toutes les inconsistances possibles.</span></p><p class="p_root__SHE_W"><span>Vous serez √©galement bien contents de les avoir sous la main dans la cas o√π une inconsistance surviendrait plus souvent que pr√©vu. Afin de pouvoir les utiliser comme palliatif le temps de r√©duire la probabilit√© de leur survenance gr√¢ce aux techniques que je vous ai pr√©sent√©.</span></p><h4 class="h4_root__NsehS"><span class="anchored_root__HWi6K"><span>Contr√¥le et traitement opportuniste d&#x27;int√©grit√©</span> <small><a class="anchored_icon__N5Sem" id="controle-et-traitement-opportuniste-d-integrite" title="Lien vers cette section" href="#controle-et-traitement-opportuniste-d-integrite"><span>üîó</span></a></small></span></h4><p class="p_root__SHE_W"><span>Mais il y a mieux¬†:). Dans notre exemple de code tol√©rant √† l&#x27;inconsistance, je vois une belle opportunit√© de g√©rer √† posteriori les inconsistances. En effet, puisque nous avons fait les requ√™tes permettant de voir l&#x27;inconsistance, pourquoi ne pas la corriger¬†?</span></p><div class="code_root__5JLV_"><code><pre>// R√©cup√©ration des identifiants des lieux de l&#x27;utilisateur
db.users.find(
  {
    query: {
      _id: ObjectId(&quot;abbacacaabbacacaabbacacaabbacaca&quot;),
    },
    fields: [&quot;locations_ids&quot;],
  },
  function (err, results) {
    var locationsIds = results[0].locations_ids;
    // R√©cup√©ration des lieux
    db.locations.find(
      {
        query: {
          _id: {
            $in: locationsIds,
          },
        },
        fields: [&quot;location&quot;],
      },
      function (err, results) {
        // On a uniquement les lieux trouv√© donc, si un identifiant √©tait
        // mauvais, osef
        var locations = results.map(function (result) {
          return result.location;
        });
        // Petit ajout pour traiter les inconsistances
        var badLocationsIds = locationsIds.filter(function (locationId) {
          return locations.every(function (location) {
            return location._id.toString() !== locationId.toString();
          });
        });
        // Si on en a, on fait la requ√™te qui va bien
        if (badLocationsIds.length) {
          db.users.update(
            {
              _id: ObjectId(&quot;abbacacaabbacacaabbacacaabbacaca&quot;),
            },
            {
              $pullAll: {
                locations_ids: badLocationsIds,
              },
            },
          );
        }
      },
    );
  },
);</pre></code></div><p class="p_root__SHE_W"><span>On peut s&#x27;inqui√©ter de l&#x27;empreinte de cette correction d&#x27;inconsistance sur les performances du syst√®me. Il faut cependant temp√©rer cette crainte par le fait que les inconsistances dans un syst√®me bien con√ßu sont rares.</span></p><p class="p_root__SHE_W"><span>De plus, il est possible d&#x27;utiliser la fonction </span><code class="code_root__5JLV_">setTimeout()</code><span> de JavaScript pour d√©coupler ces v√©rifications du reste du code pour ne pas nuire aux performances si cela s&#x27;av√©rait n√©cessaire.</span></p><h4 class="h4_root__NsehS"><span class="anchored_root__HWi6K"><span>Isolation</span> <small><a class="anchored_icon__N5Sem" id="isolation" title="Lien vers cette section" href="#isolation"><span>üîó</span></a></small></span></h4><p class="p_root__SHE_W"><span>Vous avez probablement remarqu√© que les risques d&#x27;inconsistances sont souvent d√ªs √† la concurrence possible sur les m√™me donn√©es de deux utilisateurs diff√©rents de votre API.</span></p><p class="p_root__SHE_W"><span>La r√©sultante de ceci est bien s√ªr que le trafic sur votre plateforme change totalement les probabilit√©s d&#x27;inconsistance. Ainsi, si vous avez un seul utilisateur elles sont quasi nulles, en revanche, si des millions d&#x27;utilisateurs l&#x27;utilisent, elles deviennent plus probables.</span></p><p class="p_root__SHE_W"><span>Un bon moyen de limiter les inconsistances est donc la cr√©ation de silos artificiels. Par exemple, si votre plateforme contient des organisations diff√©rentes et qu&#x27;aucun document n&#x27;est partag√© entre deux organisations √† aucun moment, f√©licitations, vous avez divis√© le risque d&#x27;inconsistance d√ª au trafic par le nombre d&#x27;organisations existantes.</span></p><h4 class="h4_root__NsehS"><span class="anchored_root__HWi6K"><span>Supervision</span> <small><a class="anchored_icon__N5Sem" id="supervision" title="Lien vers cette section" href="#supervision"><span>üîó</span></a></small></span></h4><p class="p_root__SHE_W"><span>Traiter silencieusement les inconsistances n&#x27;est pas suffisant. Vous devez recueillir du feedback sur ces derni√®res de mani√®re √† pouvoir faire √©voluer votre syst√®me en connaissance de causes.</span></p><p class="p_root__SHE_W"><span>La supervision et l&#x27;analyse des logs doit √™tre une priorit√©. Par chance, les inconsistances sont sens√©es √™tre rares. C&#x27;est pourquoi, ceci ne devrait pas √™tre trop compliqu√© √† g√©rer. Je suis pour ma part, partisan de l&#x27;envoi de mail √† chaque inconsistance tant que c&#x27;est soutenable (l&#x27;id√©e est de tout faire pour que √ßa le reste ;) ).</span></p><p class="p_root__SHE_W"><span>Toutes ces strat√©gies permettent de g√©rer l&#x27;incertitude pour obtenir un syst√®me scalable. Ce qui est clair, c&#x27;est que cette nouvelle fa√ßon d&#x27;appr√©hender la gestion des donn√©es m&#x27;a clairement fait sortir de ma zone de confort, mais l&#x27;essentiel est d&#x27;avoir retrouv√© un niveau de confiance presque √©quivalent √† celui induit par l&#x27;utilisation d&#x27;une base de donn√©es relationnelle.</span></p><h2 class="h2_root__Y02lX"><span class="anchored_root__HWi6K"><span>Inception</span> <small><a class="anchored_icon__N5Sem" id="inception" title="Lien vers cette section" href="#inception"><span>üîó</span></a></small></span></h2><p class="p_root__SHE_W"><span>On pourrait √©br√©cher cette confiance en r√©fl√©chissant √† toutes les strat√©gies mises en ≈ìuvre ci-dessus. Puisqu&#x27;elles-m√™mes agissent sur les donn√©es, elles peuvent donc √©galement g√©n√©rer des inconsistances.</span></p><p class="p_root__SHE_W"><span>Il est possible que la suppression d&#x27;un identifiant de lieu dans la liste des lieux d&#x27;un utilisateur supprime en fait une association parfaitement l√©gitime.</span></p><p class="p_root__SHE_W"><span>En effet, on a vu qu&#x27;il √©tait possible que deux identifiants MongoDB soient cr√©√©s en m√™me temps et soient identiques. Il est donc possible qu&#x27;un lieu soit cr√©√© avec l&#x27;un de ces identifiants et associ√© √† l&#x27;utilisateur alors m√™me qu&#x27;on est entrain de supprimer cet identifiant par ailleurs pour r√©tablir une int√©grit√© suppos√©e¬†:).</span></p><h2 class="h2_root__Y02lX"><span class="anchored_root__HWi6K"><span>Conception organique</span> <small><a class="anchored_icon__N5Sem" id="conception-organique" title="Lien vers cette section" href="#conception-organique"><span>üîó</span></a></small></span></h2><p class="p_root__SHE_W"><span>J&#x27;aime bien le terme de conception organique. L√† o√π les bases de donn√©es relationnelles sont comme une n√©gation de la nature impr√©visible de l&#x27;univers, MongoDB impose une conception qui rejoint l&#x27;approche naturelle. Une conception organique.</span></p><p class="p_root__SHE_W"><span>J&#x27;aime cette vision philosophique de l&#x27;√©tat d&#x27;un syst√®me qui jongle avec les probabilit√© et compose avec l&#x27;infini. MongoDB, c&#x27;est aussi une conception optimiste, car oui, dans la nature, les choses se passent plus souvent bien que mal.</span></p><p class="p_root__SHE_W"><span>J&#x27;aime ces points de jonction entre la science et la vie. N&#x27;est-ce pas ainsi qu&#x27;on explique d√©sormais la plupart des myst√®res de l&#x27;univers¬†?</span></p><p class="p_root__SHE_W"><span>Toutes les bonnes choses ont une fin, je pense que je reparlerai de MongoDB sur ce blog, en attendant, n&#x27;h√©sitez pas √† donner votre avis. D√©sol√© pour les gifs¬†:p.</span></p><p class="p_root__SHE_W">Published at<!-- --> <!-- -->samedi 4 avril 2015 √† 15:29:02<!-- -->.</p></section><section class="contentBlock_root__802UK"><aside class="share_root__Qm_RR"><h2 class="h2_root__Y02lX">Commenter et partager</h2><p class="p_root__SHE_W"><a class="a_root__WEPS7" title="Commenter sur Facebook" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Finsertafter.com%2Fblog%2Fdesign_probabiliste_mongodb"><span class="share_icon__bi4Q3 share_facebook__JKn8d"></span>Facebook</a> - <a class="a_root__WEPS7" title="Commenter sur Twitter" target="_blank" href="https://twitter.com/intent/tweet/?url=https%3A%2F%2Finsertafter.com%2Fblog%2Fdesign_probabiliste_mongodb&amp;text=MongoDB%20ou%20la%20conception%20probabiliste&amp;via=nfroidure"><span class="share_icon__bi4Q3 "></span>Twitter</a> - <a class="a_root__WEPS7" title="Me r√©pondre par mail" target="_self" href="mailto:nicolas.froidure@gmail.com"><span class="share_icon__bi4Q3 share_mail__yvBDK"></span>Courriel</a></p></aside></section><section class="contentBlock_root__802UK"><aside class="page_linkedEntries__jiPuT"><h2 class="h2_root__Y02lX">Articles similaires</h2><p class="p_root__SHE_W">Dans les cat√©gories<!-- --> <!-- -->MongoDB et Base de donn√©es<!-- -->.</p><div class="items_entries__5hkLG"><div class="items_entry_item__GWeg7"><h2 class="h2_root__Y02lX items_entry_title__vJ_8h"><a class="a_root__WEPS7 items_entry_link__EtVod" title="Lire cet article de blog" target="_self" href=".//design_base_donnee_mongodb">Design de bases de donn√©es MongoDB</a></h2><p class="p_root__SHE_W items_entry_description__ZWt9y">Le design de bases de donn√©es MongoDB est une activit√© complexe qui n√©cessite d&#x27;avoir une profonde connaissance des implications des divers choix possibles.<!-- --> <br/><a class="a_root__WEPS7" title="Lire cet article de blog" target="_self" href=".//design_base_donnee_mongodb">Lire la suite</a></p><p class="p_root__SHE_W items_entry_time__iNrot">Published at<!-- --> <!-- -->samedi 28 mars 2015 √† 13:40:32<!-- -->.</p><div class="items_clear__3fyGk"></div></div><div class="items_entry_item__GWeg7"><h2 class="h2_root__Y02lX items_entry_title__vJ_8h"><a class="a_root__WEPS7 items_entry_link__EtVod" title="Lire cet article de blog" target="_self" href=".//retour_xp_mongodb">MongoDB : Retour d&#x27;exp√©rience</a></h2><p class="p_root__SHE_W items_entry_description__ZWt9y">Je travaille avec MongoDB depuis maintenant presque un an, il est temps pour moi de faire un petit retour sur cette base de donn√©es et sur le NoSQL de mani√®re g√©n√©rale.<!-- --> <br/><a class="a_root__WEPS7" title="Lire cet article de blog" target="_self" href=".//retour_xp_mongodb">Lire la suite</a></p><p class="p_root__SHE_W items_entry_time__iNrot">Published at<!-- --> <!-- -->jeudi 4 d√©cembre 2014 √† 20:44:40<!-- -->.</p><div class="items_clear__3fyGk"></div></div><div class="items_entry_item__GWeg7"><h2 class="h2_root__Y02lX items_entry_title__vJ_8h"><a class="a_root__WEPS7 items_entry_link__EtVod" title="Lire cet article de blog" target="_self" href=".//gerer_monnaies_logiciel">G√©rer les monnaies dans un logiciel (CRM,ERP)</a></h2><p class="p_root__SHE_W items_entry_description__ZWt9y">Je suis actuellement entrain de d√©velopper une solution CRM bas√©e sur mon framework Rest PHP. Il faut donc g√©rer les diff√©rentes monnaies.<!-- --> <br/><a class="a_root__WEPS7" title="Lire cet article de blog" target="_self" href=".//gerer_monnaies_logiciel">Lire la suite</a></p><p class="p_root__SHE_W items_entry_time__iNrot">Published at<!-- --> <!-- -->vendredi 16 novembre 2012 √† 10:24:57<!-- -->.</p><div class="items_clear__3fyGk"></div></div></div></aside></section></div></main><aside class="social_iaSocial__kdR1x"><nav><ul><li><a href="https://mastodon.social/@nfroidure" rel="me" title="Me suivre sur Mastodon" class="social_iaSocialMastodon__MTF6o"><span>Mastodon</span></a></li><li><a href="https://bsky.app/profile/nfroidure.bsky.social" rel="me" title="Me suivre sur Bluesky" class="social_iaSocialBluesky__fKW6M"><span>Bluesky</span></a></li><li><a href="https://twitter.com/nfroidure" title="Me suivre sur Twitter" class="social_iaSocialTwitter__9nU6R"><span>Twitter</span></a></li><li><a href="https://github.com/nfroidure" title="Voir mes projets sur GitHub" class="social_iaSocialGithub__vcU5_"><span>GitHub</span></a></li><li><a href="https://www.npmjs.org/~nfroidure" title="Voir mon compte NPM" class="social_iaSocialNpm__6nku5"><span>NPM</span></a></li><li><a href="https://www.linkedin.com/in/nfroidure/" rel="me" title="Voir mon profil LinkedIn" class="social_iaSocialLinkedin__pWACO"><span>LinkedIn</span></a></li><li><a href="https://facebook.com/nicolas.froidure.douai" rel="me" title="Me suivre sur Facebook" class="social_iaSocialFacebook__w4wfH"><span>Facebook</span></a></li><li><a href="/fr/blog/index.atom" title="S‚Äôabonner au flux RSS" class="social_iaSocialFeed__gEQQ0"><span>Flux RSS</span></a></li></ul></nav></aside><footer class="footer_iaFooter__rhlnQ"><p class="footer_iaFooterContent__VZndF">¬© Nicolas Froidure 2012-<!-- -->2024</p></footer><script src="https://insertafter.com/_next/static/chunks/webpack-aa95dccaf68483d1.js" crossorigin="" async=""></script><script>(self.__next_f=self.__next_f||[]).push([0]);self.__next_f.push([2,null])</script><script>self.__next_f.push([1,"0:\"$L1\"\n"])</script><script>self.__next_f.push([1,"2:HL[\"https://insertafter.com/_next/static/css/5ae1d7c7e300ccde.css\",\"style\",{\"crossOrigin\":\"\"}]\n3:HL[\"https://insertafter.com/_next/static/css/30c50e2434328b9a.css\",\"style\",{\"crossOrigin\":\"\"}]\n"])</script><script>self.__next_f.push([1,"4:I[7690,[],\"\"]\n7:I[5613,[],\"\"]\na:I[1778,[],\"\"]\n11:I[8955,[],\"\"]\n8:[\"locale\",\"fr\",\"d\"]\n9:[\"id\",\"design_probabiliste_mongodb\",\"d\"]\nc:{\"fontFamily\":\"system-ui,\\\"Segoe UI\\\",Roboto,Helvetica,Arial,sans-serif,\\\"Apple Color Emoji\\\",\\\"Segoe UI Emoji\\\"\",\"height\":\"100vh\",\"textAlign\":\"center\",\"display\":\"flex\",\"flexDirection\":\"column\",\"alignItems\":\"center\",\"justifyContent\":\"center\"}\nd:{\"display\":\"inline-block\",\"margin\":\"0 20px 0 0\",\"padding\":\"0 23px 0 0\",\"fontSize\":24,\"fontWeight\":500,\"verticalAlign\":\"top\",\"lineHeight"])</script><script>self.__next_f.push([1,"\":\"49px\"}\ne:{\"display\":\"inline-block\"}\nf:{\"fontSize\":14,\"fontWeight\":400,\"lineHeight\":\"49px\",\"margin\":0}\n"])</script><script>self.__next_f.push([1,"1:[null,[\"$\",\"$L4\",null,{\"buildId\":\"mDCHn5j1V2qyug5qJSTyA\",\"assetPrefix\":\"https://insertafter.com\",\"initialCanonicalUrl\":\"/fr/blog/design_probabiliste_mongodb\",\"initialTree\":[\"\",{\"children\":[\"(withLocale)\",{\"children\":[[\"locale\",\"fr\",\"d\"],{\"children\":[\"blog\",{\"children\":[[\"id\",\"design_probabiliste_mongodb\",\"d\"],{\"children\":[\"__PAGE__?{\\\"locale\\\":\\\"fr\\\",\\\"id\\\":\\\"design_probabiliste_mongodb\\\"}\",{}]}]}]},\"$undefined\",\"$undefined\",true]}]}],\"initialSeedData\":[\"\",{\"children\":[\"(withLocale)\",{\"children\":[[\"locale\",\"fr\",\"d\"],{\"children\":[\"blog\",{\"children\":[[\"id\",\"design_probabiliste_mongodb\",\"d\"],{\"children\":[\"__PAGE__\",{},[\"$L5\",\"$L6\",null]]},[\"$\",\"$L7\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"(withLocale)\",\"children\",\"$8\",\"children\",\"blog\",\"children\",\"$9\",\"children\"],\"loading\":\"$undefined\",\"loadingStyles\":\"$undefined\",\"loadingScripts\":\"$undefined\",\"hasLoading\":false,\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$La\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"notFoundStyles\":\"$undefined\",\"styles\":[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"https://insertafter.com/_next/static/css/30c50e2434328b9a.css\",\"precedence\":\"next\",\"crossOrigin\":\"\"}]]}]]},[\"$\",\"$L7\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"(withLocale)\",\"children\",\"$8\",\"children\",\"blog\",\"children\"],\"loading\":\"$undefined\",\"loadingStyles\":\"$undefined\",\"loadingScripts\":\"$undefined\",\"hasLoading\":false,\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$La\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"notFoundStyles\":\"$undefined\",\"styles\":null}]]},[null,\"$Lb\",null]]},[\"$\",\"$L7\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"(withLocale)\",\"children\"],\"loading\":\"$undefined\",\"loadingStyles\":\"$undefined\",\"loadingScripts\":\"$undefined\",\"hasLoading\":false,\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$La\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":[[\"$\",\"title\",null,{\"children\":\"404: This page could not be found.\"}],[\"$\",\"div\",null,{\"style\":{\"fontFamily\":\"system-ui,\\\"Segoe UI\\\",Roboto,Helvetica,Arial,sans-serif,\\\"Apple Color Emoji\\\",\\\"Segoe UI Emoji\\\"\",\"height\":\"100vh\",\"textAlign\":\"center\",\"display\":\"flex\",\"flexDirection\":\"column\",\"alignItems\":\"center\",\"justifyContent\":\"center\"},\"children\":[\"$\",\"div\",null,{\"children\":[[\"$\",\"style\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"body{color:#000;background:#fff;margin:0}.next-error-h1{border-right:1px solid rgba(0,0,0,.3)}@media (prefers-color-scheme:dark){body{color:#fff;background:#000}.next-error-h1{border-right:1px solid rgba(255,255,255,.3)}}\"}}],[\"$\",\"h1\",null,{\"className\":\"next-error-h1\",\"style\":{\"display\":\"inline-block\",\"margin\":\"0 20px 0 0\",\"padding\":\"0 23px 0 0\",\"fontSize\":24,\"fontWeight\":500,\"verticalAlign\":\"top\",\"lineHeight\":\"49px\"},\"children\":\"404\"}],[\"$\",\"div\",null,{\"style\":{\"display\":\"inline-block\"},\"children\":[\"$\",\"h2\",null,{\"style\":{\"fontSize\":14,\"fontWeight\":400,\"lineHeight\":\"49px\",\"margin\":0},\"children\":\"This page could not be found.\"}]}]]}]}]],\"notFoundStyles\":[],\"styles\":[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"https://insertafter.com/_next/static/css/5ae1d7c7e300ccde.css\",\"precedence\":\"next\",\"crossOrigin\":\"\"}]]}]]},[\"$\",\"$L7\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\"],\"loading\":\"$undefined\",\"loadingStyles\":\"$undefined\",\"loadingScripts\":\"$undefined\",\"hasLoading\":false,\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$La\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":[[\"$\",\"title\",null,{\"children\":\"404: This page could not be found.\"}],[\"$\",\"div\",null,{\"style\":\"$c\",\"children\":[\"$\",\"div\",null,{\"children\":[[\"$\",\"style\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"body{color:#000;background:#fff;margin:0}.next-error-h1{border-right:1px solid rgba(0,0,0,.3)}@media (prefers-color-scheme:dark){body{color:#fff;background:#000}.next-error-h1{border-right:1px solid rgba(255,255,255,.3)}}\"}}],[\"$\",\"h1\",null,{\"className\":\"next-error-h1\",\"style\":\"$d\",\"children\":\"404\"}],[\"$\",\"div\",null,{\"style\":\"$e\",\"children\":[\"$\",\"h2\",null,{\"style\":\"$f\",\"children\":\"This page could not be found.\"}]}]]}]}]],\"notFoundStyles\":[],\"styles\":null}]],\"initialHead\":[false,\"$L10\"],\"globalErrorComponent\":\"$11\"}]]\n"])</script><script>self.__next_f.push([1,"12:\"$Sreact.strict_mode\"\n13:I[4630,[\"176\",\"static/chunks/176-0a03be62efe5672b.js\",\"960\",\"static/chunks/app/(withLocale)/%5Blocale%5D/layout-9d5968bc5fa10dc2.js\"],\"\"]\n14:I[4341,[\"176\",\"static/chunks/176-0a03be62efe5672b.js\",\"960\",\"static/chunks/app/(withLocale)/%5Blocale%5D/layout-9d5968bc5fa10dc2.js\"],\"\"]\n"])</script><script>self.__next_f.push([1,"b:[\"$\",\"$12\",null,{\"children\":[\"$\",\"html\",null,{\"lang\":\"fr\",\"children\":[\"$\",\"body\",null,{\"className\":\"layout_body__jFZuu\",\"children\":[null,[\"$\",\"header\",null,{\"className\":\"header_iaHeader__4vCMA\",\"children\":[\"$\",\"div\",null,{\"className\":\"$undefined\",\"children\":[\"$\",\"h1\",null,{\"children\":[\"$\",\"a\",null,{\"href\":\"/fr\",\"title\":\"Retour √† l‚Äôaccueil\",\"className\":\"header_iaHeaderLogo__0uNr1\",\"children\":[\"$\",\"img\",null,{\"src\":\"/images/logo.svg\",\"alt\":\"Logo d‚ÄôInsertAfter\"}]}]}]}]}],[\"$\",\"$L13\",null,{\"locale\":\"fr\",\"dictionary\":{\"home\":{\"label\":\"Accueil\",\"title\":\"Retour √† l‚Äôaccueil\"},\"blog\":{\"label\":\"Blog\",\"title\":\"Retour √† l‚Äôindex du blog\"},\"projects\":{\"label\":\"Projets\",\"title\":\"D√©couvrir mes divers projets\"},\"about\":{\"label\":\"√Ä propos\",\"title\":\"En savoir plus √† mon sujet\"}}}],[\"$\",\"$L14\",null,{\"locale\":\"fr\"}],[\"$\",\"main\",null,{\"className\":\"layout_iaMain__6s2gl\",\"children\":[\"$\",\"div\",null,{\"children\":[\"$\",\"$L7\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"(withLocale)\",\"children\",\"$8\",\"children\"],\"loading\":\"$undefined\",\"loadingStyles\":\"$undefined\",\"loadingScripts\":\"$undefined\",\"hasLoading\":false,\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$La\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$L15\",\"notFoundStyles\":[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"https://insertafter.com/_next/static/css/719d59f1b635ba1d.css\",\"precedence\":\"next\",\"crossOrigin\":\"\"}]],\"styles\":null}]}]}],[\"$\",\"aside\",null,{\"className\":\"social_iaSocial__kdR1x\",\"children\":[\"$\",\"nav\",null,{\"children\":[\"$\",\"ul\",null,{\"children\":[[\"$\",\"li\",null,{\"children\":[\"$\",\"a\",null,{\"href\":\"https://mastodon.social/@nfroidure\",\"rel\":\"me\",\"title\":\"Me suivre sur Mastodon\",\"className\":\"social_iaSocialMastodon__MTF6o\",\"children\":[\"$\",\"span\",null,{\"children\":\"Mastodon\"}]}]}],[\"$\",\"li\",null,{\"children\":[\"$\",\"a\",null,{\"href\":\"https://bsky.app/profile/nfroidure.bsky.social\",\"rel\":\"me\",\"title\":\"Me suivre sur Bluesky\",\"className\":\"social_iaSocialBluesky__fKW6M\",\"children\":[\"$\",\"span\",null,{\"children\":\"Bluesky\"}]}]}],[\"$\",\"li\",null,{\"children\":[\"$\",\"a\",null,{\"href\":\"https://twitter.com/nfroidure\",\"title\":\"Me suivre sur Twitter\",\"className\":\"social_iaSocialTwitter__9nU6R\",\"children\":[\"$\",\"span\",null,{\"children\":\"Twitter\"}]}]}],[\"$\",\"li\",null,{\"children\":[\"$\",\"a\",null,{\"href\":\"https://github.com/nfroidure\",\"title\":\"Voir mes projets sur GitHub\",\"className\":\"social_iaSocialGithub__vcU5_\",\"children\":[\"$\",\"span\",null,{\"children\":\"GitHub\"}]}]}],[\"$\",\"li\",null,{\"children\":[\"$\",\"a\",null,{\"href\":\"https://www.npmjs.org/~nfroidure\",\"title\":\"Voir mon compte NPM\",\"className\":\"social_iaSocialNpm__6nku5\",\"children\":[\"$\",\"span\",null,{\"children\":\"NPM\"}]}]}],[\"$\",\"li\",null,{\"children\":[\"$\",\"a\",null,{\"href\":\"https://www.linkedin.com/in/nfroidure/\",\"rel\":\"me\",\"title\":\"Voir mon profil LinkedIn\",\"className\":\"social_iaSocialLinkedin__pWACO\",\"children\":[\"$\",\"span\",null,{\"children\":\"LinkedIn\"}]}]}],[\"$\",\"li\",null,{\"children\":[\"$\",\"a\",null,{\"href\":\"https://facebook.com/nicolas.froidure.douai\",\"rel\":\"me\",\"title\":\"Me suivre sur Facebook\",\"className\":\"social_iaSocialFacebook__w4wfH\",\"children\":[\"$\",\"span\",null,{\"children\":\"Facebook\"}]}]}],[\"$\",\"li\",null,{\"children\":[\"$\",\"a\",null,{\"href\":\"/fr/blog/index.atom\",\"title\":\"S‚Äôabonner au flux RSS\",\"className\":\"social_iaSocialFeed__gEQQ0\",\"children\":[\"$\",\"span\",null,{\"children\":\"Flux RSS\"}]}]}]]}]}]}],[\"$\",\"footer\",null,{\"className\":\"footer_iaFooter__rhlnQ\",\"children\":[\"$\",\"p\",null,{\"className\":\"footer_iaFooterContent__VZndF\",\"children\":[\"¬© Nicolas Froidure 2012-\",2024]}]}]]}]}]}]\n"])</script><script>self.__next_f.push([1,"15:[\"$\",\"section\",null,{\"className\":\"contentBlock_root__802UK\",\"children\":[[\"$\",\"h1\",null,{\"className\":\"h1_root__VPXQG\",\"children\":\"Page not found\"}],[\"$\",\"p\",null,{\"className\":\"not-found_p__fvcGn\",\"children\":[[\"$\",\"img\",null,{\"className\":\"not-found_img__IT2jY\",\"src\":\"https://media.giphy.com/media/12mPcp41D9a1i0/giphy.gif\",\"alt\":\"404.png\"}],[\"$\",\"p\",null,{\"className\":\"p_root__SHE_W\",\"children\":\"It seems that the page you look for doesn't exist.\"}]]}]]}]\n"])</script><script>self.__next_f.push([1,"16:I[5250,[\"176\",\"static/chunks/176-0a03be62efe5672b.js\",\"876\",\"static/chunks/876-4c07c683293830f5.js\",\"798\",\"static/chunks/app/(withLocale)/%5Blocale%5D/blog/%5Bid%5D/page-b35c319b7df441da.js\"],\"\"]\n17:T54d,"])</script><script>self.__next_f.push([1,"// R√©cup√©ration des identifiants des lieux de l'utilisateur\ndb.users.find(\n  {\n    query: {\n      _id: ObjectId(\"abbacacaabbacacaabbacacaabbacaca\"),\n    },\n    fields: [\"locations_ids\"],\n  },\n  function (err, results) {\n    var locationsIds = results[0].locations_ids;\n    // R√©cup√©ration des lieux\n    db.locations.find(\n      {\n        query: {\n          _id: {\n            $in: locationsIds,\n          },\n        },\n        fields: [\"location\"],\n      },\n      function (err, results) {\n        // On a uniquement les lieux trouv√© donc, si un identifiant √©tait\n        // mauvais, osef\n        var locations = results.map(function (result) {\n          return result.location;\n        });\n        // Petit ajout pour traiter les inconsistances\n        var badLocationsIds = locationsIds.filter(function (locationId) {\n          return locations.every(function (location) {\n            return location._id.toString() !== locationId.toString();\n          });\n        });\n        // Si on en a, on fait la requ√™te qui va bien\n        if (badLocationsIds.length) {\n          db.users.update(\n            {\n              _id: ObjectId(\"abbacacaabbacacaabbacacaabbacaca\"),\n            },\n            {\n              $pullAll: {\n                locations_ids: badLocationsIds,\n              },\n            },\n          );\n        }\n      },\n    );\n  },\n);"])</script><script>self.__next_f.push([1,"6:[[\"$\",\"section\",null,{\"className\":\"contentBlock_root__802UK\",\"children\":[[[\"$\",\"h1\",null,{\"className\":\"h1_root__VPXQG\",\"children\":[[\"$\",\"span\",\"0\",{\"children\":\"MongoDB ou la conception probabiliste\"}]]}],[\"$\",\"p\",null,{\"className\":\"p_root__SHE_W\",\"children\":[[\"$\",\"span\",\"0\",{\"children\":\"Comme je ne vous ai pas tout dit dans mon \"}],[\"$\",\"$L16\",null,{\"href\":\"./design_base_donnee_mongodb\",\"className\":\"a_root__WEPS7\",\"title\":null,\"target\":\"_self\",\"children\":[null,[[\"$\",\"span\",\"0\",{\"children\":\"dernier billet sur le design de base de donn√©e avec MongoDB\"}]]]}],[\"$\",\"span\",\"2\",{\"children\":\", je me fends d'un second billet plus g√©n√©raliste sur la philosophie que je mets en ≈ìuvre pour la gestion d'une base de donn√©e MongoDB.\"}]]}],[\"$\",\"p\",null,{\"className\":\"p_root__SHE_W\",\"children\":[[\"$\",\"span\",\"0\",{\"children\":\"La majeure partie des d√©cisions en mati√®re d'architecture et de conception de sch√©ma avec MongoDB se r√©sume √† un calcul de probabilit√© (les plus pessimistes diront risque) d'inconsistance des donn√©es. Et √ßa, pour un DBA, c'est plut√¥t, nouveau.\"}]]}],[\"$\",\"p\",null,{\"className\":\"p_root__SHE_W\",\"children\":[[\"$\",\"span\",\"0\",{\"children\":\"D'ailleurs, quand on gratte un peu la surface, on se rend compte que ces probabilit√©s sont au c≈ìur de la conception de MongoDB lui m√™me. Pour illustrer ce fait, parlons un peu de l'ObjectId.\"}]]}],[\"$\",\"h2\",null,{\"className\":\"h2_root__Y02lX\",\"children\":[\"$\",\"span\",null,{\"className\":\"anchored_root__HWi6K\",\"children\":[[[\"$\",\"span\",\"0\",{\"children\":\"ObjectId, the WTF primary key\"}]],\" \",[\"$\",\"small\",null,{\"children\":[\"$\",\"$L16\",null,{\"href\":\"#objectid-the-wtf-primary-key\",\"className\":\"anchored_icon__N5Sem\",\"id\":\"objectid-the-wtf-primary-key\",\"title\":\"Lien vers cette section\",\"children\":[\"$\",\"span\",null,{\"children\":\"üîó\"}]}]}]]}]}],[\"$\",\"p\",null,{\"className\":\"p_root__SHE_W\",\"children\":[[\"$\",\"span\",\"0\",{\"children\":\"Les cl√©s utilis√©es par MongoDB, les \"}],[\"$\",\"$L16\",null,{\"href\":\"https://docs.mongodb.com/manual/reference/method/ObjectId/\",\"className\":\"a_root__WEPS7\",\"title\":null,\"target\":\"_blank\",\"children\":[null,[[\"$\",\"span\",\"0\",{\"children\":\"ObjectIds\"}]]]}],[\"$\",\"span\",\"2\",{\"children\":\", sont facilement reconnaissables sous forme de cha√Æne de caract√®re. Derri√®re cette s√©quence hexad√©cimale de 24 caract√®res (ex.¬†: babacafebabacafebabacafebabacafe) se cache bien des concepts.\"}]]}],[\"$\",\"p\",null,{\"className\":\"p_root__SHE_W\",\"children\":[[\"$\",\"span\",\"0\",{\"children\":\"Contrairement aux cl√©s auto-incr√©ment√©es que l'on observe dans la plupart, sinon la totalit√©, des bases de donn√©es relationnelles, les cl√©s de MongoDB sont g√©n√©r√©es gr√¢ce √† une combinaison de quatre valeurs (un timestamp repr√©sentant le nombre de secondes √©coul√©es depuis l'Epoch Unix, un identifiant \\\"machine\\\", le pid du processus qui a g√©n√©r√© l'ObjectId et enfin un compteur incr√©ment√© automatiquement √† chaque cr√©ation d'id avec une valeur al√©atoire comme base).\"}]]}],[\"$\",\"p\",null,{\"className\":\"p_root__SHE_W\",\"children\":[[\"$\",\"span\",\"0\",{\"children\":\"La question l√©gitime que vous √™tes probablement entrain de vous poser est pourquoi¬†? A premi√®re vue, c'est bien plus compliqu√© √† retenir qu'un simple identifiant num√©rique.\"}]]}],[\"$\",\"p\",null,{\"className\":\"p_root__SHE_W\",\"children\":[[\"$\",\"span\",\"0\",{\"children\":\"La raison est simple¬†: pouvoir cr√©er un identifiant sans avoir besoin de synchroniser toutes les instances de MongoDB.\"}]]}],[\"$\",\"p\",null,{\"className\":\"p_root__SHE_W\",\"children\":[[\"$\",\"span\",\"0\",{\"children\":\"En effet, il est d√©j√† difficile \"}],[\"$\",\"$L16\",null,{\"href\":\"http://highscalability.com/blog/2015/3/9/the-architecture-of-algolias-distributed-search-network.html\",\"className\":\"a_root__WEPS7\",\"title\":\"Voir un article sur l'infrastructure d'Algolia traitant de ce sujet\",\"target\":\"_blank\",\"children\":[null,[[\"$\",\"span\",\"0\",{\"children\":\"d'incr√©menter un simple un entier\"}]]]}],[\"$\",\"span\",\"2\",{\"children\":\" entre les diverses instances d'un cluster alors imaginez si c'√©tait le cas pour toutes les collections de MongoDB. Le parti pris est donc de cr√©er cette cl√© unique d'une fa√ßon telle qu'il devient impossible de cr√©er la m√™me cl√© sur deux instances diff√©rentes.\"}]]}],[\"$\",\"p\",null,{\"className\":\"p_root__SHE_W\",\"children\":[[\"$\",\"span\",\"0\",{\"children\":\"Ou presque ;). Il existe bel et bien une probabilit√© que ceci arrive, mais cette derni√®re est tellement faible qu'elle devient n√©gligeable. En effet, il faudrait que deux machines, ayant chacune un processus avec le m√™me pid (ou \"}],[\"$\",\"$L16\",null,{\"href\":\"https://fr.wikipedia.org/wiki/Identifiant%5Fde%5Fprocessus\",\"className\":\"a_root__WEPS7\",\"title\":null,\"target\":\"_blank\",\"children\":[null,[[\"$\",\"span\",\"0\",{\"children\":\"identifiant de processus\"}]]]}],[\"$\",\"span\",\"2\",{\"children\":\") et le m√™me identifiant machine, cr√©ent dans la m√™me milliseconde, un ObjectId alors que leur compteur interne a la m√™me valeur.\"}]]}],[\"$\",\"p\",null,{\"className\":\"p_root__SHE_W\",\"children\":[[\"$\",\"span\",\"0\",{\"children\":\"Dans la conception d'API REST, cette caract√©ristique devient m√™me un pr√©cieux avantage puisqu'elle permet de g√©n√©rer l'ObjectId de cette ressource directement sur le client qui consomme cette m√™me API. Ainsi, tirer avantage des requ√™tes cr√©ationnelles idempotentes du type PUT et PATCH devient un jeu d'enfant. En embarquant une biblioth√®que permettant de \"}],[\"$\",\"$L16\",null,{\"href\":\"https://github.com/justaprogrammer/ObjectId.js\",\"className\":\"a_root__WEPS7\",\"title\":null,\"target\":\"_blank\",\"children\":[null,[[\"$\",\"span\",\"0\",{\"children\":\"g√©n√©rer des ObjectIds\"}]]]}],[\"$\",\"span\",\"2\",{\"children\":\" on peu s'assurer de l'unicit√© des ressources cr√©√©es c√¥t√© mobile malgr√© les tr√®s probables coupures intempestives typiques des connexions itin√©rantes.\"}]]}],[\"$\",\"h2\",null,{\"className\":\"h2_root__Y02lX\",\"children\":[\"$\",\"span\",null,{\"className\":\"anchored_root__HWi6K\",\"children\":[[[\"$\",\"span\",\"0\",{\"children\":\"Transactions optimistes\"}]],\" \",[\"$\",\"small\",null,{\"children\":[\"$\",\"$L16\",null,{\"href\":\"#transactions-optimistes\",\"className\":\"anchored_icon__N5Sem\",\"id\":\"transactions-optimistes\",\"title\":\"Lien vers cette section\",\"children\":[\"$\",\"span\",null,{\"children\":\"üîó\"}]}]}]]}]}],[\"$\",\"p\",null,{\"className\":\"p_root__SHE_W\",\"children\":[[\"$\",\"span\",\"0\",{\"children\":\"MongoDB ne propose pas de syst√®me de transaction. C'est d'ailleurs ce qui m'a rebut√© de prime abord quand j'ai d√©couvert MongoDB. Les donn√©es √©tant le c≈ìur de tout syst√®me, ne pouvoir garantir l'√©tat de ces derni√®res et risquer de les voir lentement se d√©grader est inenvisageable pour un concepteur de service web qui se respecte.\"}]]}],[\"$\",\"p\",null,{\"className\":\"p_root__SHE_W\",\"children\":[[\"$\",\"span\",\"0\",{\"children\":\"Alors que faire¬†? Fa√Ætes comme dans la vraie vie. Quand vous prenez votre voiture pour aller chercher du pain, vous savez que ce n'est pas sans risque. Vous pourriez crever un pneu, avoir un accident etc... Malheureusement, vous ne pouvez pas r√©duire le risque √† n√©ant.\"}]]}],[\"$\",\"p\",null,{\"className\":\"p_root__SHE_W\",\"children\":[[\"$\",\"span\",\"0\",{\"children\":\"En sortant quand m√™me de chez vous, vous arbitrez sur le fait que ces risques sont somme toute n√©gligeables et que la seule fa√ßon d'arriver √† vos fins efficacement est de prendre ce risque. Vous le prenez cependant de mani√®re intelligente.\"}]]}],[\"$\",\"p\",null,{\"className\":\"p_root__SHE_W\",\"children\":[[\"$\",\"span\",\"0\",{\"children\":\"Vous avez un v√©hicule contr√¥l√© techniquement tous les deux ans, vos pneus sont v√©rifi√©s r√©guli√®rement. Vous avez mis en place toute une batterie de mesures pour r√©duire ce risque.\"}]]}],[\"$\",\"p\",null,{\"className\":\"p_root__SHE_W\",\"children\":[[\"$\",\"span\",\"0\",{\"children\":\"Vous avez √©galement une roue de secours, une trousse de premier soins, un chasuble peut-√™tre m√™me une couverture au cas o√π vous seriez bloqu√© par la neige. Vous avez pris des mesures pour anticiper ce risque, pour √™tre pr√™t si par malchance il se r√©alisait.\"}]]}],[\"$\",\"p\",null,{\"className\":\"p_root__SHE_W\",\"children\":[[\"$\",\"span\",\"0\",{\"children\":\"Bref, vous fa√Ætes une transaction optimiste. Selon toute vraisemblance dans 20 minutes vous serez de retour chez vous avec du pain. Et vous pourrez passer √† l'op√©ration suivante, pr√©parer le petit d√©jeuner.\"}]]}],[\"$\",\"p\",null,{\"className\":\"p_root__SHE_W\",\"children\":[[\"$\",\"span\",\"0\",{\"children\":\"L√† o√π les bases relationnelles sont bas√©es sur le fait qu'avec les transactions, th√©oriquement, il n'y a aucun risque, les bases de donn√©es NoSQL se basent sur le fait que g√©n√©ralement, tout se passe bien.\"}]]}],[\"$\",\"p\",null,{\"className\":\"p_root__SHE_W\",\"children\":[[\"$\",\"span\",\"0\",{\"children\":\"C'est pourquoi la conception avec MongoDB est plus complexe. Elle demande une bonne r√©flexion et une bonne capacit√© √† mesurer et anticiper les risques l√† o√π une conception relationnelle demande simplement du formalisme.\"}]]}],[\"$\",\"p\",null,{\"className\":\"p_root__SHE_W\",\"children\":[[\"$\",\"span\",\"0\",{\"children\":\"Reprenons mon exemple du billet pr√©c√©dent dans lequel on met √† jour les lieux associ√©s √† un utilisateur¬†:\"}]]}],[\"$\",\"div\",null,{\"className\":\"code_root__5JLV_\",\"children\":[\"$\",\"code\",null,{\"children\":[\"$\",\"pre\",null,{\"children\":\"// On s'assure que les ids donn√©s sont corrects\\ndb.collection(\\\"location\\\").count(\\n  {\\n    _id: {\\n      $in: myNewLocationsIds,\\n    },\\n  },\\n  function (err, count) {\\n    if (count != myNewLocationsIds.length) {\\n      throw new Error(\\\"Bad locations ids\\\");\\n    }\\n    // On met √† jour l'utilisateur\\n    UserModel.update(\\n      {\\n        _id: ObjectId(\\\"abbacacaabbacacaabbacaca\\\"),\\n      },\\n      {\\n        $set: {\\n          locations_ids: myNewLocationsIds,\\n        },\\n      },\\n      { multi: true },\\n    );\\n  },\\n);\"}]}]}],[\"$\",\"p\",null,{\"className\":\"p_root__SHE_W\",\"children\":[[\"$\",\"span\",\"0\",{\"children\":\"Quels sont les risques¬†? La majorit√© des risques se situent souvent entre deux requ√™tes (d'o√π l'int√©r√™t des techniques pr√©sent√©es dans l'article pr√©c√©dent pour les limiter). Le risque se situe donc entre la v√©rification de l'existence des lieux li√©s et la liaison effective des lieux dans le document correspondant √† l'utilisateur.\"}]]}],[\"$\",\"p\",null,{\"className\":\"p_root__SHE_W\",\"children\":[[\"$\",\"span\",\"0\",{\"children\":\"Pour que ce risque se r√©alise, il faudrait que l'un de ces lieux soit supprim√© entre la requ√™te de v√©rification et celle de modification. Soyons clairs, ce risque bien qu'existant est infime. Il est si infime, qu'on ne peut pas vraiment le r√©duire. On peut, par contre, tr√®s certainement l'augmenter en utilisant Mongoose ;) (voir billet pr√©c√©dent).\"}]]}],[\"$\",\"p\",null,{\"className\":\"p_root__SHE_W\",\"children\":[[\"$\",\"span\",\"0\",{\"children\":\"En revanche, puisque le risque existe, il s'agit de ne pas l'ignorer. Accepter la probabilit√© qu'un accident survienne en allant chercher du pain ne signifie pas mettre des ≈ìill√®res et se retrouver d√©pourvu face √† sa r√©alisation.\"}]]}],[\"$\",\"p\",null,{\"className\":\"p_root__SHE_W\",\"children\":[[\"$\",\"span\",\"0\",{\"children\":\"Plusieurs strat√©gies peuvent √™tre mises en ≈ìuvre pour pallier √† ces risques, parfois conjointement.\"}]]}],[\"$\",\"h4\",null,{\"className\":\"h4_root__NsehS\",\"children\":[\"$\",\"span\",null,{\"className\":\"anchored_root__HWi6K\",\"children\":[[[\"$\",\"span\",\"0\",{\"children\":\"R√©silience face √† l'inconsistance\"}]],\" \",[\"$\",\"small\",null,{\"children\":[\"$\",\"$L16\",null,{\"href\":\"#resilience-face-a-l-inconsistance\",\"className\":\"anchored_icon__N5Sem\",\"id\":\"resilience-face-a-l-inconsistance\",\"title\":\"Lien vers cette section\",\"children\":[\"$\",\"span\",null,{\"children\":\"üîó\"}]}]}]]}]}],[\"$\",\"p\",null,{\"className\":\"p_root__SHE_W\",\"children\":[[\"$\",\"span\",\"0\",{\"children\":\"La premi√®re strat√©gie qui, selon moi, se doit d'√™tre automatique. Votre plateforme se doit de continuer de fonctionner en cas d'inconsistance. Dans le cas de l'exemple ci-dessus, si il s'av√®re qu'un lieu n'existe plus quand vous cherchez √† obtenir la liste des lieux d'un utilisateur, vous devez donc silencieusement l'invalider et non renvoyer une erreur aux consommateurs de votre API. Vous devez aussi logger cette erreur avec une flag reconnaissable pour votre supervision.\"}]]}],[\"$\",\"p\",null,{\"className\":\"p_root__SHE_W\",\"children\":[[\"$\",\"span\",\"0\",{\"children\":\"Typiquement, l'architecte logiciel se chargera d'ajouter des tests √† la base de code pour les risques d'inconsistance identifi√©s et accept√©s par sa conception de fa√ßon √† alerter les d√©veloppeurs de ces derniers. Au niveau code, ceci donnerait¬†:\"}]]}],[\"$\",\"div\",null,{\"className\":\"code_root__5JLV_\",\"children\":[\"$\",\"code\",null,{\"children\":[\"$\",\"pre\",null,{\"children\":\"// R√©cup√©ration des identifiants des lieux de l'utilisateur\\ndb.users.find(\\n  {\\n    query: {\\n      _id: ObjectId(\\\"abbacacaabbacacaabbacacaabbacaca\\\"),\\n    },\\n    fields: [\\\"locations_ids\\\"],\\n  },\\n  function (err, results) {\\n    // R√©cup√©ration des lieux\\n    db.locations.find(\\n      {\\n        query: {\\n          _id: {\\n            $in: results[0].locations_ids,\\n          },\\n        },\\n        fields: [\\\"location\\\"],\\n      },\\n      function (err, results) {\\n        // On a uniquement les lieux trouv√© donc, si un identifiant √©tait\\n        // mauvais, osef\\n        var locations = results.map(function (result) {\\n          return result.location;\\n        });\\n      },\\n    );\\n  },\\n);\"}]}]}],[\"$\",\"p\",null,{\"className\":\"p_root__SHE_W\",\"children\":[[\"$\",\"span\",\"0\",{\"children\":\"Ici, le syst√®me de querying de MongoDB nous √©pargne la peine de prendre le cas en charge dans le code.\"}],[\"$\",\"strong\",null,{\"className\":\"strong_root__kOzFq\",\"children\":[[\"$\",\"span\",\"0\",{\"children\":\"Il doit cependant, je le r√©p√®te, √™tre pris en charge par les tests.\"}]]}]]}],[\"$\",\"h4\",null,{\"className\":\"h4_root__NsehS\",\"children\":[\"$\",\"span\",null,{\"className\":\"anchored_root__HWi6K\",\"children\":[[[\"$\",\"span\",\"0\",{\"children\":\"Contr√¥le d'int√©grit√© p√©riodique\"}]],\" \",[\"$\",\"small\",null,{\"children\":[\"$\",\"$L16\",null,{\"href\":\"#controle-d-integrite-periodique\",\"className\":\"anchored_icon__N5Sem\",\"id\":\"controle-d-integrite-periodique\",\"title\":\"Lien vers cette section\",\"children\":[\"$\",\"span\",null,{\"children\":\"üîó\"}]}]}]]}]}],[\"$\",\"p\",null,{\"className\":\"p_root__SHE_W\",\"children\":[[\"$\",\"span\",\"0\",{\"children\":\"Votre base de donn√©e peu devenir inconsistante. Donc, cr√©ez des scripts¬†! √áa peut para√Ætre b√™te, mais cr√©er des scripts pour contr√¥ler et r√©parer les possibles inconsistances de votre base MongoDB est un excellent moyen de lutter contre elles. Ces scripts peuvent √©galement servir de reminder de toutes les inconsistances possibles.\"}]]}],[\"$\",\"p\",null,{\"className\":\"p_root__SHE_W\",\"children\":[[\"$\",\"span\",\"0\",{\"children\":\"Vous serez √©galement bien contents de les avoir sous la main dans la cas o√π une inconsistance surviendrait plus souvent que pr√©vu. Afin de pouvoir les utiliser comme palliatif le temps de r√©duire la probabilit√© de leur survenance gr√¢ce aux techniques que je vous ai pr√©sent√©.\"}]]}],[\"$\",\"h4\",null,{\"className\":\"h4_root__NsehS\",\"children\":[\"$\",\"span\",null,{\"className\":\"anchored_root__HWi6K\",\"children\":[[[\"$\",\"span\",\"0\",{\"children\":\"Contr√¥le et traitement opportuniste d'int√©grit√©\"}]],\" \",[\"$\",\"small\",null,{\"children\":[\"$\",\"$L16\",null,{\"href\":\"#controle-et-traitement-opportuniste-d-integrite\",\"className\":\"anchored_icon__N5Sem\",\"id\":\"controle-et-traitement-opportuniste-d-integrite\",\"title\":\"Lien vers cette section\",\"children\":[\"$\",\"span\",null,{\"children\":\"üîó\"}]}]}]]}]}],[\"$\",\"p\",null,{\"className\":\"p_root__SHE_W\",\"children\":[[\"$\",\"span\",\"0\",{\"children\":\"Mais il y a mieux¬†:). Dans notre exemple de code tol√©rant √† l'inconsistance, je vois une belle opportunit√© de g√©rer √† posteriori les inconsistances. En effet, puisque nous avons fait les requ√™tes permettant de voir l'inconsistance, pourquoi ne pas la corriger¬†?\"}]]}],[\"$\",\"div\",null,{\"className\":\"code_root__5JLV_\",\"children\":[\"$\",\"code\",null,{\"children\":[\"$\",\"pre\",null,{\"children\":\"$17\"}]}]}],[\"$\",\"p\",null,{\"className\":\"p_root__SHE_W\",\"children\":[[\"$\",\"span\",\"0\",{\"children\":\"On peut s'inqui√©ter de l'empreinte de cette correction d'inconsistance sur les performances du syst√®me. Il faut cependant temp√©rer cette crainte par le fait que les inconsistances dans un syst√®me bien con√ßu sont rares.\"}]]}],[\"$\",\"p\",null,{\"className\":\"p_root__SHE_W\",\"children\":[[\"$\",\"span\",\"0\",{\"children\":\"De plus, il est possible d'utiliser la fonction \"}],[\"$\",\"code\",null,{\"className\":\"code_root__5JLV_\",\"children\":\"setTimeout()\"}],[\"$\",\"span\",\"2\",{\"children\":\" de JavaScript pour d√©coupler ces v√©rifications du reste du code pour ne pas nuire aux performances si cela s'av√©rait n√©cessaire.\"}]]}],[\"$\",\"h4\",null,{\"className\":\"h4_root__NsehS\",\"children\":[\"$\",\"span\",null,{\"className\":\"anchored_root__HWi6K\",\"children\":[[[\"$\",\"span\",\"0\",{\"children\":\"Isolation\"}]],\" \",[\"$\",\"small\",null,{\"children\":[\"$\",\"$L16\",null,{\"href\":\"#isolation\",\"className\":\"anchored_icon__N5Sem\",\"id\":\"isolation\",\"title\":\"Lien vers cette section\",\"children\":[\"$\",\"span\",null,{\"children\":\"üîó\"}]}]}]]}]}],[\"$\",\"p\",null,{\"className\":\"p_root__SHE_W\",\"children\":[[\"$\",\"span\",\"0\",{\"children\":\"Vous avez probablement remarqu√© que les risques d'inconsistances sont souvent d√ªs √† la concurrence possible sur les m√™me donn√©es de deux utilisateurs diff√©rents de votre API.\"}]]}],[\"$\",\"p\",null,{\"className\":\"p_root__SHE_W\",\"children\":[[\"$\",\"span\",\"0\",{\"children\":\"La r√©sultante de ceci est bien s√ªr que le trafic sur votre plateforme change totalement les probabilit√©s d'inconsistance. Ainsi, si vous avez un seul utilisateur elles sont quasi nulles, en revanche, si des millions d'utilisateurs l'utilisent, elles deviennent plus probables.\"}]]}],[\"$\",\"p\",null,{\"className\":\"p_root__SHE_W\",\"children\":[[\"$\",\"span\",\"0\",{\"children\":\"Un bon moyen de limiter les inconsistances est donc la cr√©ation de silos artificiels. Par exemple, si votre plateforme contient des organisations diff√©rentes et qu'aucun document n'est partag√© entre deux organisations √† aucun moment, f√©licitations, vous avez divis√© le risque d'inconsistance d√ª au trafic par le nombre d'organisations existantes.\"}]]}],[\"$\",\"h4\",null,{\"className\":\"h4_root__NsehS\",\"children\":[\"$\",\"span\",null,{\"className\":\"anchored_root__HWi6K\",\"children\":[[[\"$\",\"span\",\"0\",{\"children\":\"Supervision\"}]],\" \",[\"$\",\"small\",null,{\"children\":[\"$\",\"$L16\",null,{\"href\":\"#supervision\",\"className\":\"anchored_icon__N5Sem\",\"id\":\"supervision\",\"title\":\"Lien vers cette section\",\"children\":[\"$\",\"span\",null,{\"children\":\"üîó\"}]}]}]]}]}],[\"$\",\"p\",null,{\"className\":\"p_root__SHE_W\",\"children\":[[\"$\",\"span\",\"0\",{\"children\":\"Traiter silencieusement les inconsistances n'est pas suffisant. Vous devez recueillir du feedback sur ces derni√®res de mani√®re √† pouvoir faire √©voluer votre syst√®me en connaissance de causes.\"}]]}],[\"$\",\"p\",null,{\"className\":\"p_root__SHE_W\",\"children\":[[\"$\",\"span\",\"0\",{\"children\":\"La supervision et l'analyse des logs doit √™tre une priorit√©. Par chance, les inconsistances sont sens√©es √™tre rares. C'est pourquoi, ceci ne devrait pas √™tre trop compliqu√© √† g√©rer. Je suis pour ma part, partisan de l'envoi de mail √† chaque inconsistance tant que c'est soutenable (l'id√©e est de tout faire pour que √ßa le reste ;) ).\"}]]}],[\"$\",\"p\",null,{\"className\":\"p_root__SHE_W\",\"children\":[[\"$\",\"span\",\"0\",{\"children\":\"Toutes ces strat√©gies permettent de g√©rer l'incertitude pour obtenir un syst√®me scalable. Ce qui est clair, c'est que cette nouvelle fa√ßon d'appr√©hender la gestion des donn√©es m'a clairement fait sortir de ma zone de confort, mais l'essentiel est d'avoir retrouv√© un niveau de confiance presque √©quivalent √† celui induit par l'utilisation d'une base de donn√©es relationnelle.\"}]]}],[\"$\",\"h2\",null,{\"className\":\"h2_root__Y02lX\",\"children\":[\"$\",\"span\",null,{\"className\":\"anchored_root__HWi6K\",\"children\":[[[\"$\",\"span\",\"0\",{\"children\":\"Inception\"}]],\" \",[\"$\",\"small\",null,{\"children\":[\"$\",\"$L16\",null,{\"href\":\"#inception\",\"className\":\"anchored_icon__N5Sem\",\"id\":\"inception\",\"title\":\"Lien vers cette section\",\"children\":[\"$\",\"span\",null,{\"children\":\"üîó\"}]}]}]]}]}],[\"$\",\"p\",null,{\"className\":\"p_root__SHE_W\",\"children\":[[\"$\",\"span\",\"0\",{\"children\":\"On pourrait √©br√©cher cette confiance en r√©fl√©chissant √† toutes les strat√©gies mises en ≈ìuvre ci-dessus. Puisqu'elles-m√™mes agissent sur les donn√©es, elles peuvent donc √©galement g√©n√©rer des inconsistances.\"}]]}],[\"$\",\"p\",null,{\"className\":\"p_root__SHE_W\",\"children\":[[\"$\",\"span\",\"0\",{\"children\":\"Il est possible que la suppression d'un identifiant de lieu dans la liste des lieux d'un utilisateur supprime en fait une association parfaitement l√©gitime.\"}]]}],[\"$\",\"p\",null,{\"className\":\"p_root__SHE_W\",\"children\":[[\"$\",\"span\",\"0\",{\"children\":\"En effet, on a vu qu'il √©tait possible que deux identifiants MongoDB soient cr√©√©s en m√™me temps et soient identiques. Il est donc possible qu'un lieu soit cr√©√© avec l'un de ces identifiants et associ√© √† l'utilisateur alors m√™me qu'on est entrain de supprimer cet identifiant par ailleurs pour r√©tablir une int√©grit√© suppos√©e¬†:).\"}]]}],[\"$\",\"h2\",null,{\"className\":\"h2_root__Y02lX\",\"children\":[\"$\",\"span\",null,{\"className\":\"anchored_root__HWi6K\",\"children\":[[[\"$\",\"span\",\"0\",{\"children\":\"Conception organique\"}]],\" \",[\"$\",\"small\",null,{\"children\":[\"$\",\"$L16\",null,{\"href\":\"#conception-organique\",\"className\":\"anchored_icon__N5Sem\",\"id\":\"conception-organique\",\"title\":\"Lien vers cette section\",\"children\":[\"$\",\"span\",null,{\"children\":\"üîó\"}]}]}]]}]}],[\"$\",\"p\",null,{\"className\":\"p_root__SHE_W\",\"children\":[[\"$\",\"span\",\"0\",{\"children\":\"J'aime bien le terme de conception organique. L√† o√π les bases de donn√©es relationnelles sont comme une n√©gation de la nature impr√©visible de l'univers, MongoDB impose une conception qui rejoint l'approche naturelle. Une conception organique.\"}]]}],[\"$\",\"p\",null,{\"className\":\"p_root__SHE_W\",\"children\":[[\"$\",\"span\",\"0\",{\"children\":\"J'aime cette vision philosophique de l'√©tat d'un syst√®me qui jongle avec les probabilit√© et compose avec l'infini. MongoDB, c'est aussi une conception optimiste, car oui, dans la nature, les choses se passent plus souvent bien que mal.\"}]]}],[\"$\",\"p\",null,{\"className\":\"p_root__SHE_W\",\"children\":[[\"$\",\"span\",\"0\",{\"children\":\"J'aime ces points de jonction entre la science et la vie. N'est-ce pas ainsi qu'on explique d√©sormais la plupart des myst√®res de l'univers¬†?\"}]]}],[\"$\",\"p\",null,{\"className\":\"p_root__SHE_W\",\"children\":[[\"$\",\"span\",\"0\",{\"children\":\"Toutes les bonnes choses ont une fin, je pense que je reparlerai de MongoDB sur ce blog, en attendant, n'h√©sitez pas √† donner votre avis. D√©sol√© pour les gifs¬†:p.\"}]]}]],[\"$\",\"p\",null,{\"className\":\"p_root__SHE_W\",\"children\":[\"Published at\",\" \",\"samedi 4 avril 2015 √† 15:29:02\",\".\"]}]]}],[\"$\",\"section\",null,{\"className\":\"contentBlock_root__802UK\",\"children\":[\"$\",\"aside\",null,{\"className\":\"share_root__Qm_RR\",\"children\":[[\"$\",\"h2\",null,{\"className\":\"h2_root__Y02lX\",\"children\":\"Commenter et partager\"}],[\"$\",\"p\",null,{\"className\":\"p_root__SHE_W\",\"children\":[[\"$\",\"$L16\",null,{\"href\":\"https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Finsertafter.com%2Fblog%2Fdesign_probabiliste_mongodb\",\"className\":\"a_root__WEPS7\",\"title\":\"Commenter sur Facebook\",\"target\":\"_blank\",\"children\":[null,[[\"$\",\"span\",null,{\"className\":\"share_icon__bi4Q3 share_facebook__JKn8d\"}],\"Facebook\"]]}],\" - \",[\"$\",\"$L16\",null,{\"href\":\"https://twitter.com/intent/tweet/?url=https%3A%2F%2Finsertafter.com%2Fblog%2Fdesign_probabiliste_mongodb\u0026text=MongoDB%20ou%20la%20conception%20probabiliste\u0026via=nfroidure\",\"className\":\"a_root__WEPS7\",\"title\":\"Commenter sur Twitter\",\"target\":\"_blank\",\"children\":[null,[[\"$\",\"span\",null,{\"className\":\"share_icon__bi4Q3 \"}],\"Twitter\"]]}],\" - \",[\"$\",\"$L16\",null,{\"href\":\"mailto:nicolas.froidure@gmail.com\",\"className\":\"a_root__WEPS7\",\"title\":\"Me r√©pondre par mail\",\"target\":\"_self\",\"children\":[null,[[\"$\",\"span\",null,{\"className\":\"share_icon__bi4Q3 share_mail__yvBDK\"}],\"Courriel\"]]}]]}]]}]}],[\"$\",\"section\",null,{\"className\":\"contentBlock_root__802UK\",\"children\":[\"$\",\"aside\",null,{\"className\":\"page_linkedEntries__jiPuT\",\"children\":[[\"$\",\"h2\",null,{\"className\":\"h2_root__Y02lX\",\"children\":\"Articles similaires\"}],[\"$\",\"p\",null,{\"className\":\"p_root__SHE_W\",\"children\":[\"Dans les cat√©gories\",\" \",\"MongoDB et Base de donn√©es\",\".\"]}],[\"$\",\"div\",null,{\"className\":\"items_entries__5hkLG\",\"children\":[[\"$\",\"div\",\"design_base_donnee_mongodb\",{\"className\":\"items_entry_item__GWeg7\",\"children\":[null,[\"$\",\"h2\",null,{\"className\":\"h2_root__Y02lX items_entry_title__vJ_8h\",\"children\":[\"$\",\"$L16\",null,{\"href\":\".//design_base_donnee_mongodb\",\"className\":\"a_root__WEPS7 items_entry_link__EtVod\",\"title\":\"Lire cet article de blog\",\"target\":\"_self\",\"children\":[null,\"Design de bases de donn√©es MongoDB\"]}]}],[\"$\",\"p\",null,{\"className\":\"p_root__SHE_W items_entry_description__ZWt9y\",\"children\":[\"Le design de bases de donn√©es MongoDB est une activit√© complexe qui n√©cessite d'avoir une profonde connaissance des implications des divers choix possibles.\",\" \",[\"$\",\"br\",null,{}],[\"$\",\"$L16\",null,{\"href\":\".//design_base_donnee_mongodb\",\"className\":\"a_root__WEPS7\",\"title\":\"Lire cet article de blog\",\"target\":\"_self\",\"children\":[null,\"Lire la suite\"]}]]}],[\"$\",\"p\",null,{\"className\":\"p_root__SHE_W items_entry_time__iNrot\",\"children\":[\"Published at\",\" \",\"samedi 28 mars 2015 √† 13:40:32\",\".\"]}],[\"$\",\"div\",null,{\"className\":\"items_clear__3fyGk\"}]]}],[\"$\",\"div\",\"retour_xp_mongodb\",{\"className\":\"items_entry_item__GWeg7\",\"children\":[null,[\"$\",\"h2\",null,{\"className\":\"h2_root__Y02lX items_entry_title__vJ_8h\",\"children\":[\"$\",\"$L16\",null,{\"href\":\".//retour_xp_mongodb\",\"className\":\"a_root__WEPS7 items_entry_link__EtVod\",\"title\":\"Lire cet article de blog\",\"target\":\"_self\",\"children\":[null,\"MongoDB : Retour d'exp√©rience\"]}]}],[\"$\",\"p\",null,{\"className\":\"p_root__SHE_W items_entry_description__ZWt9y\",\"children\":[\"Je travaille avec MongoDB depuis maintenant presque un an, il est temps pour moi de faire un petit retour sur cette base de donn√©es et sur le NoSQL de mani√®re g√©n√©rale.\",\" \",[\"$\",\"br\",null,{}],[\"$\",\"$L16\",null,{\"href\":\".//retour_xp_mongodb\",\"className\":\"a_root__WEPS7\",\"title\":\"Lire cet article de blog\",\"target\":\"_self\",\"children\":[null,\"Lire la suite\"]}]]}],[\"$\",\"p\",null,{\"className\":\"p_root__SHE_W items_entry_time__iNrot\",\"children\":[\"Published at\",\" \",\"jeudi 4 d√©cembre 2014 √† 20:44:40\",\".\"]}],[\"$\",\"div\",null,{\"className\":\"items_clear__3fyGk\"}]]}],[\"$\",\"div\",\"gerer_monnaies_logiciel\",{\"className\":\"items_entry_item__GWeg7\",\"children\":[null,[\"$\",\"h2\",null,{\"className\":\"h2_root__Y02lX items_entry_title__vJ_8h\",\"children\":[\"$\",\"$L16\",null,{\"href\":\".//gerer_monnaies_logiciel\",\"className\":\"a_root__WEPS7 items_entry_link__EtVod\",\"title\":\"Lire cet article de blog\",\"target\":\"_self\",\"children\":[null,\"G√©rer les monnaies dans un logiciel (CRM,ERP)\"]}]}],[\"$\",\"p\",null,{\"className\":\"p_root__SHE_W items_entry_description__ZWt9y\",\"children\":[\"Je suis actuellement entrain de d√©velopper une solution CRM bas√©e sur mon framework Rest PHP. Il faut donc g√©rer les diff√©rentes monnaies.\",\" \",[\"$\",\"br\",null,{}],[\"$\",\"$L16\",null,{\"href\":\".//gerer_monnaies_logiciel\",\"className\":\"a_root__WEPS7\",\"title\":\"Lire cet article de blog\",\"target\":\"_self\",\"children\":[null,\"Lire la suite\"]}]]}],[\"$\",\"p\",null,{\"className\":\"p_root__SHE_W items_entry_time__iNrot\",\"children\":[\"Published at\",\" \",\"vendredi 16 novembre 2012 √† 10:24:57\",\".\"]}],[\"$\",\"div\",null,{\"className\":\"items_clear__3fyGk\"}]]}]]}]]}]}]]\n"])</script><script>self.__next_f.push([1,"10:[[\"$\",\"meta\",\"0\",{\"name\":\"viewport\",\"content\":\"width=device-width, initial-scale=1\"}],[\"$\",\"meta\",\"1\",{\"name\":\"theme-color\",\"content\":\"#3e78b2\"}],[\"$\",\"meta\",\"2\",{\"charSet\":\"utf-8\"}],[\"$\",\"title\",\"3\",{\"children\":\"MongoDB ou la conception probabiliste - Nicolas Froidure\"}],[\"$\",\"meta\",\"4\",{\"name\":\"description\",\"content\":\"Concevoir une base de donn√©e MongoDB c'est composer avec le hasard. Dans ce billet je vous propose de d√©couvrir pourquoi et comment.\"}],[\"$\",\"link\",\"5\",{\"rel\":\"author\",\"href\":\"https://insertafter.com\"}],[\"$\",\"meta\",\"6\",{\"name\":\"author\",\"content\":\"Nicolas Froidure\"}],[\"$\",\"meta\",\"7\",{\"name\":\"robots\",\"content\":\"index, follow\"}],[\"$\",\"link\",\"8\",{\"rel\":\"canonical\",\"href\":\"https://insertafter.com/fr/blog/design_probabiliste_mongodb\"}],[\"$\",\"meta\",\"9\",{\"property\":\"og:title\",\"content\":\"MongoDB ou la conception probabiliste - Nicolas Froidure\"}],[\"$\",\"meta\",\"10\",{\"property\":\"og:description\",\"content\":\"Concevoir une base de donn√©e MongoDB c'est composer avec le hasard. Dans ce billet je vous propose de d√©couvrir pourquoi et comment.\"}],[\"$\",\"meta\",\"11\",{\"property\":\"og:url\",\"content\":\"https://insertafter.com/fr/blog/design_probabiliste_mongodb\"}],[\"$\",\"meta\",\"12\",{\"property\":\"og:site_name\",\"content\":\"Nicolas Froidure\"}],[\"$\",\"meta\",\"13\",{\"property\":\"og:locale\",\"content\":\"fr_FR\"}],[\"$\",\"meta\",\"14\",{\"property\":\"og:image:alt\",\"content\":\"Banni√®re du site\"}],[\"$\",\"meta\",\"15\",{\"property\":\"og:image\",\"content\":\"https://insertafter.com/images/banner.png\"}],[\"$\",\"meta\",\"16\",{\"property\":\"og:type\",\"content\":\"article\"}],[\"$\",\"meta\",\"17\",{\"name\":\"twitter:card\",\"content\":\"summary\"}],[\"$\",\"meta\",\"18\",{\"name\":\"twitter:site\",\"content\":\"@nfroidure\"}],[\"$\",\"meta\",\"19\",{\"name\":\"twitter:creator\",\"content\":\"@nfroidure\"}],[\"$\",\"meta\",\"20\",{\"name\":\"twitter:title\",\"content\":\"MongoDB ou la conception probabiliste - Nicolas Froidure\"}],[\"$\",\"meta\",\"21\",{\"name\":\"twitter:description\",\"content\":\"Concevoir une base de donn√©e MongoDB c'est composer avec le hasard. Dans ce billet je vous propose de d√©couvrir pourquoi et comment.\"}],[\"$\",\"meta\",\"22\",{\"name\":\"twitter:image:alt\",\"content\":\"Banni√®re du site\"}],[\"$\",\"meta\",\"23\",{\"name\":\"twitter:image\",\"content\":\"https://insertafter.com/images/banner.png\"}],[\"$\",\"link\",\"24\",{\"rel\":\"icon\",\"href\":\"/images/favicon.svg\",\"type\":\"image/svg+xml\",\"sizes\":\"any\"}],[\"$\",\"link\",\"25\",{\"rel\":\"icon\",\"href\":\"/images/favicon-16.png\",\"type\":\"image/png\",\"sizes\":\"16x16\"}],[\"$\",\"link\",\"26\",{\"rel\":\"icon\",\"href\":\"/images/favicon-128.png\",\"type\":\"image/png\",\"sizes\":\"128x128\"}]]\n"])</script><script>self.__next_f.push([1,"5:null\n"])</script><script>self.__next_f.push([1,""])</script></body></html>