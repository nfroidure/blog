<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="preload" as="image" href="/images/logo.svg"/><link rel="preload" as="image" href="https://raw.githubusercontent.com/nfroidure/knifecycle/main/knifecycle.svg"/><link rel="preload" as="image" href="https://raw.githubusercontent.com/nfroidure/knifecycle/main/dependency-injection.svg"/><link rel="preload" as="image" href="https://raw.githubusercontent.com/nfroidure/knifecycle/main/dependencies-graph-sequences.svg"/><link rel="stylesheet" href="https://insertafter.com/_next/static/css/655a273f6fe37552.css" crossorigin="" data-precedence="next"/><link rel="stylesheet" href="https://insertafter.com/_next/static/css/4909000cd2d942cc.css" crossorigin="" data-precedence="next"/><link rel="preload" as="script" fetchPriority="low" href="https://insertafter.com/_next/static/chunks/webpack-f65a69f5b063a746.js" crossorigin=""/><script src="https://insertafter.com/_next/static/chunks/fd9d1056-5bc70f044f3cb802.js" async="" crossorigin=""></script><script src="https://insertafter.com/_next/static/chunks/938-bf741a2eb8fd4828.js" async="" crossorigin=""></script><script src="https://insertafter.com/_next/static/chunks/main-app-2e6280b5273157a5.js" async="" crossorigin=""></script><script src="https://insertafter.com/_next/static/chunks/176-0a03be62efe5672b.js" async=""></script><script src="https://insertafter.com/_next/static/chunks/app/(withLocale)/%5Blocale%5D/layout-3730889d272dc34b.js" async=""></script><script src="https://insertafter.com/_next/static/chunks/790-a194f74901d33197.js" async=""></script><script src="https://insertafter.com/_next/static/chunks/app/(withoutLocale)/%5Blocale%5D/page-6e49227023738746.js" async=""></script><meta name="theme-color" content="#3e78b2"/><title>Unobtrusive Dependency Injection with Knifecycle - Nicolas Froidure</title><meta name="description" content="Knifecycle is a NodeJS module aimed to provide DI power without the headaches."/><link rel="author" href="https://insertafter.com"/><meta name="author" content="Nicolas Froidure"/><meta name="robots" content="index, follow"/><link rel="canonical" href="https://insertafter.com/en/blog/toward_stricter_query_string_parserunobstrusive_dependency_injection_with_knifecycle"/><meta property="og:title" content="Unobtrusive Dependency Injection with Knifecycle - Nicolas Froidure"/><meta property="og:description" content="Knifecycle is a NodeJS module aimed to provide DI power without the headaches."/><meta property="og:url" content="https://insertafter.com/en/blog/toward_stricter_query_string_parserunobstrusive_dependency_injection_with_knifecycle"/><meta property="og:site_name" content="Nicolas Froidure"/><meta property="og:locale" content="en_US"/><meta property="og:image:alt" content="Website banner"/><meta property="og:image" content="https://insertafter.com/images/banner.png"/><meta property="og:type" content="article"/><meta name="twitter:card" content="summary"/><meta name="twitter:site" content="@nfroidure"/><meta name="twitter:creator" content="@nfroidure"/><meta name="twitter:title" content="Unobtrusive Dependency Injection with Knifecycle - Nicolas Froidure"/><meta name="twitter:description" content="Knifecycle is a NodeJS module aimed to provide DI power without the headaches."/><meta name="twitter:image:alt" content="Website banner"/><meta name="twitter:image" content="https://insertafter.com/images/banner.png"/><link rel="icon" href="/images/favicon.svg" type="image/svg+xml" sizes="any"/><link rel="icon" href="/images/favicon-16.png" type="image/png" sizes="16x16"/><link rel="icon" href="/images/favicon-128.png" type="image/png" sizes="128x128"/><script src="https://insertafter.com/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js" crossorigin="" noModule=""></script></head><body class="layout_body__jFZuu"><header class="header_iaHeader__4vCMA"><div><h1><a href="/en" title="Go back to home page" class="header_iaHeaderLogo__0uNr1"><img src="/images/logo.svg" alt="InsertAfter&#x27;s Logo"/></a></h1></div></header><nav class="menu_iaMenu__B_rtj"><ul class="menu_iaMenuBody__0Zveq"><li class="menu_iaMenuItem__rOch4"><a href="/en" title="Go back to home page" class="">Home</a></li><li class="menu_iaMenuItem__rOch4"><a href="/en/blog" title="Read my blog posts" class="">Blog</a></li><li class="menu_iaMenuItem__rOch4"><a href="/en/projects" title="Discover my projects" class="">Projects</a></li><li class="menu_iaMenuItem__rOch4"><a href="/en/about" title="Read more about me" class="">About me</a></li></ul></nav><nav class="languages_iaLanguages__K2J3W"><ul><li class="languages_iaLanguagesFlag__ruQ4j languages_iaLanguagesFlagEn__angfJ"><a href="/en"><span>en</span></a></li><li class="languages_iaLanguagesFlag__ruQ4j languages_iaLanguagesFlagFr__Us5Jb languages_selected__w1dKv"><a href="/fr"><span>fr</span></a></li></ul></nav><main class="layout_iaMain__6s2gl"><div><section class="contentBlock_root__802UK"><h1 class="h1_root__VPXQG"><span>Unobtrusive Dependency Injection with Knifecycle</span></h1><div><span class="img_root__vTZoG img_landscape__qBqfT"><span class="img_picture__pfsl0"><img alt="Knifecycle logo" src="https://raw.githubusercontent.com/nfroidure/knifecycle/main/knifecycle.svg"/></span></span></div><p class="p_root__SHE_W"><div class="slidesDotCom_root__yd21N"><iframe src="https://slides.com/nfroidure/javascript_dependency_injection/embed" allowFullScreen=""></iframe><noscript><a class="a_root__WEPS7" title="See the presentation slides" target="_blank" href="https://slides.com/nfroidure/javascript_dependency_injection"><span>Slides</span></a></noscript></div></p><p class="p_root__SHE_W"><span>I first used the dependency injection (DI) pattern with the AngularJS framework a few years ago. Since then, I am convinced it is one of the best design pattern out there, when used with caution. Here&#x27;s why and how I finally bundled my own dependency injection library for JavaScript and NodeJS.</span></p><h2 class="h2_root__Y02lX"><span class="anchored_root__HWi6K"><span>What is Dependency Injection?</span> <small><a class="anchored_icon__N5Sem" id="what-is-dependency-injection" title="Lien vers cette section" href="#what-is-dependency-injection"><span>ðŸ”—</span></a></small></span></h2><p class="p_root__SHE_W"><span>The </span><a class="a_root__WEPS7" title="Check the full definition on Wikipedia" target="_blank" href="https://en.wikipedia.org/wiki/Dependency%5Finjection"><span>dependency injection pattern</span></a><span> aims to provide the states some code depends on. That way, the actual code is completely decoupled from its own dependencies implementation / initialization.</span></p><p class="p_root__SHE_W"><span>People rarely have no advice on it, they often hate or love it, no mitigation there. I think it comes from the fact it really brings great powers but sadly it often forces you to respect a few annoying conventions on how you write and split your code.</span></p><h2 class="h2_root__Y02lX"><span class="anchored_root__HWi6K"><span>Definition</span> <small><a class="anchored_icon__N5Sem" id="definition" title="Lien vers cette section" href="#definition"><span>ðŸ”—</span></a></small></span></h2><p class="p_root__SHE_W"><span>First of all, let&#x27;s briefly recall you the DI advantages. The DI comes with the idea that the applications life cycle usually is about initializing things, use it and finally free it.</span></p><div><span class="img_root__vTZoG img_landscape__qBqfT"><span class="img_picture__pfsl0"><img alt="Application Lifecycle Timeline" src="https://raw.githubusercontent.com/nfroidure/knifecycle/main/dependency-injection.svg"/></span></span></div><p class="p_root__SHE_W"><span>It may be databases, external APIs, RPC calls, anything implying IOs with the rest of the world. They are a bit special and this is why DI threat it differently than simple code libraries.</span></p><p class="p_root__SHE_W"><span>Those dependencies are linked to each other so that we finally have an oriented dependency graph. The initialization and shutdown sequences are then resolving the graph in an optimized way with the best parallelism possible. This is the injector role to take care of it.</span></p><div><span class="img_root__vTZoG img_landscape__qBqfT"><span class="img_picture__pfsl0"><img alt="Dependencies graph initialization and shutdown sequence" src="https://raw.githubusercontent.com/nfroidure/knifecycle/main/dependencies-graph-sequences.svg"/></span></span></div><p class="p_root__SHE_W"><span>Basically, in JavaScript, DI looks like this:</span></p><div class="code_root__5JLV_"><code><pre>// With Classes
class User {
  constructor(db, log) {
    this.db = db;
    this.log = log;
  }
  async delete() {
    const result = await this.db.query(&quot;DELETE FROM users WHERE id = $id&quot;, {
      id,
    });

    if (result.deletedRows) {
      this.log(`User ${id} has been deleted!`);
    }
  }
}

// With functions
async function deleteUser({ db, log, id }) {
  const result = await db.query(&quot;DELETE FROM users WHERE id = $id&quot;, { id });

  if (result.deletedRows) {
    log(`User ${id} has been deleted!`);
  }
}</pre></code></div><h3 class="h3_root__kVaqq"><span class="anchored_root__HWi6K"><span>The DI goodness</span> <small><a class="anchored_icon__N5Sem" id="the-di-goodness" title="Lien vers cette section" href="#the-di-goodness"><span>ðŸ”—</span></a></small></span></h3><p class="p_root__SHE_W"><span>Using DI allows you to just declare your services dependencies and delegate the startup and shutdown process to the injector. It saves you a lot of time and allows to focus on your actual business code.</span></p><p class="p_root__SHE_W"><span>It also make your code more testable since you can easily replace a dependency per another (mocks, stubs).</span></p><p class="p_root__SHE_W"><span>Making dependencies easy to substitute also leads to a more configurable code base. Your code base pieces are also more reusable.</span></p><p class="p_root__SHE_W"><span>Finally, splitting your code into more specialized modules helps reducing the cognitive load of reasoning on its parts.</span></p><h3 class="h3_root__kVaqq"><span class="anchored_root__HWi6K"><span>The DI downsides</span> <small><a class="anchored_icon__N5Sem" id="the-di-downsides" title="Lien vers cette section" href="#the-di-downsides"><span>ðŸ”—</span></a></small></span></h3><p class="p_root__SHE_W"><span>Usually, dependency injection with the help of an injector comes with downsides. First, it makes debugging harder since the code only express dependencies in a declarative way. That said, usually, injectors are bullet proof and some have a limited set of features reducing the bug risks.</span></p><p class="p_root__SHE_W"><span>Also, when using types, since DI is dynamically done, you may loose some advantages of strong typing and static code analysis.</span></p><p class="p_root__SHE_W"><span>Those downsides can be mitigated as we&#x27;ll see later.</span></p><h2 class="h2_root__Y02lX"><span class="anchored_root__HWi6K"><span>Introducing Knifecycle</span> <small><a class="anchored_icon__N5Sem" id="introducing-knifecycle" title="Lien vers cette section" href="#introducing-knifecycle"><span>ðŸ”—</span></a></small></span></h2><p class="p_root__SHE_W"><span>When it comes to DI, most tools are levering OOP and decorators. While it may fit the needs of OOP lovers, I prefer using the function based approach where a service is simply initialized by an asynchronous function taking the service&#x27;s dependencies in argument and returning the initialized service.</span></p><p class="p_root__SHE_W"><span>Using functions also makes the code independent of the actual DI library since, you know, it&#x27;s just functions and function can be called without any framework. One could just use those functions and initialize the process dependencies with actual code.</span></p><p class="p_root__SHE_W"><span>In fact, I used to create my services that way and to create the initialization code by hand for years. The thing is that it is repetitive, error prone and create boilerplate that adds no value.</span></p><p class="p_root__SHE_W"><span>I finally decided to automatize it but I didn&#x27;t found a tool allowing DI usage without having to embrace a whole opinionated framework. I just wanted to use simple functions so I created one. Here comes, </span><a class="a_root__WEPS7" target="_blank" href="https://github.com/nfroidure/knifecycle"><span>Knifecycle</span></a><span>.</span></p><p class="p_root__SHE_W"><span>I like to refer to Knifecycle as the DI banana without the </span><a class="a_root__WEPS7" target="_blank" href="https://en.wikipedia.org/wiki/Object-oriented%5Fprogramming#cite%5Fref-armstrongjoe%5F39-1"><span>Gorilla</span></a><span> since most DI libraries are using OOP and I am really convinced it is a mistake.</span></p><h3 class="h3_root__kVaqq"><span class="anchored_root__HWi6K"><span>Using Knifecycle</span> <small><a class="anchored_icon__N5Sem" id="using-knifecycle" title="Lien vers cette section" href="#using-knifecycle"><span>ðŸ”—</span></a></small></span></h3><p class="p_root__SHE_W"><span>Declaring a service is pretty simple actually, you just have to use the various functions that allows tagging initialization functions (called initializers) with the dependencies they actually need, the name and the kind of service it provides.</span></p><div class="gist_root__FwqUp"><iframe src="data:text/html;base64,PHNjcmlwdCBzcmM9Imh0dHBzOi8vZ2lzdC5naXRodWIuY29tL25mcm9pZHVyZS9kOWZiOWQyZDQwZjA2MTRjYTlmMzFhNzVhM2M1MjAxZC5qcyI+PC9zY3JpcHQ+"></iframe><noscript><div class="code_root__5JLV_"><code><pre>// From the Gist: https://gist.github.com/nfroidure/d9fb9d2d40f0614ca9f31a75a3c5201d</pre></code></div></noscript></div><p class="p_root__SHE_W"><span>The reason why the autoService and autoProvider are prefixed by auto is that they infer from the function shape the names of the services and the dependencies they need from the functions signature. One could use the service and provider functions that basically do the same but in a more verbose manner. They can be useful to have more control on them though. That said, you can use the automatic versions and transpile it to the explicit ones by using the </span><a class="a_root__WEPS7" target="_blank" href="https://github.com/nfroidure/babel-plugin-knifecycle"><code class="code_root__5JLV_">babel-plugin-knifecycle</code></a><span> module in your project&#x27;s build.</span></p><p class="p_root__SHE_W"><span>Knifecycle provides a lot of helpers you can find on the </span><a class="a_root__WEPS7" target="_blank" href="https://github.com/nfroidure/knifecycle#api"><span>documentation</span></a><span>. Since services initializer are simple functions, there is a lot of functional programming concepts that applies to them (wrappers, compositions, piping...). Each decorators create a newly bound function so you can reuse an initialization function with different names and dependencies as many times as you need. For instance, in the previous example, if you needed to use the FTP service several times with different options you would just have to do the following:</span></p><div class="gist_root__FwqUp"><iframe src="data:text/html;base64,PHNjcmlwdCBzcmM9Imh0dHBzOi8vZ2lzdC5naXRodWIuY29tL25mcm9pZHVyZS9jNDg4OWIxMjFhM2EwMTQ2ZjJhZjRhN2Q5OWNkNGEwMi5qcyI+PC9zY3JpcHQ+"></iframe><noscript><div class="code_root__5JLV_"><code><pre>// From the Gist: https://gist.github.com/nfroidure/c4889b121a3a0146f2af4a7d99cd4a02</pre></code></div></noscript></div><h2 class="h2_root__Y02lX"><span class="anchored_root__HWi6K"><span>Addressing DI common downsides</span> <small><a class="anchored_icon__N5Sem" id="addressing-di-common-downsides" title="Lien vers cette section" href="#addressing-di-common-downsides"><span>ðŸ”—</span></a></small></span></h2><p class="p_root__SHE_W"><span>Sometime, using DI makes hard to figure out the final dependency graph since you just declare each piece of code&#x27;s dependencies separately. Knifecycle provides a way to build graphs from your code for that purpose. You can see an example of those graph in the </span><a class="a_root__WEPS7" target="_blank" href="https://github.com/nfroidure/jsarch/blob/master/ARCHITECTURE.md"><span>jsarch architecture notes</span></a><span>. It is built using </span><a class="a_root__WEPS7" target="_blank" href="https://github.com/nfroidure/jsarch/blob/master/package.json#L38"><span>mermaid</span></a><span>.</span></p><p class="p_root__SHE_W"><span>Another downside is the dynamic code that implies DI. Knifecycle allows you to build the </span><a class="a_root__WEPS7" target="_blank" href="https://github.com/nfroidure/knifecycle/blob/master/src/build.mocha.js#L72-L133"><span>injector code statically</span></a><span> so that you no longer need to embed Knifecycle in your final build. This is how I build the AWS Lambda functions of the Sencrop&#x27;s backend. That way, the lambdas only contains the code they need to rely on. This is a nice side effect of limiting the DI influence on your own code.</span></p><p class="p_root__SHE_W"><span>You can see a </span><a class="a_root__WEPS7" target="_blank" href="https://github.com/nfroidure/di-test"><span>full repository</span></a><span> with Knifecycle usage example for a TypeScript project. It starts with no DI and then implement it with Knifecycle. In this post example, I declared the services manually but the injector can load the services automatically. This concept is </span><a class="a_root__WEPS7" target="_blank" href="https://github.com/nfroidure/di-test/blob/master/src/services/_autoload.ts"><span>also illustrated</span></a><span> in the above TypeScript project.</span></p><p class="p_root__SHE_W"><span>I hope you&#x27;ll find your own usage of </span><a class="a_root__WEPS7" target="_blank" href="https://github.com/nfroidure/knifecycle"><span>Knifecycle</span></a><span>, I use it happily since 2 years now. If you want to try, feel free to reach me for help whenever you need some ;).</span></p><p class="p_root__SHE_W"><strong class="strong_root__kOzFq"><span>Edit:</span></strong><span> Knifecycle is at the core of the </span><a class="a_root__WEPS7" target="_blank" href="https://github.com/nfroidure/whook"><span>Whook framework</span></a><span> and a lot of </span><a class="a_root__WEPS7" target="_blank" href="https://www.npmjs.com/search?q=keywords:knifecycle"><span>NPM modules using it</span></a><span> are available in NPM.</span></p><p class="p_root__SHE_W">Published at<!-- --> <!-- -->samedi 26 janvier 2019 Ã  13:00:00<!-- -->.</p></section><section class="contentBlock_root__802UK"><aside class="share_root__Qm_RR"><h2 class="h2_root__Y02lX">Comment and share</h2><p class="p_root__SHE_W"><a class="a_root__WEPS7" title="Comment on Facebook" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Finsertafter.com%2Fblog%2Ftoward_stricter_query_string_parserunobstrusive_dependency_injection_with_knifecycle"><span class="share_icon__bi4Q3 share_facebook__JKn8d"></span>Facebook</a> - <a class="a_root__WEPS7" title="Comment on Twitter" target="_blank" href="https://twitter.com/intent/tweet/?url=https%3A%2F%2Finsertafter.com%2Fblog%2Ftoward_stricter_query_string_parserunobstrusive_dependency_injection_with_knifecycle&amp;text=Unobtrusive%20Dependency%20Injection%20with%20Knifecycle&amp;via=nfroidure"><span class="share_icon__bi4Q3 "></span>Twitter</a> - <a class="a_root__WEPS7" title="Answer via email" target="_self" href="mailto:nicolas.froidure@gmail.com"><span class="share_icon__bi4Q3 share_mail__yvBDK"></span>Email</a></p></aside></section><section class="contentBlock_root__802UK"><aside class="page_linkedEntries__jiPuT"><h2 class="h2_root__Y02lX">Similar posts</h2><p class="p_root__SHE_W">In the categories<!-- --> <!-- -->Dependency Injection, NodeJS, JavaScript, Knifecycle, and NPM<!-- -->.</p><div class="items_entries__5hkLG"><div class="items_entry_item__GWeg7"><h2 class="h2_root__Y02lX items_entry_title__vJ_8h"><a class="a_root__WEPS7 items_entry_link__EtVod" title="Read this blog post" target="_self" href=".//metapak">Meta NPM Packages</a></h2><p class="p_root__SHE_W items_entry_description__ZWt9y">On managing a lot of NPM modules.<!-- --> <br/><a class="a_root__WEPS7" title="Read this blog post" target="_self" href=".//metapak">Read the full post</a></p><p class="p_root__SHE_W items_entry_time__iNrot">Published at<!-- --> <!-- -->jeudi 2 fÃ©vrier 2017 Ã  05:29:10<!-- -->.</p><div class="items_clear__3fyGk"></div></div><div class="items_entry_item__GWeg7"><h2 class="h2_root__Y02lX items_entry_title__vJ_8h"><a class="a_root__WEPS7 items_entry_link__EtVod" title="Read this blog post" target="_self" href=".//no_more_middlewares">No more middlewares, please</a></h2><p class="p_root__SHE_W items_entry_description__ZWt9y">Why I think middlewares are a bad thing, how I am replacing them.<!-- --> <br/><a class="a_root__WEPS7" title="Read this blog post" target="_self" href=".//no_more_middlewares">Read the full post</a></p><p class="p_root__SHE_W items_entry_time__iNrot">Published at<!-- --> <!-- -->samedi 5 novembre 2016 Ã  20:50:20<!-- -->.</p><div class="items_clear__3fyGk"></div></div><div class="items_entry_item__GWeg7"><h2 class="h2_root__Y02lX items_entry_title__vJ_8h"><a class="a_root__WEPS7 items_entry_link__EtVod" title="Read this blog post" target="_self" href=".//lets_subset_javascript">Let&#x27;s Subset JavaScript</a></h2><p class="p_root__SHE_W items_entry_description__ZWt9y">Currently, it&#x27;s all about JavaScript and how to compile, transpile and every &quot;ile&quot;y things you could imagine. But what about making JavaScript smaller?<!-- --> <br/><a class="a_root__WEPS7" title="Read this blog post" target="_self" href=".//lets_subset_javascript">Read the full post</a></p><p class="p_root__SHE_W items_entry_time__iNrot">Published at<!-- --> <!-- -->vendredi 10 juillet 2015 Ã  15:38:03<!-- -->.</p><div class="items_clear__3fyGk"></div></div></div></aside></section></div></main><aside class="social_iaSocial__kdR1x"><nav><ul><li><a href="https://mastodon.social/@nfroidure" rel="me" title="Follow me on Mastodon" class="social_iaSocialMastodon__MTF6o"><span>Mastodon</span></a></li><li><a href="https://bsky.app/profile/nfroidure.bsky.social" rel="me" title="Follow me on Bluesky" class="social_iaSocialBluesky__fKW6M"><span>Bluesky</span></a></li><li><a href="https://twitter.com/nfroidure" title="Follow me on Twitter" class="social_iaSocialTwitter__9nU6R"><span>Twitter</span></a></li><li><a href="https://github.com/nfroidure" title="See my GitHub projects" class="social_iaSocialGithub__vcU5_"><span>GitHub</span></a></li><li><a href="https://www.npmjs.org/~nfroidure" title="Check my NPM modules" class="social_iaSocialNpm__6nku5"><span>NPM</span></a></li><li><a href="https://www.linkedin.com/in/nfroidure/" rel="me" title="See my LinkedIn profile" class="social_iaSocialLinkedin__pWACO"><span>LinkedIn</span></a></li><li><a href="https://facebook.com/nicolas.froidure.douai" rel="me" title="Follow me on Facebook" class="social_iaSocialFacebook__w4wfH"><span>Facebook</span></a></li><li><a href="/en/blog/index.atom" title="Subscribe to my RSS feed" class="social_iaSocialFeed__gEQQ0"><span>RSS Feed</span></a></li></ul></nav></aside><footer class="footer_iaFooter__rhlnQ"><p class="footer_iaFooterContent__VZndF">Â© Nicolas Froidure 2012-<!-- -->2024</p></footer><script src="https://insertafter.com/_next/static/chunks/webpack-f65a69f5b063a746.js" crossorigin="" async=""></script><script>(self.__next_f=self.__next_f||[]).push([0]);self.__next_f.push([2,null])</script><script>self.__next_f.push([1,"0:\"$L1\"\n"])</script><script>self.__next_f.push([1,"2:HL[\"https://insertafter.com/_next/static/css/655a273f6fe37552.css\",\"style\",{\"crossOrigin\":\"\"}]\n3:HL[\"https://insertafter.com/_next/static/css/4909000cd2d942cc.css\",\"style\",{\"crossOrigin\":\"\"}]\n"])</script><script>self.__next_f.push([1,"4:I[7690,[],\"\"]\n7:I[5613,[],\"\"]\n9:I[1778,[],\"\"]\nc:I[8955,[],\"\"]\n8:[\"locale\",\"blog-toward_stricter_query_string_parserunobstrusive_dependency_injection_with_knifecycle\",\"d\"]\n"])</script><script>self.__next_f.push([1,"1:[null,[\"$\",\"$L4\",null,{\"buildId\":\"KvaQf7Occ1_mTQr28YDxi\",\"assetPrefix\":\"https://insertafter.com\",\"initialCanonicalUrl\":\"/blog-toward_stricter_query_string_parserunobstrusive_dependency_injection_with_knifecycle\",\"initialTree\":[\"\",{\"children\":[\"(withoutLocale)\",{\"children\":[[\"locale\",\"blog-toward_stricter_query_string_parserunobstrusive_dependency_injection_with_knifecycle\",\"d\"],{\"children\":[\"__PAGE__?{\\\"locale\\\":\\\"blog-toward_stricter_query_string_parserunobstrusive_dependency_injection_with_knifecycle\\\"}\",{}]}]},\"$undefined\",\"$undefined\",true]}],\"initialSeedData\":[\"\",{\"children\":[\"(withoutLocale)\",{\"children\":[[\"locale\",\"blog-toward_stricter_query_string_parserunobstrusive_dependency_injection_with_knifecycle\",\"d\"],{\"children\":[\"__PAGE__\",{},[\"$L5\",\"$L6\",null]]},[\"$\",\"$L7\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"(withoutLocale)\",\"children\",\"$8\",\"children\"],\"loading\":\"$undefined\",\"loadingStyles\":\"$undefined\",\"loadingScripts\":\"$undefined\",\"hasLoading\":false,\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L9\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"notFoundStyles\":\"$undefined\",\"styles\":[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"https://insertafter.com/_next/static/css/4909000cd2d942cc.css\",\"precedence\":\"next\",\"crossOrigin\":\"\"}]]}]]},[null,\"$La\",null]]},[\"$\",\"$L7\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\"],\"loading\":\"$undefined\",\"loadingStyles\":\"$undefined\",\"loadingScripts\":\"$undefined\",\"hasLoading\":false,\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L9\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":[[\"$\",\"title\",null,{\"children\":\"404: This page could not be found.\"}],[\"$\",\"div\",null,{\"style\":{\"fontFamily\":\"system-ui,\\\"Segoe UI\\\",Roboto,Helvetica,Arial,sans-serif,\\\"Apple Color Emoji\\\",\\\"Segoe UI Emoji\\\"\",\"height\":\"100vh\",\"textAlign\":\"center\",\"display\":\"flex\",\"flexDirection\":\"column\",\"alignItems\":\"center\",\"justifyContent\":\"center\"},\"children\":[\"$\",\"div\",null,{\"children\":[[\"$\",\"style\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"body{color:#000;background:#fff;margin:0}.next-error-h1{border-right:1px solid rgba(0,0,0,.3)}@media (prefers-color-scheme:dark){body{color:#fff;background:#000}.next-error-h1{border-right:1px solid rgba(255,255,255,.3)}}\"}}],[\"$\",\"h1\",null,{\"className\":\"next-error-h1\",\"style\":{\"display\":\"inline-block\",\"margin\":\"0 20px 0 0\",\"padding\":\"0 23px 0 0\",\"fontSize\":24,\"fontWeight\":500,\"verticalAlign\":\"top\",\"lineHeight\":\"49px\"},\"children\":\"404\"}],[\"$\",\"div\",null,{\"style\":{\"display\":\"inline-block\"},\"children\":[\"$\",\"h2\",null,{\"style\":{\"fontSize\":14,\"fontWeight\":400,\"lineHeight\":\"49px\",\"margin\":0},\"children\":\"This page could not be found.\"}]}]]}]}]],\"notFoundStyles\":[],\"styles\":[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"https://insertafter.com/_next/static/css/655a273f6fe37552.css\",\"precedence\":\"next\",\"crossOrigin\":\"\"}]]}]],\"initialHead\":[false,\"$Lb\"],\"globalErrorComponent\":\"$c\"}]]\n"])</script><script>self.__next_f.push([1,"d:\"$Sreact.strict_mode\"\ne:I[4630,[\"176\",\"static/chunks/176-0a03be62efe5672b.js\",\"960\",\"static/chunks/app/(withLocale)/%5Blocale%5D/layout-3730889d272dc34b.js\"],\"\"]\nf:I[4341,[\"176\",\"static/chunks/176-0a03be62efe5672b.js\",\"960\",\"static/chunks/app/(withLocale)/%5Blocale%5D/layout-3730889d272dc34b.js\"],\"\"]\n10:{\"fontFamily\":\"system-ui,\\\"Segoe UI\\\",Roboto,Helvetica,Arial,sans-serif,\\\"Apple Color Emoji\\\",\\\"Segoe UI Emoji\\\"\",\"height\":\"100vh\",\"textAlign\":\"center\",\"display\":\"flex\",\"flexDirection\":\"column\",\"alignItems"])</script><script>self.__next_f.push([1,"\":\"center\",\"justifyContent\":\"center\"}\n11:{\"display\":\"inline-block\",\"margin\":\"0 20px 0 0\",\"padding\":\"0 23px 0 0\",\"fontSize\":24,\"fontWeight\":500,\"verticalAlign\":\"top\",\"lineHeight\":\"49px\"}\n12:{\"display\":\"inline-block\"}\n13:{\"fontSize\":14,\"fontWeight\":400,\"lineHeight\":\"49px\",\"margin\":0}\n"])</script><script>self.__next_f.push([1,"a:[\"$\",\"$d\",null,{\"children\":[\"$\",\"html\",null,{\"lang\":\"en\",\"children\":[\"$\",\"body\",null,{\"className\":\"layout_body__jFZuu\",\"children\":[null,[\"$\",\"header\",null,{\"className\":\"header_iaHeader__4vCMA\",\"children\":[\"$\",\"div\",null,{\"className\":\"$undefined\",\"children\":[\"$\",\"h1\",null,{\"children\":[\"$\",\"a\",null,{\"href\":\"/en\",\"title\":\"Go back to home page\",\"className\":\"header_iaHeaderLogo__0uNr1\",\"children\":[\"$\",\"img\",null,{\"src\":\"/images/logo.svg\",\"alt\":\"InsertAfter's Logo\"}]}]}]}]}],[\"$\",\"$Le\",null,{\"locale\":\"en\",\"dictionary\":{\"home\":{\"label\":\"Home\",\"title\":\"Go back to home page\"},\"blog\":{\"label\":\"Blog\",\"title\":\"Read my blog posts\"},\"projects\":{\"label\":\"Projects\",\"title\":\"Discover my projects\"},\"about\":{\"label\":\"About me\",\"title\":\"Read more about me\"}}}],[\"$\",\"$Lf\",null,{\"locale\":\"en\"}],[\"$\",\"main\",null,{\"className\":\"layout_iaMain__6s2gl\",\"children\":[\"$\",\"div\",null,{\"children\":[\"$\",\"$L7\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"(withoutLocale)\",\"children\"],\"loading\":\"$undefined\",\"loadingStyles\":\"$undefined\",\"loadingScripts\":\"$undefined\",\"hasLoading\":false,\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L9\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":[[\"$\",\"title\",null,{\"children\":\"404: This page could not be found.\"}],[\"$\",\"div\",null,{\"style\":\"$10\",\"children\":[\"$\",\"div\",null,{\"children\":[[\"$\",\"style\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"body{color:#000;background:#fff;margin:0}.next-error-h1{border-right:1px solid rgba(0,0,0,.3)}@media (prefers-color-scheme:dark){body{color:#fff;background:#000}.next-error-h1{border-right:1px solid rgba(255,255,255,.3)}}\"}}],[\"$\",\"h1\",null,{\"className\":\"next-error-h1\",\"style\":\"$11\",\"children\":\"404\"}],[\"$\",\"div\",null,{\"style\":\"$12\",\"children\":[\"$\",\"h2\",null,{\"style\":\"$13\",\"children\":\"This page could not be found.\"}]}]]}]}]],\"notFoundStyles\":[],\"styles\":null}]}]}],[\"$\",\"aside\",null,{\"className\":\"social_iaSocial__kdR1x\",\"children\":[\"$\",\"nav\",null,{\"children\":[\"$\",\"ul\",null,{\"children\":[[\"$\",\"li\",null,{\"children\":[\"$\",\"a\",null,{\"href\":\"https://mastodon.social/@nfroidure\",\"rel\":\"me\",\"title\":\"Follow me on Mastodon\",\"className\":\"social_iaSocialMastodon__MTF6o\",\"children\":[\"$\",\"span\",null,{\"children\":\"Mastodon\"}]}]}],[\"$\",\"li\",null,{\"children\":[\"$\",\"a\",null,{\"href\":\"https://bsky.app/profile/nfroidure.bsky.social\",\"rel\":\"me\",\"title\":\"Follow me on Bluesky\",\"className\":\"social_iaSocialBluesky__fKW6M\",\"children\":[\"$\",\"span\",null,{\"children\":\"Bluesky\"}]}]}],[\"$\",\"li\",null,{\"children\":[\"$\",\"a\",null,{\"href\":\"https://twitter.com/nfroidure\",\"title\":\"Follow me on Twitter\",\"className\":\"social_iaSocialTwitter__9nU6R\",\"children\":[\"$\",\"span\",null,{\"children\":\"Twitter\"}]}]}],[\"$\",\"li\",null,{\"children\":[\"$\",\"a\",null,{\"href\":\"https://github.com/nfroidure\",\"title\":\"See my GitHub projects\",\"className\":\"social_iaSocialGithub__vcU5_\",\"children\":[\"$\",\"span\",null,{\"children\":\"GitHub\"}]}]}],[\"$\",\"li\",null,{\"children\":[\"$\",\"a\",null,{\"href\":\"https://www.npmjs.org/~nfroidure\",\"title\":\"Check my NPM modules\",\"className\":\"social_iaSocialNpm__6nku5\",\"children\":[\"$\",\"span\",null,{\"children\":\"NPM\"}]}]}],[\"$\",\"li\",null,{\"children\":[\"$\",\"a\",null,{\"href\":\"https://www.linkedin.com/in/nfroidure/\",\"rel\":\"me\",\"title\":\"See my LinkedIn profile\",\"className\":\"social_iaSocialLinkedin__pWACO\",\"children\":[\"$\",\"span\",null,{\"children\":\"LinkedIn\"}]}]}],[\"$\",\"li\",null,{\"children\":[\"$\",\"a\",null,{\"href\":\"https://facebook.com/nicolas.froidure.douai\",\"rel\":\"me\",\"title\":\"Follow me on Facebook\",\"className\":\"social_iaSocialFacebook__w4wfH\",\"children\":[\"$\",\"span\",null,{\"children\":\"Facebook\"}]}]}],[\"$\",\"li\",null,{\"children\":[\"$\",\"a\",null,{\"href\":\"/en/blog/index.atom\",\"title\":\"Subscribe to my RSS feed\",\"className\":\"social_iaSocialFeed__gEQQ0\",\"children\":[\"$\",\"span\",null,{\"children\":\"RSS Feed\"}]}]}]]}]}]}],[\"$\",\"footer\",null,{\"className\":\"footer_iaFooter__rhlnQ\",\"children\":[\"$\",\"p\",null,{\"className\":\"footer_iaFooterContent__VZndF\",\"children\":[\"Â© Nicolas Froidure 2012-\",2024]}]}]]}]}]}]\n"])</script><script>self.__next_f.push([1,"14:I[5250,[\"176\",\"static/chunks/176-0a03be62efe5672b.js\",\"790\",\"static/chunks/790-a194f74901d33197.js\",\"770\",\"static/chunks/app/(withoutLocale)/%5Blocale%5D/page-6e49227023738746.js\"],\"\"]\n"])</script><script>self.__next_f.push([1,"6:[[\"$\",\"section\",null,{\"className\":\"contentBlock_root__802UK\",\"children\":[[[\"$\",\"h1\",null,{\"className\":\"h1_root__VPXQG\",\"children\":[[\"$\",\"span\",\"0\",{\"children\":\"Unobtrusive Dependency Injection with Knifecycle\"}]]}],[\"$\",\"div\",\"1\",{\"children\":[\"$\",\"span\",null,{\"className\":\"img_root__vTZoG img_landscape__qBqfT\",\"children\":[[\"$\",\"span\",null,{\"className\":\"img_picture__pfsl0\",\"children\":[\"$\",\"img\",null,{\"alt\":\"Knifecycle logo\",\"src\":\"https://raw.githubusercontent.com/nfroidure/knifecycle/main/knifecycle.svg\"}]}],null]}]}],[\"$\",\"p\",null,{\"className\":\"p_root__SHE_W\",\"children\":[[\"$\",\"div\",null,{\"className\":\"slidesDotCom_root__yd21N\",\"children\":[[\"$\",\"iframe\",null,{\"src\":\"https://slides.com/nfroidure/javascript_dependency_injection/embed\",\"allowFullScreen\":true}],[\"$\",\"noscript\",null,{\"children\":[\"$\",\"$L14\",null,{\"href\":\"https://slides.com/nfroidure/javascript_dependency_injection\",\"className\":\"a_root__WEPS7\",\"title\":\"See the presentation slides\",\"target\":\"_blank\",\"children\":[null,[[\"$\",\"span\",\"0\",{\"children\":\"Slides\"}]]]}]}]]}]]}],[\"$\",\"p\",null,{\"className\":\"p_root__SHE_W\",\"children\":[[\"$\",\"span\",\"0\",{\"children\":\"I first used the dependency injection (DI) pattern with the AngularJS framework a few years ago. Since then, I am convinced it is one of the best design pattern out there, when used with caution. Here's why and how I finally bundled my own dependency injection library for JavaScript and NodeJS.\"}]]}],[\"$\",\"h2\",null,{\"className\":\"h2_root__Y02lX\",\"children\":[\"$\",\"span\",null,{\"className\":\"anchored_root__HWi6K\",\"children\":[[[\"$\",\"span\",\"0\",{\"children\":\"What is Dependency Injection?\"}]],\" \",[\"$\",\"small\",null,{\"children\":[\"$\",\"$L14\",null,{\"href\":\"#what-is-dependency-injection\",\"className\":\"anchored_icon__N5Sem\",\"id\":\"what-is-dependency-injection\",\"title\":\"Lien vers cette section\",\"children\":[\"$\",\"span\",null,{\"children\":\"ðŸ”—\"}]}]}]]}]}],[\"$\",\"p\",null,{\"className\":\"p_root__SHE_W\",\"children\":[[\"$\",\"span\",\"0\",{\"children\":\"The \"}],[\"$\",\"$L14\",null,{\"href\":\"https://en.wikipedia.org/wiki/Dependency%5Finjection\",\"className\":\"a_root__WEPS7\",\"title\":\"Check the full definition on Wikipedia\",\"target\":\"_blank\",\"children\":[null,[[\"$\",\"span\",\"0\",{\"children\":\"dependency injection pattern\"}]]]}],[\"$\",\"span\",\"2\",{\"children\":\" aims to provide the states some code depends on. That way, the actual code is completely decoupled from its own dependencies implementation / initialization.\"}]]}],[\"$\",\"p\",null,{\"className\":\"p_root__SHE_W\",\"children\":[[\"$\",\"span\",\"0\",{\"children\":\"People rarely have no advice on it, they often hate or love it, no mitigation there. I think it comes from the fact it really brings great powers but sadly it often forces you to respect a few annoying conventions on how you write and split your code.\"}]]}],[\"$\",\"h2\",null,{\"className\":\"h2_root__Y02lX\",\"children\":[\"$\",\"span\",null,{\"className\":\"anchored_root__HWi6K\",\"children\":[[[\"$\",\"span\",\"0\",{\"children\":\"Definition\"}]],\" \",[\"$\",\"small\",null,{\"children\":[\"$\",\"$L14\",null,{\"href\":\"#definition\",\"className\":\"anchored_icon__N5Sem\",\"id\":\"definition\",\"title\":\"Lien vers cette section\",\"children\":[\"$\",\"span\",null,{\"children\":\"ðŸ”—\"}]}]}]]}]}],[\"$\",\"p\",null,{\"className\":\"p_root__SHE_W\",\"children\":[[\"$\",\"span\",\"0\",{\"children\":\"First of all, let's briefly recall you the DI advantages. The DI comes with the idea that the applications life cycle usually is about initializing things, use it and finally free it.\"}]]}],[\"$\",\"div\",\"9\",{\"children\":[\"$\",\"span\",null,{\"className\":\"img_root__vTZoG img_landscape__qBqfT\",\"children\":[[\"$\",\"span\",null,{\"className\":\"img_picture__pfsl0\",\"children\":[\"$\",\"img\",null,{\"alt\":\"Application Lifecycle Timeline\",\"src\":\"https://raw.githubusercontent.com/nfroidure/knifecycle/main/dependency-injection.svg\"}]}],null]}]}],[\"$\",\"p\",null,{\"className\":\"p_root__SHE_W\",\"children\":[[\"$\",\"span\",\"0\",{\"children\":\"It may be databases, external APIs, RPC calls, anything implying IOs with the rest of the world. They are a bit special and this is why DI threat it differently than simple code libraries.\"}]]}],[\"$\",\"p\",null,{\"className\":\"p_root__SHE_W\",\"children\":[[\"$\",\"span\",\"0\",{\"children\":\"Those dependencies are linked to each other so that we finally have an oriented dependency graph. The initialization and shutdown sequences are then resolving the graph in an optimized way with the best parallelism possible. This is the injector role to take care of it.\"}]]}],[\"$\",\"div\",\"12\",{\"children\":[\"$\",\"span\",null,{\"className\":\"img_root__vTZoG img_landscape__qBqfT\",\"children\":[[\"$\",\"span\",null,{\"className\":\"img_picture__pfsl0\",\"children\":[\"$\",\"img\",null,{\"alt\":\"Dependencies graph initialization and shutdown sequence\",\"src\":\"https://raw.githubusercontent.com/nfroidure/knifecycle/main/dependencies-graph-sequences.svg\"}]}],null]}]}],[\"$\",\"p\",null,{\"className\":\"p_root__SHE_W\",\"children\":[[\"$\",\"span\",\"0\",{\"children\":\"Basically, in JavaScript, DI looks like this:\"}]]}],[\"$\",\"div\",null,{\"className\":\"code_root__5JLV_\",\"children\":[\"$\",\"code\",null,{\"children\":[\"$\",\"pre\",null,{\"children\":\"// With Classes\\nclass User {\\n  constructor(db, log) {\\n    this.db = db;\\n    this.log = log;\\n  }\\n  async delete() {\\n    const result = await this.db.query(\\\"DELETE FROM users WHERE id = $id\\\", {\\n      id,\\n    });\\n\\n    if (result.deletedRows) {\\n      this.log(`User ${id} has been deleted!`);\\n    }\\n  }\\n}\\n\\n// With functions\\nasync function deleteUser({ db, log, id }) {\\n  const result = await db.query(\\\"DELETE FROM users WHERE id = $id\\\", { id });\\n\\n  if (result.deletedRows) {\\n    log(`User ${id} has been deleted!`);\\n  }\\n}\"}]}]}],[\"$\",\"h3\",null,{\"className\":\"h3_root__kVaqq\",\"children\":[\"$\",\"span\",null,{\"className\":\"anchored_root__HWi6K\",\"children\":[[[\"$\",\"span\",\"0\",{\"children\":\"The DI goodness\"}]],\" \",[\"$\",\"small\",null,{\"children\":[\"$\",\"$L14\",null,{\"href\":\"#the-di-goodness\",\"className\":\"anchored_icon__N5Sem\",\"id\":\"the-di-goodness\",\"title\":\"Lien vers cette section\",\"children\":[\"$\",\"span\",null,{\"children\":\"ðŸ”—\"}]}]}]]}]}],[\"$\",\"p\",null,{\"className\":\"p_root__SHE_W\",\"children\":[[\"$\",\"span\",\"0\",{\"children\":\"Using DI allows you to just declare your services dependencies and delegate the startup and shutdown process to the injector. It saves you a lot of time and allows to focus on your actual business code.\"}]]}],[\"$\",\"p\",null,{\"className\":\"p_root__SHE_W\",\"children\":[[\"$\",\"span\",\"0\",{\"children\":\"It also make your code more testable since you can easily replace a dependency per another (mocks, stubs).\"}]]}],[\"$\",\"p\",null,{\"className\":\"p_root__SHE_W\",\"children\":[[\"$\",\"span\",\"0\",{\"children\":\"Making dependencies easy to substitute also leads to a more configurable code base. Your code base pieces are also more reusable.\"}]]}],[\"$\",\"p\",null,{\"className\":\"p_root__SHE_W\",\"children\":[[\"$\",\"span\",\"0\",{\"children\":\"Finally, splitting your code into more specialized modules helps reducing the cognitive load of reasoning on its parts.\"}]]}],[\"$\",\"h3\",null,{\"className\":\"h3_root__kVaqq\",\"children\":[\"$\",\"span\",null,{\"className\":\"anchored_root__HWi6K\",\"children\":[[[\"$\",\"span\",\"0\",{\"children\":\"The DI downsides\"}]],\" \",[\"$\",\"small\",null,{\"children\":[\"$\",\"$L14\",null,{\"href\":\"#the-di-downsides\",\"className\":\"anchored_icon__N5Sem\",\"id\":\"the-di-downsides\",\"title\":\"Lien vers cette section\",\"children\":[\"$\",\"span\",null,{\"children\":\"ðŸ”—\"}]}]}]]}]}],[\"$\",\"p\",null,{\"className\":\"p_root__SHE_W\",\"children\":[[\"$\",\"span\",\"0\",{\"children\":\"Usually, dependency injection with the help of an injector comes with downsides. First, it makes debugging harder since the code only express dependencies in a declarative way. That said, usually, injectors are bullet proof and some have a limited set of features reducing the bug risks.\"}]]}],[\"$\",\"p\",null,{\"className\":\"p_root__SHE_W\",\"children\":[[\"$\",\"span\",\"0\",{\"children\":\"Also, when using types, since DI is dynamically done, you may loose some advantages of strong typing and static code analysis.\"}]]}],[\"$\",\"p\",null,{\"className\":\"p_root__SHE_W\",\"children\":[[\"$\",\"span\",\"0\",{\"children\":\"Those downsides can be mitigated as we'll see later.\"}]]}],[\"$\",\"h2\",null,{\"className\":\"h2_root__Y02lX\",\"children\":[\"$\",\"span\",null,{\"className\":\"anchored_root__HWi6K\",\"children\":[[[\"$\",\"span\",\"0\",{\"children\":\"Introducing Knifecycle\"}]],\" \",[\"$\",\"small\",null,{\"children\":[\"$\",\"$L14\",null,{\"href\":\"#introducing-knifecycle\",\"className\":\"anchored_icon__N5Sem\",\"id\":\"introducing-knifecycle\",\"title\":\"Lien vers cette section\",\"children\":[\"$\",\"span\",null,{\"children\":\"ðŸ”—\"}]}]}]]}]}],[\"$\",\"p\",null,{\"className\":\"p_root__SHE_W\",\"children\":[[\"$\",\"span\",\"0\",{\"children\":\"When it comes to DI, most tools are levering OOP and decorators. While it may fit the needs of OOP lovers, I prefer using the function based approach where a service is simply initialized by an asynchronous function taking the service's dependencies in argument and returning the initialized service.\"}]]}],[\"$\",\"p\",null,{\"className\":\"p_root__SHE_W\",\"children\":[[\"$\",\"span\",\"0\",{\"children\":\"Using functions also makes the code independent of the actual DI library since, you know, it's just functions and function can be called without any framework. One could just use those functions and initialize the process dependencies with actual code.\"}]]}],[\"$\",\"p\",null,{\"className\":\"p_root__SHE_W\",\"children\":[[\"$\",\"span\",\"0\",{\"children\":\"In fact, I used to create my services that way and to create the initialization code by hand for years. The thing is that it is repetitive, error prone and create boilerplate that adds no value.\"}]]}],[\"$\",\"p\",null,{\"className\":\"p_root__SHE_W\",\"children\":[[\"$\",\"span\",\"0\",{\"children\":\"I finally decided to automatize it but I didn't found a tool allowing DI usage without having to embrace a whole opinionated framework. I just wanted to use simple functions so I created one. Here comes, \"}],[\"$\",\"$L14\",null,{\"href\":\"https://github.com/nfroidure/knifecycle\",\"className\":\"a_root__WEPS7\",\"title\":null,\"target\":\"_blank\",\"children\":[null,[[\"$\",\"span\",\"0\",{\"children\":\"Knifecycle\"}]]]}],[\"$\",\"span\",\"2\",{\"children\":\".\"}]]}],[\"$\",\"p\",null,{\"className\":\"p_root__SHE_W\",\"children\":[[\"$\",\"span\",\"0\",{\"children\":\"I like to refer to Knifecycle as the DI banana without the \"}],[\"$\",\"$L14\",null,{\"href\":\"https://en.wikipedia.org/wiki/Object-oriented%5Fprogramming#cite%5Fref-armstrongjoe%5F39-1\",\"className\":\"a_root__WEPS7\",\"title\":null,\"target\":\"_blank\",\"children\":[null,[[\"$\",\"span\",\"0\",{\"children\":\"Gorilla\"}]]]}],[\"$\",\"span\",\"2\",{\"children\":\" since most DI libraries are using OOP and I am really convinced it is a mistake.\"}]]}],[\"$\",\"h3\",null,{\"className\":\"h3_root__kVaqq\",\"children\":[\"$\",\"span\",null,{\"className\":\"anchored_root__HWi6K\",\"children\":[[[\"$\",\"span\",\"0\",{\"children\":\"Using Knifecycle\"}]],\" \",[\"$\",\"small\",null,{\"children\":[\"$\",\"$L14\",null,{\"href\":\"#using-knifecycle\",\"className\":\"anchored_icon__N5Sem\",\"id\":\"using-knifecycle\",\"title\":\"Lien vers cette section\",\"children\":[\"$\",\"span\",null,{\"children\":\"ðŸ”—\"}]}]}]]}]}],[\"$\",\"p\",null,{\"className\":\"p_root__SHE_W\",\"children\":[[\"$\",\"span\",\"0\",{\"children\":\"Declaring a service is pretty simple actually, you just have to use the various functions that allows tagging initialization functions (called initializers) with the dependencies they actually need, the name and the kind of service it provides.\"}]]}],[\"$\",\"div\",null,{\"className\":\"gist_root__FwqUp\",\"children\":[[\"$\",\"iframe\",null,{\"src\":\"data:text/html;base64,PHNjcmlwdCBzcmM9Imh0dHBzOi8vZ2lzdC5naXRodWIuY29tL25mcm9pZHVyZS9kOWZiOWQyZDQwZjA2MTRjYTlmMzFhNzVhM2M1MjAxZC5qcyI+PC9zY3JpcHQ+\"}],[\"$\",\"noscript\",null,{\"children\":[\"$\",\"div\",null,{\"className\":\"code_root__5JLV_\",\"children\":[\"$\",\"code\",null,{\"children\":[\"$\",\"pre\",null,{\"children\":\"// From the Gist: https://gist.github.com/nfroidure/d9fb9d2d40f0614ca9f31a75a3c5201d\"}]}]}]}]]}],[\"$\",\"p\",null,{\"className\":\"p_root__SHE_W\",\"children\":[[\"$\",\"span\",\"0\",{\"children\":\"The reason why the autoService and autoProvider are prefixed by auto is that they infer from the function shape the names of the services and the dependencies they need from the functions signature. One could use the service and provider functions that basically do the same but in a more verbose manner. They can be useful to have more control on them though. That said, you can use the automatic versions and transpile it to the explicit ones by using the \"}],[\"$\",\"$L14\",null,{\"href\":\"https://github.com/nfroidure/babel-plugin-knifecycle\",\"className\":\"a_root__WEPS7\",\"title\":null,\"target\":\"_blank\",\"children\":[null,[[\"$\",\"code\",null,{\"className\":\"code_root__5JLV_\",\"children\":\"babel-plugin-knifecycle\"}]]]}],[\"$\",\"span\",\"2\",{\"children\":\" module in your project's build.\"}]]}],[\"$\",\"p\",null,{\"className\":\"p_root__SHE_W\",\"children\":[[\"$\",\"span\",\"0\",{\"children\":\"Knifecycle provides a lot of helpers you can find on the \"}],[\"$\",\"$L14\",null,{\"href\":\"https://github.com/nfroidure/knifecycle#api\",\"className\":\"a_root__WEPS7\",\"title\":null,\"target\":\"_blank\",\"children\":[null,[[\"$\",\"span\",\"0\",{\"children\":\"documentation\"}]]]}],[\"$\",\"span\",\"2\",{\"children\":\". Since services initializer are simple functions, there is a lot of functional programming concepts that applies to them (wrappers, compositions, piping...). Each decorators create a newly bound function so you can reuse an initialization function with different names and dependencies as many times as you need. For instance, in the previous example, if you needed to use the FTP service several times with different options you would just have to do the following:\"}]]}],[\"$\",\"div\",null,{\"className\":\"gist_root__FwqUp\",\"children\":[[\"$\",\"iframe\",null,{\"src\":\"data:text/html;base64,PHNjcmlwdCBzcmM9Imh0dHBzOi8vZ2lzdC5naXRodWIuY29tL25mcm9pZHVyZS9jNDg4OWIxMjFhM2EwMTQ2ZjJhZjRhN2Q5OWNkNGEwMi5qcyI+PC9zY3JpcHQ+\"}],[\"$\",\"noscript\",null,{\"children\":[\"$\",\"div\",null,{\"className\":\"code_root__5JLV_\",\"children\":[\"$\",\"code\",null,{\"children\":[\"$\",\"pre\",null,{\"children\":\"// From the Gist: https://gist.github.com/nfroidure/c4889b121a3a0146f2af4a7d99cd4a02\"}]}]}]}]]}],[\"$\",\"h2\",null,{\"className\":\"h2_root__Y02lX\",\"children\":[\"$\",\"span\",null,{\"className\":\"anchored_root__HWi6K\",\"children\":[[[\"$\",\"span\",\"0\",{\"children\":\"Addressing DI common downsides\"}]],\" \",[\"$\",\"small\",null,{\"children\":[\"$\",\"$L14\",null,{\"href\":\"#addressing-di-common-downsides\",\"className\":\"anchored_icon__N5Sem\",\"id\":\"addressing-di-common-downsides\",\"title\":\"Lien vers cette section\",\"children\":[\"$\",\"span\",null,{\"children\":\"ðŸ”—\"}]}]}]]}]}],[\"$\",\"p\",null,{\"className\":\"p_root__SHE_W\",\"children\":[[\"$\",\"span\",\"0\",{\"children\":\"Sometime, using DI makes hard to figure out the final dependency graph since you just declare each piece of code's dependencies separately. Knifecycle provides a way to build graphs from your code for that purpose. You can see an example of those graph in the \"}],[\"$\",\"$L14\",null,{\"href\":\"https://github.com/nfroidure/jsarch/blob/master/ARCHITECTURE.md\",\"className\":\"a_root__WEPS7\",\"title\":null,\"target\":\"_blank\",\"children\":[null,[[\"$\",\"span\",\"0\",{\"children\":\"jsarch architecture notes\"}]]]}],[\"$\",\"span\",\"2\",{\"children\":\". It is built using \"}],[\"$\",\"$L14\",null,{\"href\":\"https://github.com/nfroidure/jsarch/blob/master/package.json#L38\",\"className\":\"a_root__WEPS7\",\"title\":null,\"target\":\"_blank\",\"children\":[null,[[\"$\",\"span\",\"0\",{\"children\":\"mermaid\"}]]]}],[\"$\",\"span\",\"4\",{\"children\":\".\"}]]}],[\"$\",\"p\",null,{\"className\":\"p_root__SHE_W\",\"children\":[[\"$\",\"span\",\"0\",{\"children\":\"Another downside is the dynamic code that implies DI. Knifecycle allows you to build the \"}],[\"$\",\"$L14\",null,{\"href\":\"https://github.com/nfroidure/knifecycle/blob/master/src/build.mocha.js#L72-L133\",\"className\":\"a_root__WEPS7\",\"title\":null,\"target\":\"_blank\",\"children\":[null,[[\"$\",\"span\",\"0\",{\"children\":\"injector code statically\"}]]]}],[\"$\",\"span\",\"2\",{\"children\":\" so that you no longer need to embed Knifecycle in your final build. This is how I build the AWS Lambda functions of the Sencrop's backend. That way, the lambdas only contains the code they need to rely on. This is a nice side effect of limiting the DI influence on your own code.\"}]]}],[\"$\",\"p\",null,{\"className\":\"p_root__SHE_W\",\"children\":[[\"$\",\"span\",\"0\",{\"children\":\"You can see a \"}],[\"$\",\"$L14\",null,{\"href\":\"https://github.com/nfroidure/di-test\",\"className\":\"a_root__WEPS7\",\"title\":null,\"target\":\"_blank\",\"children\":[null,[[\"$\",\"span\",\"0\",{\"children\":\"full repository\"}]]]}],[\"$\",\"span\",\"2\",{\"children\":\" with Knifecycle usage example for a TypeScript project. It starts with no DI and then implement it with Knifecycle. In this post example, I declared the services manually but the injector can load the services automatically. This concept is \"}],[\"$\",\"$L14\",null,{\"href\":\"https://github.com/nfroidure/di-test/blob/master/src/services/_autoload.ts\",\"className\":\"a_root__WEPS7\",\"title\":null,\"target\":\"_blank\",\"children\":[null,[[\"$\",\"span\",\"0\",{\"children\":\"also illustrated\"}]]]}],[\"$\",\"span\",\"4\",{\"children\":\" in the above TypeScript project.\"}]]}],[\"$\",\"p\",null,{\"className\":\"p_root__SHE_W\",\"children\":[[\"$\",\"span\",\"0\",{\"children\":\"I hope you'll find your own usage of \"}],[\"$\",\"$L14\",null,{\"href\":\"https://github.com/nfroidure/knifecycle\",\"className\":\"a_root__WEPS7\",\"title\":null,\"target\":\"_blank\",\"children\":[null,[[\"$\",\"span\",\"0\",{\"children\":\"Knifecycle\"}]]]}],[\"$\",\"span\",\"2\",{\"children\":\", I use it happily since 2 years now. If you want to try, feel free to reach me for help whenever you need some ;).\"}]]}],[\"$\",\"p\",null,{\"className\":\"p_root__SHE_W\",\"children\":[[\"$\",\"strong\",null,{\"className\":\"strong_root__kOzFq\",\"children\":[[\"$\",\"span\",\"0\",{\"children\":\"Edit:\"}]]}],[\"$\",\"span\",\"1\",{\"children\":\" Knifecycle is at the core of the \"}],[\"$\",\"$L14\",null,{\"href\":\"https://github.com/nfroidure/whook\",\"className\":\"a_root__WEPS7\",\"title\":null,\"target\":\"_blank\",\"children\":[null,[[\"$\",\"span\",\"0\",{\"children\":\"Whook framework\"}]]]}],[\"$\",\"span\",\"3\",{\"children\":\" and a lot of \"}],[\"$\",\"$L14\",null,{\"href\":\"https://www.npmjs.com/search?q=keywords:knifecycle\",\"className\":\"a_root__WEPS7\",\"title\":null,\"target\":\"_blank\",\"children\":[null,[[\"$\",\"span\",\"0\",{\"children\":\"NPM modules using it\"}]]]}],[\"$\",\"span\",\"5\",{\"children\":\" are available in NPM.\"}]]}]],[\"$\",\"p\",null,{\"className\":\"p_root__SHE_W\",\"children\":[\"Published at\",\" \",\"samedi 26 janvier 2019 Ã  13:00:00\",\".\"]}]]}],[\"$\",\"section\",null,{\"className\":\"contentBlock_root__802UK\",\"children\":[\"$\",\"aside\",null,{\"className\":\"share_root__Qm_RR\",\"children\":[[\"$\",\"h2\",null,{\"className\":\"h2_root__Y02lX\",\"children\":\"Comment and share\"}],[\"$\",\"p\",null,{\"className\":\"p_root__SHE_W\",\"children\":[[\"$\",\"$L14\",null,{\"href\":\"https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Finsertafter.com%2Fblog%2Ftoward_stricter_query_string_parserunobstrusive_dependency_injection_with_knifecycle\",\"className\":\"a_root__WEPS7\",\"title\":\"Comment on Facebook\",\"target\":\"_blank\",\"children\":[null,[[\"$\",\"span\",null,{\"className\":\"share_icon__bi4Q3 share_facebook__JKn8d\"}],\"Facebook\"]]}],\" - \",[\"$\",\"$L14\",null,{\"href\":\"https://twitter.com/intent/tweet/?url=https%3A%2F%2Finsertafter.com%2Fblog%2Ftoward_stricter_query_string_parserunobstrusive_dependency_injection_with_knifecycle\u0026text=Unobtrusive%20Dependency%20Injection%20with%20Knifecycle\u0026via=nfroidure\",\"className\":\"a_root__WEPS7\",\"title\":\"Comment on Twitter\",\"target\":\"_blank\",\"children\":[null,[[\"$\",\"span\",null,{\"className\":\"share_icon__bi4Q3 \"}],\"Twitter\"]]}],\" - \",[\"$\",\"$L14\",null,{\"href\":\"mailto:nicolas.froidure@gmail.com\",\"className\":\"a_root__WEPS7\",\"title\":\"Answer via email\",\"target\":\"_self\",\"children\":[null,[[\"$\",\"span\",null,{\"className\":\"share_icon__bi4Q3 share_mail__yvBDK\"}],\"Email\"]]}]]}]]}]}],[\"$\",\"section\",null,{\"className\":\"contentBlock_root__802UK\",\"children\":[\"$\",\"aside\",null,{\"className\":\"page_linkedEntries__jiPuT\",\"children\":[[\"$\",\"h2\",null,{\"className\":\"h2_root__Y02lX\",\"children\":\"Similar posts\"}],[\"$\",\"p\",null,{\"className\":\"p_root__SHE_W\",\"children\":[\"In the categories\",\" \",\"Dependency Injection, NodeJS, JavaScript, Knifecycle, and NPM\",\".\"]}],[\"$\",\"div\",null,{\"className\":\"items_entries__5hkLG\",\"children\":[[\"$\",\"div\",\"metapak\",{\"className\":\"items_entry_item__GWeg7\",\"children\":[null,[\"$\",\"h2\",null,{\"className\":\"h2_root__Y02lX items_entry_title__vJ_8h\",\"children\":[\"$\",\"$L14\",null,{\"href\":\".//metapak\",\"className\":\"a_root__WEPS7 items_entry_link__EtVod\",\"title\":\"Read this blog post\",\"target\":\"_self\",\"children\":[null,\"Meta NPM Packages\"]}]}],[\"$\",\"p\",null,{\"className\":\"p_root__SHE_W items_entry_description__ZWt9y\",\"children\":[\"On managing a lot of NPM modules.\",\" \",[\"$\",\"br\",null,{}],[\"$\",\"$L14\",null,{\"href\":\".//metapak\",\"className\":\"a_root__WEPS7\",\"title\":\"Read this blog post\",\"target\":\"_self\",\"children\":[null,\"Read the full post\"]}]]}],[\"$\",\"p\",null,{\"className\":\"p_root__SHE_W items_entry_time__iNrot\",\"children\":[\"Published at\",\" \",\"jeudi 2 fÃ©vrier 2017 Ã  05:29:10\",\".\"]}],[\"$\",\"div\",null,{\"className\":\"items_clear__3fyGk\"}]]}],[\"$\",\"div\",\"no_more_middlewares\",{\"className\":\"items_entry_item__GWeg7\",\"children\":[null,[\"$\",\"h2\",null,{\"className\":\"h2_root__Y02lX items_entry_title__vJ_8h\",\"children\":[\"$\",\"$L14\",null,{\"href\":\".//no_more_middlewares\",\"className\":\"a_root__WEPS7 items_entry_link__EtVod\",\"title\":\"Read this blog post\",\"target\":\"_self\",\"children\":[null,\"No more middlewares, please\"]}]}],[\"$\",\"p\",null,{\"className\":\"p_root__SHE_W items_entry_description__ZWt9y\",\"children\":[\"Why I think middlewares are a bad thing, how I am replacing them.\",\" \",[\"$\",\"br\",null,{}],[\"$\",\"$L14\",null,{\"href\":\".//no_more_middlewares\",\"className\":\"a_root__WEPS7\",\"title\":\"Read this blog post\",\"target\":\"_self\",\"children\":[null,\"Read the full post\"]}]]}],[\"$\",\"p\",null,{\"className\":\"p_root__SHE_W items_entry_time__iNrot\",\"children\":[\"Published at\",\" \",\"samedi 5 novembre 2016 Ã  20:50:20\",\".\"]}],[\"$\",\"div\",null,{\"className\":\"items_clear__3fyGk\"}]]}],[\"$\",\"div\",\"lets_subset_javascript\",{\"className\":\"items_entry_item__GWeg7\",\"children\":[null,[\"$\",\"h2\",null,{\"className\":\"h2_root__Y02lX items_entry_title__vJ_8h\",\"children\":[\"$\",\"$L14\",null,{\"href\":\".//lets_subset_javascript\",\"className\":\"a_root__WEPS7 items_entry_link__EtVod\",\"title\":\"Read this blog post\",\"target\":\"_self\",\"children\":[null,\"Let's Subset JavaScript\"]}]}],[\"$\",\"p\",null,{\"className\":\"p_root__SHE_W items_entry_description__ZWt9y\",\"children\":[\"Currently, it's all about JavaScript and how to compile, transpile and every \\\"ile\\\"y things you could imagine. But what about making JavaScript smaller?\",\" \",[\"$\",\"br\",null,{}],[\"$\",\"$L14\",null,{\"href\":\".//lets_subset_javascript\",\"className\":\"a_root__WEPS7\",\"title\":\"Read this blog post\",\"target\":\"_self\",\"children\":[null,\"Read the full post\"]}]]}],[\"$\",\"p\",null,{\"className\":\"p_root__SHE_W items_entry_time__iNrot\",\"children\":[\"Published at\",\" \",\"vendredi 10 juillet 2015 Ã  15:38:03\",\".\"]}],[\"$\",\"div\",null,{\"className\":\"items_clear__3fyGk\"}]]}]]}]]}]}]]\n"])</script><script>self.__next_f.push([1,"b:[[\"$\",\"meta\",\"0\",{\"name\":\"viewport\",\"content\":\"width=device-width, initial-scale=1\"}],[\"$\",\"meta\",\"1\",{\"name\":\"theme-color\",\"content\":\"#3e78b2\"}],[\"$\",\"meta\",\"2\",{\"charSet\":\"utf-8\"}],[\"$\",\"title\",\"3\",{\"children\":\"Unobtrusive Dependency Injection with Knifecycle - Nicolas Froidure\"}],[\"$\",\"meta\",\"4\",{\"name\":\"description\",\"content\":\"Knifecycle is a NodeJS module aimed to provide DI power without the headaches.\"}],[\"$\",\"link\",\"5\",{\"rel\":\"author\",\"href\":\"https://insertafter.com\"}],[\"$\",\"meta\",\"6\",{\"name\":\"author\",\"content\":\"Nicolas Froidure\"}],[\"$\",\"meta\",\"7\",{\"name\":\"robots\",\"content\":\"index, follow\"}],[\"$\",\"link\",\"8\",{\"rel\":\"canonical\",\"href\":\"https://insertafter.com/en/blog/toward_stricter_query_string_parserunobstrusive_dependency_injection_with_knifecycle\"}],[\"$\",\"meta\",\"9\",{\"property\":\"og:title\",\"content\":\"Unobtrusive Dependency Injection with Knifecycle - Nicolas Froidure\"}],[\"$\",\"meta\",\"10\",{\"property\":\"og:description\",\"content\":\"Knifecycle is a NodeJS module aimed to provide DI power without the headaches.\"}],[\"$\",\"meta\",\"11\",{\"property\":\"og:url\",\"content\":\"https://insertafter.com/en/blog/toward_stricter_query_string_parserunobstrusive_dependency_injection_with_knifecycle\"}],[\"$\",\"meta\",\"12\",{\"property\":\"og:site_name\",\"content\":\"Nicolas Froidure\"}],[\"$\",\"meta\",\"13\",{\"property\":\"og:locale\",\"content\":\"en_US\"}],[\"$\",\"meta\",\"14\",{\"property\":\"og:image:alt\",\"content\":\"Website banner\"}],[\"$\",\"meta\",\"15\",{\"property\":\"og:image\",\"content\":\"https://insertafter.com/images/banner.png\"}],[\"$\",\"meta\",\"16\",{\"property\":\"og:type\",\"content\":\"article\"}],[\"$\",\"meta\",\"17\",{\"name\":\"twitter:card\",\"content\":\"summary\"}],[\"$\",\"meta\",\"18\",{\"name\":\"twitter:site\",\"content\":\"@nfroidure\"}],[\"$\",\"meta\",\"19\",{\"name\":\"twitter:creator\",\"content\":\"@nfroidure\"}],[\"$\",\"meta\",\"20\",{\"name\":\"twitter:title\",\"content\":\"Unobtrusive Dependency Injection with Knifecycle - Nicolas Froidure\"}],[\"$\",\"meta\",\"21\",{\"name\":\"twitter:description\",\"content\":\"Knifecycle is a NodeJS module aimed to provide DI power without the headaches.\"}],[\"$\",\"meta\",\"22\",{\"name\":\"twitter:image:alt\",\"content\":\"Website banner\"}],[\"$\",\"meta\",\"23\",{\"name\":\"twitter:image\",\"content\":\"https://insertafter.com/images/banner.png\"}],[\"$\",\"link\",\"24\",{\"rel\":\"icon\",\"href\":\"/images/favicon.svg\",\"type\":\"image/svg+xml\",\"sizes\":\"any\"}],[\"$\",\"link\",\"25\",{\"rel\":\"icon\",\"href\":\"/images/favicon-16.png\",\"type\":\"image/png\",\"sizes\":\"16x16\"}],[\"$\",\"link\",\"26\",{\"rel\":\"icon\",\"href\":\"/images/favicon-128.png\",\"type\":\"image/png\",\"sizes\":\"128x128\"}]]\n"])</script><script>self.__next_f.push([1,"5:null\n"])</script><script>self.__next_f.push([1,""])</script></body></html>